

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>What’s New in Python 2.7 &mdash; Python 2.7ja1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.7ja1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 2.7ja1 documentation 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="top" title="Python 2.7ja1 documentation" href="../index.html" />
    <link rel="up" title="What’s New in Python (英語)" href="index.html" />
    <link rel="next" title="What’s New in Python 2.6" href="2.6.html" />
    <link rel="prev" title="What’s New in Python (英語)" href="index.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/_jp.js"></script>
    
 

  </head>
  <body>
    <div class="related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="2.6.html" title="What’s New in Python 2.6"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="index.html" title="What’s New in Python (英語)"
             accesskey="P">前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="../index.html">Python 2.7ja1 documentation</a> &raquo;</li>

          <li><a href="index.html" accesskey="U">What&#8217;s New in Python (英語)</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">What&#8217;s New in Python 2.7</a><ul>
<li><a class="reference internal" href="#python-2-x">Python 2.x の今後</a></li>
<li><a class="reference internal" href="#python-3-1">Python 3.1 の機能</a></li>
<li><a class="reference internal" href="#pep-372-collections">PEP 372: collections に順序付き辞書を追加</a></li>
<li><a class="reference internal" href="#pep-378-1000">PEP 378: 1000区切りのための書式指定子</a></li>
<li><a class="reference internal" href="#pep-389-argparse">PEP 389: コマンドライン解析のための argparse モジュール</a></li>
<li><a class="reference internal" href="#pep-391-logging">PEP 391: logging の辞書ベースの設定</a></li>
<li><a class="reference internal" href="#pep-3106-view">PEP 3106: 辞書 View</a></li>
<li><a class="reference internal" href="#pep-3137-memoryview">PEP 3137: memoryview オブジェクト</a></li>
<li><a class="reference internal" href="#id1">その他の言語の変更</a><ul>
<li><a class="reference internal" href="#id2">インタプリタの変更</a></li>
<li><a class="reference internal" href="#id3">最適化</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id4">新しいモジュールと改良されたモジュール</a><ul>
<li><a class="reference internal" href="#importlib">新しいモジュール: importlib</a></li>
<li><a class="reference internal" href="#sysconfig">新しいモジュール: sysconfig</a></li>
<li><a class="reference internal" href="#ttk-tk">ttk: Tk のテーマ付きウィジェット</a></li>
<li><a class="reference internal" href="#unittest">更新されたモジュール: unittest</a></li>
<li><a class="reference internal" href="#elementtree-1-3">更新されたモジュール: ElementTree 1.3</a></li>
</ul>
</li>
<li><a class="reference internal" href="#c-api">ビルドと C API の変更</a><ul>
<li><a class="reference internal" href="#whatsnew27-capsules">カプセル</a></li>
<li><a class="reference internal" href="#windows">ポート特有の変更: Windows</a></li>
<li><a class="reference internal" href="#mac-os-x">ポート特有の変更: Mac OS X</a></li>
<li><a class="reference internal" href="#freebsd">ポート特有の変更: FreeBSD</a></li>
</ul>
</li>
<li><a class="reference internal" href="#id6">その他の変更と修正</a></li>
<li><a class="reference internal" href="#python-2-7">Python 2.7 への移植</a></li>
<li><a class="reference internal" href="#acks27">謝辞</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="index.html"
                        title="前の章へ">What&#8217;s New in Python (英語)</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="2.6.html"
                        title="次の章へ">What&#8217;s New in Python 2.6</a></p>
  <h3>このページ</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/whatsnew/2.7.txt"
           rel="nofollow">ソースコードを表示</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>クイック検索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    モジュール、クラス、または関数名を入力してください
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="what-s-new-in-python-2-7">
<h1>What&#8217;s New in Python 2.7<a class="headerlink" href="#what-s-new-in-python-2-7" title="このヘッドラインへのパーマリンク">¶</a></h1>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Author:</th><td class="field-body">A.M. Kuchling (amk at amk.ca)</td>
</tr>
<tr class="field-even field"><th class="field-name">Release:</th><td class="field-body">2.7ja1</td>
</tr>
<tr class="field-odd field"><th class="field-name">Date:</th><td class="field-body">2011年 12月 26日</td>
</tr>
</tbody>
</table>
<p>この文書は Python 2.7 の新機能について解説します。
Python 2.7 は 2010 年 7 月 3 日にリリースされました。</p>
<p>数値周りの扱いが、浮動小数点数でも <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt></a> クラスでもいろいろな点で改良されました、標準ライブラリにいくつかの有用な追加が行われました。 <a class="reference internal" href="../library/unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a>
モジュールが大幅に改良され、コマンドラインオプション解析の <tt class="xref py py-mod docutils literal"><span class="pre">argpase</span></tt>
モジュールが追加され、 <a class="reference internal" href="../library/collections.html#module-collections" title="collections: High-performance container datatypes"><tt class="xref py py-mod docutils literal"><span class="pre">collections</span></tt></a> モジュールに便利な
<a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><tt class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></tt></a> と <a class="reference internal" href="../library/collections.html#collections.Counter" title="collections.Counter"><tt class="xref py py-class docutils literal"><span class="pre">Counter</span></tt></a>
が追加され、他にもたくさんの改良が行われています。</p>
<p>Python 2.7 は 2.x の最終リリースになることが予定されているので、私たちはこのリリースを長期にわたって良いものになるように努力してきました。
Python 3 への移植を助けるため、いくつかの新機能が Python 3.x から
Python 2.7 に取り込まれています。</p>
<p>このドキュメントは新機能の完全な詳細を提供するのではなくて、簡易な概要を提供することを目的にしています。完全な詳細が知りたければ、 <a class="reference external" href="http://docs.python.org">http://docs.python.org</a> の Python 2.7 のドキュメントを参照してください。設計と実装の根拠を理解したい場合は、新機能に関する PEP を参照するか、 <a class="reference external" href="http://bugs.python.org">http://bugs.python.org</a> に議論したい機能について登録してください。可能な限り、 &#8220;What&#8217;s New in Python&#8221; は各変更の bug や patch に対してリンクしています。</p>
<span class="target" id="whatsnew27-python31"></span><div class="section" id="python-2-x">
<h2>Python 2.x の今後<a class="headerlink" href="#python-2-x" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python 2.7 は 2.x シリーズの最後のメジャーリリースになります。
Python のメンテナは今後は Python 3.x シリーズの開発に集中する予定です。</p>
<p>これは、 2.7 が長期間残り続け、 Python 3.x への対応がされないプロダクションサービスを動かし続けることを意味します。
2.7 が長期的に重要なリリースになるので、2つの結論があります:</p>
<ul>
<li><p class="first">これまでの 2.x バージョンに比べて長期間のメンテナンスが行われます。
Python 2.7 は 3.x への移行が行われている間はメンテナンスされ続けます。
Python 開発者はさらにそこから2年のバグフィックスリリースをする予定です。</p>
</li>
<li><p class="first">開発者向けの警告を抑止するポリシーが取られました。
<a class="reference internal" href="../library/exceptions.html#exceptions.DeprecationWarning" title="exceptions.DeprecationWarning"><tt class="xref py py-exc docutils literal"><span class="pre">DeprecationWarning</span></tt></a> とそれを継承した警告は、指定されない限りは無視され、アプリケーションのユーザーがその警告を見ないですむようになりました。この変更は Python 3.2 ブランチにも適用されています。
(stdlib-sig で討議され、 <a class="reference external" href="http://bugs.python.org/issue7319">issue 7319</a> になりました)</p>
<p>以前のリリースでは、 <a class="reference internal" href="../library/exceptions.html#exceptions.DeprecationWarning" title="exceptions.DeprecationWarning"><tt class="xref py py-exc docutils literal"><span class="pre">DeprecationWarning</span></tt></a> メッセージはデフォルトで有効になっており、 Python 開発者に、将来のバージョンの Python でそのコードのどこが動かなくなるかを明確に知らせていました。</p>
<p>しかし、 Python で開発されたアプリケーションの利用者であって開発には携わっていない人がどんどん増えてきました。 <a class="reference internal" href="../library/exceptions.html#exceptions.DeprecationWarning" title="exceptions.DeprecationWarning"><tt class="xref py py-exc docutils literal"><span class="pre">DeprecationWarning</span></tt></a>
メッセージはそれらのユーザーには無関係で、彼らをアプリケーションが本当に正しく動いているのか不安にさせ、ユーザーの質問に応えるための開発者の負担も増やしていました。</p>
<p><a class="reference internal" href="../library/exceptions.html#exceptions.DeprecationWarning" title="exceptions.DeprecationWarning"><tt class="xref py py-exc docutils literal"><span class="pre">DeprecationWarning</span></tt></a> メッセージの表示を有効にするには、
<a class="reference internal" href="../using/cmdline.html#cmdoption-W"><em class="xref std std-option">-Wdefault</em></a> (短い形式: <a class="reference internal" href="../using/cmdline.html#cmdoption-W"><em class="xref std std-option">-Wd</em></a>) スイッチか、
Python を実行する前に <span class="target" id="index-0"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONWARNINGS"><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONWARNINGS</span></tt></a> 環境変数を <tt class="docutils literal"><span class="pre">&quot;default&quot;</span></tt>
(か、 <tt class="docutils literal"><span class="pre">&quot;d&quot;</span></tt>)に設定します。 Python コードから有効にする場合は
<tt class="docutils literal"><span class="pre">warnings.simplefilter('default')</span></tt> とします。</p>
</li>
</ul>
</div>
<div class="section" id="python-3-1">
<h2>Python 3.1 の機能<a class="headerlink" href="#python-3-1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python 2.6 は Python 3.0 から多くの機能を取り込み、 Python 2.7
は Python 3.1 の新しい機能のいくつかを取り込みました。
2.x シリーズは 3.x シリーズへの移行のためのツールを提供し続けています。</p>
<p>Python 2.7 に取り込まれた 3.1 の機能の不完全なリスト:</p>
<ul class="simple">
<li>集合のリテラル文法 (<tt class="docutils literal"><span class="pre">{1,2,3}</span></tt> は mutable set になります)</li>
<li>辞書と集合の内包表記 (<tt class="docutils literal"><span class="pre">{i:</span> <span class="pre">i*2</span> <span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">range(3)}</span></tt>).</li>
<li>1つの <a class="reference internal" href="../reference/compound_stmts.html#with"><tt class="xref std std-keyword docutils literal"><span class="pre">with</span></tt></a> 文で複数のコンテキストマネージャを扱えるように。</li>
<li><a class="reference internal" href="../library/io.html#module-io" title="io: Core tools for working with streams."><tt class="xref py py-mod docutils literal"><span class="pre">io</span></tt></a> ライブラリの新バージョン。パフォーマンスのためにC言語で描き直されています。</li>
<li><a class="reference internal" href="#pep-0372"><em>PEP 372: collections に順序付き辞書を追加</em></a> で解説されている順序付き辞書</li>
<li><a class="reference internal" href="#pep-0378"><em>PEP 378: 1000区切りのための書式指定子</em></a> で解説されている新しい <tt class="docutils literal"><span class="pre">&quot;,&quot;</span></tt> フォーマット指定子</li>
<li><a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><tt class="xref py py-class docutils literal"><span class="pre">memoryview</span></tt></a> オブジェクト</li>
<li><a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: Convenience wrappers for __import__"><tt class="xref py py-mod docutils literal"><span class="pre">importlib</span></tt></a> モジュールの小さいサブセット。 <a class="reference external" href="#importlib-section">下に説明があります</a></li>
<li>float <tt class="docutils literal"><span class="pre">x</span></tt> の <a class="reference internal" href="../library/repr.html#module-repr" title="repr: 大きさに制限のある別のrepr()の実装。"><tt class="xref py py-func docutils literal"><span class="pre">repr()</span></tt></a> が多くの場合に短くなりました。これは
<tt class="docutils literal"><span class="pre">x</span></tt> に戻せることが保証される最小の10進文字列です。以前のバージョンの
Python では、 <tt class="docutils literal"><span class="pre">float(repr(x))</span></tt> が <tt class="docutils literal"><span class="pre">x</span></tt> になることだけが保証されていました。</li>
<li>float から文字列、文字列から float への変換が正しく丸められるようになりました。
<a class="reference internal" href="../library/functions.html#round" title="round"><tt class="xref py py-func docutils literal"><span class="pre">round()</span></tt></a> 関数も正しく丸めるようになりました。</li>
<li>拡張モジュールが C API を提供するための、 <a class="reference internal" href="../c-api/capsule.html#PyCapsule" title="PyCapsule"><tt class="xref c c-type docutils literal"><span class="pre">PyCapsule</span></tt></a> 型</li>
<li><a class="reference internal" href="../c-api/long.html#PyLong_AsLongAndOverflow" title="PyLong_AsLongAndOverflow"><tt class="xref c c-func docutils literal"><span class="pre">PyLong_AsLongAndOverflow()</span></tt></a> C API 関数</li>
</ul>
<p>新しい Python3 モード Warning:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/operator.html#operator.isCallable" title="operator.isCallable"><tt class="xref py py-func docutils literal"><span class="pre">operator.isCallable()</span></tt></a> と <a class="reference internal" href="../library/operator.html#operator.sequenceIncludes" title="operator.sequenceIncludes"><tt class="xref py py-func docutils literal"><span class="pre">operator.sequenceIncludes()</span></tt></a>
は 3.x ではサポートされず、 warning になります。</li>
<li><a class="reference internal" href="../using/cmdline.html#cmdoption-3"><em class="xref std std-option">-3</em></a> オプションは自動的に <a class="reference internal" href="../using/cmdline.html#cmdoption-Q"><em class="xref std std-option">-Qwarn</em></a> スイッチを有効にして、整数や長整数に対する古い形式の除算が警告を出すようになります。</li>
</ul>
</div>
<div class="section" id="pep-372-collections">
<span id="pep-0372"></span><h2>PEP 372: collections に順序付き辞書を追加<a class="headerlink" href="#pep-372-collections" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>通常の Python 辞書は、 key/value ペアを不定の順序でイテレートします。何年にもわたり、いろいろな人が key の挿入順を保存する辞書の別実装を書いてきました。その経験に基づき、 2.7 は <a class="reference internal" href="../library/collections.html#module-collections" title="collections: High-performance container datatypes"><tt class="xref py py-mod docutils literal"><span class="pre">collections</span></tt></a> モジュールに新しい
<a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><tt class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></tt></a> クラスを追加しました。</p>
<p><a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><tt class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></tt></a> API は通常の辞書と同じインタフェースを提供していますが、
key/value をイテレートするときに key が最初に挿入された順番になることが保証されています。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s">&#39;first&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>                 <span class="p">(</span><span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="gp">... </span>                 <span class="p">(</span><span class="s">&#39;third&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="go">[(&#39;first&#39;, 1), (&#39;second&#39;, 2), (&#39;third&#39;, 3)]</span>
</pre></div>
</div>
<p>新しいエントリが既存のエントリを上書きした場合は、元の挿入順序が保持されます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s">&#39;second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="go">[(&#39;first&#39;, 1), (&#39;second&#39;, 4), (&#39;third&#39;, 3)]</span>
</pre></div>
</div>
<p>エントリを削除して再挿入すると、順序は一番最後に移動します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">d</span><span class="p">[</span><span class="s">&#39;second&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="s">&#39;second&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="go">[(&#39;first&#39;, 1), (&#39;third&#39;, 3), (&#39;second&#39;, 5)]</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/collections.html#collections.OrderedDict.popitem" title="collections.OrderedDict.popitem"><tt class="xref py py-meth docutils literal"><span class="pre">popitem()</span></tt></a> メソッドは、オプションの <em>last</em>
引数を持ち、でフォルトで True になっています。
<em>last</em> が True の場合、一番最近に追加された key が返され、削除されます。
False の場合、最も古い key が選ばれます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">od</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
<span class="go">(19, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od</span><span class="o">.</span><span class="n">popitem</span><span class="p">()</span>
<span class="go">(18, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od</span><span class="o">.</span><span class="n">popitem</span><span class="p">(</span><span class="n">last</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">(0, 0)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od</span><span class="o">.</span><span class="n">popitem</span><span class="p">(</span><span class="n">last</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="go">(1, 0)</span>
</pre></div>
</div>
<p>2つの順序付き辞書を比較するときは、 key/value だけでなく、挿入順も比較されます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">od1</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s">&#39;first&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>                   <span class="p">(</span><span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="gp">... </span>                   <span class="p">(</span><span class="s">&#39;third&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od2</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">([(</span><span class="s">&#39;third&#39;</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
<span class="gp">... </span>                   <span class="p">(</span><span class="s">&#39;first&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>                   <span class="p">(</span><span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od1</span> <span class="o">==</span> <span class="n">od2</span>
<span class="go">False</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Move &#39;third&#39; key to the end</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">od2</span><span class="p">[</span><span class="s">&#39;third&#39;</span><span class="p">];</span> <span class="n">od2</span><span class="p">[</span><span class="s">&#39;third&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">3</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">od1</span> <span class="o">==</span> <span class="n">od2</span>
<span class="go">True</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><tt class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></tt></a> を通常の辞書と比較すると、挿入順は無視されて単に key/value だけが比較されます。</p>
<p><a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><tt class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></tt></a> の実装はこうなっています。
key の2重リンクリストを管理し、新しい key が挿入されるときにリストに新しい
key を追加します。2つ目の辞書が key を対応するリストノードにマップします。なので、削除時にリンクリストを操作する必要はなく、コストは O(1) に保たれています。</p>
<p>標準ライブラリのいくつかのモジュールで、順序付き辞書の利用がサポートされています。</p>
<ul class="simple">
<li><a class="reference internal" href="../library/configparser.html#module-ConfigParser" title="ConfigParser: Configuration file parser."><tt class="xref py py-mod docutils literal"><span class="pre">ConfigParser</span></tt></a> モジュールはデフォルトで順序付き辞書を使います。設定ファイルを読み込み、編集した後、元の順序で書きなおすことができます。</li>
<li><a class="reference internal" href="../library/collections.html#collections.namedtuple" title="collections.namedtuple"><tt class="xref py py-func docutils literal"><span class="pre">collections.namedtuple()</span></tt></a> の <a class="reference internal" href="../library/collections.html#collections.somenamedtuple._asdict" title="collections.somenamedtuple._asdict"><tt class="xref py py-meth docutils literal"><span class="pre">_asdict()</span></tt></a>
メソッドは、タプルの順序と同じ順序の順序付き辞書を返すようになりました。</li>
<li><a class="reference internal" href="../library/json.html#module-json" title="json: JSON 形式のエンコードおよびデコード"><tt class="xref py py-mod docutils literal"><span class="pre">json</span></tt></a> モジュールのデコーダーが <tt class="xref py py-class docutils literal"><span class="pre">OrderedDict</span></tt> をビルドするのをサポートするために、 <a class="reference internal" href="../library/json.html#json.JSONDecoder" title="json.JSONDecoder"><tt class="xref py py-class docutils literal"><span class="pre">JSONDecoder</span></tt></a> クラスのコンストラクタに <em>object_pairs_hook</em> 引数が追加されました。
<a class="reference external" href="http://pyyaml.org/">PyYAML</a> などの外部のライブラリでもサポートされています。</li>
</ul>
<div class="admonition- admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-1"></span><a class="pep reference external" href="http://www.python.org/dev/peps/pep-0372"><strong>PEP 372</strong></a> - Adding an ordered dictionary to collections</dt>
<dd>PEP written by Armin Ronacher and Raymond Hettinger;
implemented by Raymond Hettinger.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-378-1000">
<span id="pep-0378"></span><h2>PEP 378: 1000区切りのための書式指定子<a class="headerlink" href="#pep-378-1000" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>大きい数値に区切り文字を追加して、 18446744073709551616 の代わりに
18,446,744,073,709,551,616 と出力すると、プログラムの出力を読みやすくできます。</p>
<p>これを行う一般的な方法は <a class="reference internal" href="../library/locale.html#module-locale" title="locale: 国際化サービス。"><tt class="xref py py-mod docutils literal"><span class="pre">locale</span></tt></a> モジュールを使うことで、複数の区切り文字 (北米では &#8221;,&#8221; で、ヨーロッパでは &#8221;.&#8221;)
を使ったり、複数のグループの大きさを使うことができます。しかし、 <a class="reference internal" href="../library/locale.html#module-locale" title="locale: 国際化サービス。"><tt class="xref py py-mod docutils literal"><span class="pre">locale</span></tt></a> の利用方法は複雑ですし、スレッドごとに異なるロケールの出力を行うプログラムでは利用することができません。</p>
<p>そのため、シンプルなカンマによるグループ化機構が <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><tt class="xref py py-meth docutils literal"><span class="pre">str.format()</span></tt></a>
メソッドのミニ言語に追加されました。浮動小数点数をフォーマットする場合、シンプルにカンマを幅と精度の間に置きます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;{:20,.2f}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mf">18446744073709551616.0</span><span class="p">)</span>
<span class="go">&#39;18,446,744,073,709,551,616.00&#39;</span>
</pre></div>
</div>
<p>整数をフォーマットする場合は、幅の後にカンマを追加します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;{:20,d}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">18446744073709551616</span><span class="p">)</span>
<span class="go">&#39;18,446,744,073,709,551,616&#39;</span>
</pre></div>
</div>
<p>この機構は全く柔軟性を持っていません。区切り文字は常にカンマですし、グループは常に数字3つになります。カンマ書式機構は <a class="reference internal" href="../library/locale.html#module-locale" title="locale: 国際化サービス。"><tt class="xref py py-mod docutils literal"><span class="pre">locale</span></tt></a> ほど汎用ではありませんが、手軽に使うことができます。</p>
<div class="admonition- admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-2"></span><a class="pep reference external" href="http://www.python.org/dev/peps/pep-0378"><strong>PEP 378</strong></a> - Format Specifier for Thousands Separator</dt>
<dd>PEP written by Raymond Hettinger; implemented by Eric Smith.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-389-argparse">
<h2>PEP 389: コマンドライン解析のための argparse モジュール<a class="headerlink" href="#pep-389-argparse" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>コマンドライン引数の解析のための <a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: コマンドラインオプションと引数のパーサーライブラリ"><tt class="xref py py-mod docutils literal"><span class="pre">argparse</span></tt></a> モジュールが、
<a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: コマンドラインオプション解析機 (撤廃)"><tt class="xref py py-mod docutils literal"><span class="pre">optparse</span></tt></a> モジュールのより協力な代替として追加されました。</p>
<p>これにより、 Python はコマンドライン引数の解析のために3つの異なるモジュール、 <a class="reference internal" href="../library/getopt.html#module-getopt" title="getopt: ポータブルなコマンドラインオプションのパーサ。 長短の両方の形式をサポートします。"><tt class="xref py py-mod docutils literal"><span class="pre">getopt</span></tt></a>, <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: コマンドラインオプション解析機 (撤廃)"><tt class="xref py py-mod docutils literal"><span class="pre">optparse</span></tt></a>, <a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: コマンドラインオプションと引数のパーサーライブラリ"><tt class="xref py py-mod docutils literal"><span class="pre">argparse</span></tt></a> を持つことになります。
<a class="reference internal" href="../library/getopt.html#module-getopt" title="getopt: ポータブルなコマンドラインオプションのパーサ。 長短の両方の形式をサポートします。"><tt class="xref py py-mod docutils literal"><span class="pre">getopt</span></tt></a> モジュールは C言語用ライブラリの <tt class="xref c c-func docutils literal"><span class="pre">getopt()</span></tt> 関数に似せてあるので、あとで C 言語で書き直すかもしれないプログラムのプロトタイプを Python で書く場合に役に立ちます。
<a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: コマンドラインオプション解析機 (撤廃)"><tt class="xref py py-mod docutils literal"><span class="pre">optparse</span></tt></a> は冗長になってしまいましたが、まだたくさんのスクリプトが利用していて、それらのスクリプトを自動的に更新する手段が無いので、削除される予定はありません。
(<a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: コマンドラインオプションと引数のパーサーライブラリ"><tt class="xref py py-mod docutils literal"><span class="pre">argparse</span></tt></a> API を <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: コマンドラインオプション解析機 (撤廃)"><tt class="xref py py-mod docutils literal"><span class="pre">optparse</span></tt></a> のインタフェースに適合させる方法も検討されましたが、多くの複雑さと難点のために却下されました)</p>
<p>古いバージョンの Python との互換性を気にすること無く新しいスクリプトを書く時は、
<a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: コマンドラインオプション解析機 (撤廃)"><tt class="xref py py-mod docutils literal"><span class="pre">optparse</span></tt></a> の代わりに <a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: コマンドラインオプションと引数のパーサーライブラリ"><tt class="xref py py-mod docutils literal"><span class="pre">argparse</span></tt></a> を使ってください。</p>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">argparse</span>

<span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s">&#39;Command-line example.&#39;</span><span class="p">)</span>

<span class="c"># Add optional switches</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-v&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store_true&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;is_verbose&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;produce verbose output&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-o&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;output&#39;</span><span class="p">,</span>
                    <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;FILE&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;direct output to FILE instead of stdout&#39;</span><span class="p">)</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">&#39;-C&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;context&#39;</span><span class="p">,</span>
                    <span class="n">metavar</span><span class="o">=</span><span class="s">&#39;NUM&#39;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;display NUM lines of added context&#39;</span><span class="p">)</span>

<span class="c"># Allow any number of additional arguments.</span>
<span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="n">nargs</span><span class="o">=</span><span class="s">&#39;*&#39;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&#39;store&#39;</span><span class="p">,</span> <span class="n">dest</span><span class="o">=</span><span class="s">&#39;inputs&#39;</span><span class="p">,</span>
                    <span class="n">help</span><span class="o">=</span><span class="s">&#39;input filenames (default is stdin)&#39;</span><span class="p">)</span>

<span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
<span class="k">print</span> <span class="n">args</span><span class="o">.</span><span class="n">__dict__</span>
</pre></div>
</div>
<p>オーバーライドしない限り、 <a class="reference internal" href="../using/cmdline.html#cmdoption-h"><em class="xref std std-option">-h</em></a> と <a class="reference internal" href="../using/cmdline.html#cmdoption--help"><em class="xref std std-option">--help</em></a> スイッチが自動的に追加され、綺麗にフォーマットした出力を生成します。</p>
<div class="highlight-python"><pre>-&gt; ./python.exe argparse-example.py --help
usage: argparse-example.py [-h] [-v] [-o FILE] [-C NUM] [inputs [inputs ...]]

Command-line example.

positional arguments:
  inputs      input filenames (default is stdin)

optional arguments:
  -h, --help  show this help message and exit
  -v          produce verbose output
  -o FILE     direct output to FILE instead of stdout
  -C NUM      display NUM lines of added context</pre>
</div>
<p><a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: コマンドラインオプション解析機 (撤廃)"><tt class="xref py py-mod docutils literal"><span class="pre">optparse</span></tt></a> と同じく、コマンドラインスイッチと引数は、 <em>dest</em> 引数の名前の属性をもったオブジェクトとして返されます。</p>
<div class="highlight-python"><pre>-&gt; ./python.exe argparse-example.py -v
{'output': None,
 'is_verbose': True,
 'context': 0,
 'inputs': []}

-&gt; ./python.exe argparse-example.py -v -o /tmp/output -C 4 file1 file2
{'output': '/tmp/output',
 'is_verbose': True,
 'context': 4,
 'inputs': ['file1', 'file2']}</pre>
</div>
<p><a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: コマンドラインオプションと引数のパーサーライブラリ"><tt class="xref py py-mod docutils literal"><span class="pre">argparse</span></tt></a> は <a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: コマンドラインオプション解析機 (撤廃)"><tt class="xref py py-mod docutils literal"><span class="pre">optparse</span></tt></a> よりも多くの便利なバリデーションを持っています。引数の正確な数を整数で指定したり、 <tt class="docutils literal"><span class="pre">'*'</span></tt> で0以上の数を指定したり、
<tt class="docutils literal"><span class="pre">'+'</span></tt> で1以上の数を指定したり、 <tt class="docutils literal"><span class="pre">'?'</span></tt> でオプションにしたりできます。トップレベルのパーサーはサブパーサーを持つことができ、 <tt class="docutils literal"><span class="pre">svn</span> <span class="pre">commit</span></tt>,
<tt class="docutils literal"><span class="pre">svn</span> <span class="pre">update</span></tt> のように異なるオプションを持ったサブコマンドを定義できます。引数のタイプに <a class="reference internal" href="../library/argparse.html#argparse.FileType" title="argparse.FileType"><tt class="xref py py-class docutils literal"><span class="pre">FileType</span></tt></a> を指定することで、自動でファイルを開き、 <tt class="docutils literal"><span class="pre">'-'</span></tt> が指定されたときに標準入出力だと判断することができます。</p>
<div class="admonition- admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference internal" href="../library/argparse.html#module-argparse" title="argparse: コマンドラインオプションと引数のパーサーライブラリ"><tt class="xref py py-mod docutils literal"><span class="pre">argparse</span></tt></a> のドキュメント</dt>
<dd>argparse モジュールのドキュメント</dd>
<dt><a class="reference internal" href="../library/argparse.html#argparse-from-optparse"><em>optparse からのアップグレード</em></a></dt>
<dd><a class="reference internal" href="../library/optparse.html#module-optparse" title="optparse: コマンドラインオプション解析機 (撤廃)"><tt class="xref py py-mod docutils literal"><span class="pre">optparse</span></tt></a> を使うコードを変換する方法を説明した Python のドキュメントの一部</dd>
<dt><span class="target" id="index-3"></span><a class="pep reference external" href="http://www.python.org/dev/peps/pep-0389"><strong>PEP 389</strong></a> - argparse - New Command Line Parsing Module</dt>
<dd>PEP written and implemented by Steven Bethard.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-391-logging">
<h2>PEP 391: logging の辞書ベースの設定<a class="headerlink" href="#pep-391-logging" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="../library/logging.html#module-logging" title="logging: アプリケーションのための、柔軟なエラーロギングシステム"><tt class="xref py py-mod docutils literal"><span class="pre">logging</span></tt></a> モジュールは非常に柔軟です。アプリケーションは logging
のサブシステムのツリーを定義できます。このツリーの各ロガーはいくつかのメッセージをフィルターし、異なるフォーマットを行い、メッセージを沢山の種類のハンドラーに渡します。</p>
<p>この柔軟性は、多くの設定を必要とします。オブジェクトを生成してプロパティを設定する Python コードを書くこともできますが、複雑なセットアップをしようとすると退屈なコードを書かないといけなくなります。
<a class="reference internal" href="../library/logging.html#module-logging" title="logging: アプリケーションのための、柔軟なエラーロギングシステム"><tt class="xref py py-mod docutils literal"><span class="pre">logging</span></tt></a> は設定ファイルのパースを行う <tt class="xref py py-func docutils literal"><span class="pre">fileConfig()</span></tt>
関数を提供していますが、このファイルフォーマットはフィルターの設定をサポートしていませんし、プログラムで生成するのはさらに面倒になります。</p>
<p>Python 2.7 は logging の設定のために辞書を使う <tt class="xref py py-func docutils literal"><span class="pre">dictConfig()</span></tt>
関数を追加しました。いろいろな入力から辞書を作成する方法があります。コードで作ったり、 JSON ファイルをパースしたり、YAMLのパーサーをインストールしてあればそれを使うことができます。詳しい情報は <a class="reference internal" href="../library/logging.config.html#logging-config-api"><em>環境設定のための関数</em></a> を参照してください。</p>
<p>次の例は2つのロガー、 root logger と &#8220;network&#8221; という名前の logger
root logger に送られたメッセージは syslog プロトコルを利用してシステムに送られ、 &#8220;network&#8221; logger に送られたメッセージは1MBごとにローテートされる
<tt class="file docutils literal"><span class="pre">network.log</span></tt> ファイルに書きこまれます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">logging.config</span>

<span class="n">configdict</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s">&#39;version&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>    <span class="c"># Configuration schema in use; must be 1 for now</span>
 <span class="s">&#39;formatters&#39;</span><span class="p">:</span> <span class="p">{</span>
     <span class="s">&#39;standard&#39;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s">&#39;format&#39;</span><span class="p">:</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%(asctime)s</span><span class="s"> </span><span class="si">%(name)-15s</span><span class="s"> &#39;</span>
                    <span class="s">&#39;</span><span class="si">%(levelname)-8s</span><span class="s"> </span><span class="si">%(message)s</span><span class="s">&#39;</span><span class="p">)}},</span>

 <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;netlog&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;backupCount&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
                     <span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;logging.handlers.RotatingFileHandler&#39;</span><span class="p">,</span>
                     <span class="s">&#39;filename&#39;</span><span class="p">:</span> <span class="s">&#39;/logs/network.log&#39;</span><span class="p">,</span>
                     <span class="s">&#39;formatter&#39;</span><span class="p">:</span> <span class="s">&#39;standard&#39;</span><span class="p">,</span>
                     <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;INFO&#39;</span><span class="p">,</span>
                     <span class="s">&#39;maxBytes&#39;</span><span class="p">:</span> <span class="mi">1000000</span><span class="p">},</span>
              <span class="s">&#39;syslog&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s">&#39;class&#39;</span><span class="p">:</span> <span class="s">&#39;logging.handlers.SysLogHandler&#39;</span><span class="p">,</span>
                         <span class="s">&#39;formatter&#39;</span><span class="p">:</span> <span class="s">&#39;standard&#39;</span><span class="p">,</span>
                         <span class="s">&#39;level&#39;</span><span class="p">:</span> <span class="s">&#39;ERROR&#39;</span><span class="p">}},</span>

 <span class="c"># Specify all the subordinate loggers</span>
 <span class="s">&#39;loggers&#39;</span><span class="p">:</span> <span class="p">{</span>
             <span class="s">&#39;network&#39;</span><span class="p">:</span> <span class="p">{</span>
                         <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;netlog&#39;</span><span class="p">]</span>
             <span class="p">}</span>
 <span class="p">},</span>
 <span class="c"># Specify properties of the root logger</span>
 <span class="s">&#39;root&#39;</span><span class="p">:</span> <span class="p">{</span>
          <span class="s">&#39;handlers&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;syslog&#39;</span><span class="p">]</span>
 <span class="p">},</span>
<span class="p">}</span>

<span class="c"># Set up configuration</span>
<span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">configdict</span><span class="p">)</span>

<span class="c"># As an example, log two error messages</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Database not found&#39;</span><span class="p">)</span>

<span class="n">netlogger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s">&#39;network&#39;</span><span class="p">)</span>
<span class="n">netlogger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&#39;Connection failed&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>他にも、 <a class="reference internal" href="../library/logging.html#module-logging" title="logging: アプリケーションのための、柔軟なエラーロギングシステム"><tt class="xref py py-mod docutils literal"><span class="pre">logging</span></tt></a> モジュールには Vinary Sajip によって実装された
3 つの改良があります。</p>
<ul class="simple">
<li><a class="reference internal" href="../library/logging.handlers.html#logging.handlers.SysLogHandler" title="logging.handlers.SysLogHandler"><tt class="xref py py-class docutils literal"><span class="pre">SysLogHandler</span></tt></a> クラスは TCP 経由の syslog
をサポートします。コンストラクタの <em>socktype</em> 引数は使用するソケットの種類として、 UDP を使う <a class="reference internal" href="../library/socket.html#socket.SOCK_DGRAM" title="socket.SOCK_DGRAM"><tt class="xref py py-const docutils literal"><span class="pre">socket.SOCK_DGRAM</span></tt></a> と TCP を使う
<a class="reference internal" href="../library/socket.html#socket.SOCK_STREAM" title="socket.SOCK_STREAM"><tt class="xref py py-const docutils literal"><span class="pre">socket.SOCK_STREAM</span></tt></a> のどちらかを取ります。デフォルトはUDPのままです。</li>
<li><a class="reference internal" href="../library/logging.html#logging.Logger" title="logging.Logger"><tt class="xref py py-class docutils literal"><span class="pre">Logger</span></tt></a> インスタンスに <a class="reference internal" href="../library/logging.html#logging.Logger.getChild" title="logging.Logger.getChild"><tt class="xref py py-meth docutils literal"><span class="pre">getChild()</span></tt></a>
メソッドが追加されました。これは、相対パスで下位の logger を返します。例えば、 <tt class="docutils literal"><span class="pre">log</span> <span class="pre">=</span> <span class="pre">getLogger('app')</span></tt> として logger を取得した後、
<tt class="docutils literal"><span class="pre">log.getChild('network.listen')</span></tt> は <tt class="docutils literal"><span class="pre">getLogger('app.network.listen')</span></tt>
と同じになります。</li>
<li><a class="reference internal" href="../library/logging.html#logging.LoggerAdapter" title="logging.LoggerAdapter"><tt class="xref py py-class docutils literal"><span class="pre">LoggerAdapter</span></tt></a> クラスに <tt class="xref py py-meth docutils literal"><span class="pre">isEnabledFor()</span></tt>
メソッドが追加されました。 <em>level</em> を引数に取り、ベースの logger がその重要度レベルのメッセージを処理するかどうかを返します。</li>
</ul>
<div class="admonition- admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-4"></span><a class="pep reference external" href="http://www.python.org/dev/peps/pep-0391"><strong>PEP 391</strong></a> - Dictionary-Based Configuration For Logging</dt>
<dd>PEP written and implemented by Vinay Sajip.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-3106-view">
<h2>PEP 3106: 辞書 View<a class="headerlink" href="#pep-3106-view" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>辞書の <a class="reference internal" href="../library/stdtypes.html#dict.keys" title="dict.keys"><tt class="xref py py-meth docutils literal"><span class="pre">keys()</span></tt></a>, <a class="reference internal" href="../library/stdtypes.html#dict.values" title="dict.values"><tt class="xref py py-meth docutils literal"><span class="pre">values()</span></tt></a>, <a class="reference internal" href="../library/stdtypes.html#dict.items" title="dict.items"><tt class="xref py py-meth docutils literal"><span class="pre">items()</span></tt></a>
メソッドは Python 3.x では動作が代わり、完全に実体化されたリストの代わりに、
<em class="dfn">view</em> と呼ばれるオブジェクトを返すようになりました。</p>
<p>Python 2.7 では、 <a class="reference internal" href="../library/stdtypes.html#dict.keys" title="dict.keys"><tt class="xref py py-meth docutils literal"><span class="pre">keys()</span></tt></a>, <a class="reference internal" href="../library/stdtypes.html#dict.values" title="dict.values"><tt class="xref py py-meth docutils literal"><span class="pre">values()</span></tt></a>, <a class="reference internal" href="../library/stdtypes.html#dict.items" title="dict.items"><tt class="xref py py-meth docutils literal"><span class="pre">items()</span></tt></a>
の動作を変えてしまうと、既存の大量のコードが動かなくなってしまうので、
Python 3.x と同じ動作に合わせることはできません。なので、 Python 3.x のメソッドと同じ動作をするメソッドを、別の
<a class="reference internal" href="../library/stdtypes.html#dict.viewkeys" title="dict.viewkeys"><tt class="xref py py-meth docutils literal"><span class="pre">viewkeys()</span></tt></a>, <a class="reference internal" href="../library/stdtypes.html#dict.viewvalues" title="dict.viewvalues"><tt class="xref py py-meth docutils literal"><span class="pre">viewvalues()</span></tt></a>, <a class="reference internal" href="../library/stdtypes.html#dict.viewitems" title="dict.viewitems"><tt class="xref py py-meth docutils literal"><span class="pre">viewitems()</span></tt></a>
という名前で追加しました。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">65</span><span class="o">+</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">26</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">{0: &#39;A&#39;, 130: &#39;N&#39;, 10: &#39;B&#39;, 140: &#39;O&#39;, 20: ..., 250: &#39;Z&#39;}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">viewkeys</span><span class="p">()</span>
<span class="go">dict_keys([0, 130, 10, 140, 20, 150, 30, ..., 250])</span>
</pre></div>
</div>
<p>View はイテレートするだけでなく、 set と似た利用をすることもできます。
<tt class="docutils literal"><span class="pre">&amp;</span></tt> 演算子で共通部分集合を、 <tt class="docutils literal"><span class="pre">|</span></tt> 演算子で話集合を取ることができます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d1</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="o">*</span><span class="mi">10</span><span class="p">,</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">65</span><span class="o">+</span><span class="n">i</span><span class="p">))</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">26</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d2</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">i</span><span class="o">**.</span><span class="mi">5</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d1</span><span class="o">.</span><span class="n">viewkeys</span><span class="p">()</span> <span class="o">&amp;</span> <span class="n">d2</span><span class="o">.</span><span class="n">viewkeys</span><span class="p">()</span>
<span class="go">set([0.0, 10.0, 20.0, 30.0])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d1</span><span class="o">.</span><span class="n">viewkeys</span><span class="p">()</span> <span class="o">|</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
<span class="go">set([0, 1, 130, 3, 4, 5, 6, ..., 120, 250])</span>
</pre></div>
</div>
<p>view は辞書とその辞書の変化に追随しています。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">vk</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">viewkeys</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vk</span>
<span class="go">dict_keys([0, 130, 10, ..., 250])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="p">[</span><span class="mi">260</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;&amp;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">vk</span>
<span class="go">dict_keys([0, 130, 260, 10, ..., 250])</span>
</pre></div>
</div>
<p>ただし、 view をイテレートしている間に key の追加や削除ができないことに気を付けてください。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">vk</span><span class="p">:</span>
<span class="gp">... </span>    <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="o">*</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
<span class="gp">...</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">&lt;module&gt;</span>
<span class="nc">RuntimeError</span>: <span class="n-Identifier">dictionary changed size during iteration</span>
</pre></div>
</div>
<p>Python 2.x で view メソッドを利用すると、 2to3 が自動的にそれを通常の <a class="reference internal" href="../library/stdtypes.html#dict.keys" title="dict.keys"><tt class="xref py py-meth docutils literal"><span class="pre">keys()</span></tt></a>, <a class="reference internal" href="../library/stdtypes.html#dict.values" title="dict.values"><tt class="xref py py-meth docutils literal"><span class="pre">values()</span></tt></a>, <a class="reference internal" href="../library/stdtypes.html#dict.items" title="dict.items"><tt class="xref py py-meth docutils literal"><span class="pre">items()</span></tt></a>
メソッドに書き換えてくれます。</p>
<div class="admonition- admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-5"></span><a class="pep reference external" href="http://www.python.org/dev/peps/pep-3106"><strong>PEP 3106</strong></a> - Revamping dict.keys(), .values() and .items()</dt>
<dd>PEP written by Guido van Rossum.
Backported to 2.7 by Alexandre Vassalotti; <a class="reference external" href="http://bugs.python.org/issue1967">issue 1967</a>.</dd>
</dl>
</div>
</div>
<div class="section" id="pep-3137-memoryview">
<h2>PEP 3137: memoryview オブジェクト<a class="headerlink" href="#pep-3137-memoryview" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><tt class="xref py py-class docutils literal"><span class="pre">memoryview</span></tt></a> オブジェクトは、他のオブジェクトのメモリの内容に対する
<tt class="xref py py-class docutils literal"><span class="pre">bytes</span></tt> 型のインタフェースに合わせた view を提供します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">string</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">letters</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span>
<span class="go">&lt;memory at 0x37f850&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>           <span class="c"># Returns length of underlying object</span>
<span class="go">52</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">25</span><span class="p">],</span> <span class="n">m</span><span class="p">[</span><span class="mi">26</span><span class="p">]</span>   <span class="c"># Indexing returns one byte</span>
<span class="go">(&#39;a&#39;, &#39;z&#39;, &#39;A&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span> <span class="o">=</span> <span class="n">m</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">26</span><span class="p">]</span>         <span class="c"># Slicing returns another memoryview</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span>
<span class="go">&lt;memory at 0x37f080&gt;</span>
</pre></div>
</div>
<p>view の内容は bytes 型の文字列か整数のリストに変換することができます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">.</span><span class="n">tobytes</span><span class="p">()</span>
<span class="go">&#39;abcdefghijklmnopqrstuvwxyz&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="go">[97, 98, 99, 100, 101, 102, 103, ... 121, 122]</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><tt class="xref py py-class docutils literal"><span class="pre">memoryview</span></tt></a> オブジェクトは、対象となる背後のオブジェクトが変更可能
(mutable) な場合は、その変更を許可しています。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">m2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">75</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">&lt;module&gt;</span>
<span class="nc">TypeError</span>: <span class="n-Identifier">cannot modify read-only memory</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">string</span><span class="o">.</span><span class="n">letters</span><span class="p">)</span>  <span class="c"># Creating a mutable object</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span>
<span class="go">bytearray(b&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#39;)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mb</span> <span class="o">=</span> <span class="n">memoryview</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mb</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span>         <span class="c"># Assign to view, changing the bytearray.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span>              <span class="c"># The bytearray has been changed.</span>
<span class="go">bytearray(b&#39;*bcde&#39;)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<div class="admonition- admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><span class="target" id="index-6"></span><a class="pep reference external" href="http://www.python.org/dev/peps/pep-3137"><strong>PEP 3137</strong></a> - Immutable Bytes and Mutable Buffer</dt>
<dd>PEP written by Guido van Rossum.
Implemented by Travis Oliphant, Antoine Pitrou and others.
Backported to 2.7 by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue2396">issue 2396</a>.</dd>
</dl>
</div>
</div>
<div class="section" id="id1">
<h2>その他の言語の変更<a class="headerlink" href="#id1" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>Python 言語コアにいくつかの小さな変更が加えられました。</p>
<ul>
<li><p class="first">set リテラルのためのシンタックスが Python 3.x からバックポートされました。内容を波括弧で囲うと mutable set になります。 dict リテラルとの区別は、コロンと value が存在しないことで行われます。なので、 <tt class="docutils literal"><span class="pre">{}</span></tt> は引き続き空の dict になります。空の set を作るときには <tt class="docutils literal"><span class="pre">set()</span></tt> を使ってください。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">}</span>
<span class="go">set([1, 2, 3, 4, 5])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">set</span><span class="p">()</span> <span class="c"># empty set</span>
<span class="go">set([])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">{}</span>    <span class="c"># empty dict</span>
<span class="go">{}</span>
</pre></div>
</div>
<p>Backported by Alexandre Vassalotti; <a class="reference external" href="http://bugs.python.org/issue2335">issue 2335</a>.</p>
</li>
<li><p class="first">dict と set の内包表記も Python 3.x からバックポートされました。
list と generator の内包表記を set と dict にも使えるように一般化させています。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">*</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)}</span>
<span class="go">{0: 0, 1: 1, 2: 4, 3: 9, 4: 16, 5: 25}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">{(</span><span class="s">&#39;a&#39;</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">)}</span>
<span class="go">set([&#39;&#39;, &#39;a&#39;, &#39;aa&#39;, &#39;aaa&#39;, &#39;aaaa&#39;, &#39;aaaaa&#39;])</span>
</pre></div>
</div>
</li>
</ul>
<ul>
<li><p class="first"><a class="reference internal" href="../reference/compound_stmts.html#with"><tt class="xref std std-keyword docutils literal"><span class="pre">with</span></tt></a> 文が1つの文で複数のコンテキストマネージャーを使えるようになりました。コンテキストマネージャーは左から右へ処理され、それぞれが新しい <a class="reference internal" href="../reference/compound_stmts.html#with"><tt class="xref std std-keyword docutils literal"><span class="pre">with</span></tt></a>
文の開始となるように扱われます。つまり:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">A</span><span class="p">()</span> <span class="k">as</span> <span class="n">a</span><span class="p">,</span> <span class="n">B</span><span class="p">()</span> <span class="k">as</span> <span class="n">b</span><span class="p">:</span>
    <span class="o">...</span> <span class="n">suite</span> <span class="n">of</span> <span class="n">statements</span> <span class="o">...</span>
</pre></div>
</div>
<p>このコードは、次のコードと等しくなります:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="n">A</span><span class="p">()</span> <span class="k">as</span> <span class="n">a</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">B</span><span class="p">()</span> <span class="k">as</span> <span class="n">b</span><span class="p">:</span>
        <span class="o">...</span> <span class="n">suite</span> <span class="n">of</span> <span class="n">statements</span> <span class="o">...</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/contextlib.html#contextlib.nested" title="contextlib.nested"><tt class="xref py py-func docutils literal"><span class="pre">contextlib.nested()</span></tt></a> 関数は非常に似た機能を提供していたので、もう必要なくなり廃止予定となりました。</p>
<p>(Proposed in <a class="reference external" href="http://codereview.appspot.com/53094">http://codereview.appspot.com/53094</a>; implemented by
Georg Brandl.)</p>
</li>
<li><p class="first">浮動小数点数と文字列の間の変換がほとんどのプラットフォームで正しく丸められるようになりました。この変換はいろいろな場面で発生します:
float 型や complex 型に対する <a class="reference internal" href="../library/functions.html#str" title="str"><tt class="xref py py-func docutils literal"><span class="pre">str()</span></tt></a> 関数の適用、数値フォーマット、 <a class="reference internal" href="../library/marshal.html#module-marshal" title="marshal: Python オブジェクトをバイト列に変換したり、その逆を (異なる制約条件下で) 行います。"><tt class="xref py py-mod docutils literal"><span class="pre">marshal</span></tt></a>, <a class="reference internal" href="../library/pickle.html#module-pickle" title="pickle: Python オブジェクトからバイトストリームへの変換、およびその逆。"><tt class="xref py py-mod docutils literal"><span class="pre">pickle</span></tt></a>, <a class="reference internal" href="../library/json.html#module-json" title="json: JSON 形式のエンコードおよびデコード"><tt class="xref py py-mod docutils literal"><span class="pre">json</span></tt></a>
モジュールを使ってのシリアライズとデシリアライズ、
Python コード中の float や imaginary リテラルの解析、
<a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt></a> から float への変換などです。</p>
<p>これに関連して、 浮動小数点数 <em>x</em> の <a class="reference internal" href="../library/repr.html#module-repr" title="repr: 大きさに制限のある別のrepr()の実装。"><tt class="xref py py-func docutils literal"><span class="pre">repr()</span></tt></a> は、 (round-half-to-even
丸めモードで)正しく丸め処理をした場合に元の <em>x</em> に戻せる最小の
10進文字列になりました。以前は <em>x</em> を17桁の10進文字列に丸めていました。</p>
<p>丸めライブラリが、この改善が Windows や gcc, icc, suncc を使った
Unix 環境で動かす役目をおっています。このライブラリの正確な動作が保証できない少しの環境があるので、そういったシステムではこのライブラリは利用されません。 <a class="reference internal" href="../library/sys.html#sys.float_repr_style" title="sys.float_repr_style"><tt class="xref py py-data docutils literal"><span class="pre">sys.float_repr_style</span></tt></a> が <tt class="docutils literal"><span class="pre">short</span></tt>
なら新しいコードが利用されていて、 <tt class="docutils literal"><span class="pre">legacy</span></tt> なら利用されていません。</p>
<p>Implemented by Eric Smith and Mark Dickinson, using David Gay&#8217;s
<tt class="file docutils literal"><span class="pre">dtoa.c</span></tt> library; <a class="reference external" href="http://bugs.python.org/issue7117">issue 7117</a>.</p>
</li>
<li><p class="first">多倍長整数や通常の整数から浮動小数点への変換でも丸め処理が変更され、元の数に一番近い浮動小数点値が返されるようになりました。これは浮動小数点へ完全に変換できる小さい整数では問題になりませんが、桁数に対して精度がどうしても足りない場合に関係します。
Python 2.7 はより正確に近似するようになりました。例えば、 Python 2.6
では次のように計算されていました:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">295147905179352891391</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="go">2.9514790517935283e+20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">-</span> <span class="nb">long</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="go">65535L</span>
</pre></div>
</div>
<p>Python 2.7 の浮動小数点への変換結果は元の数値より大きくなりますが、元の値により近くなっています:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">295147905179352891391</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="go">2.9514790517935289e+20</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">-</span> <span class="nb">long</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
<span class="go">-1L</span>
</pre></div>
</div>
<p>(Implemented by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue3166">issue 3166</a>.)</p>
<p>この丸めの動作により、整数同士の true division (<tt class="docutils literal"><span class="pre">from</span> <span class="pre">__future__</span> <span class="pre">import</span> <span class="pre">division</span></tt>)
の結果もより正確になりました。
(Also implemented by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue1811">issue 1811</a>.)</p>
</li>
<li><p class="first">複素数に対する暗黙の型強制は削除されました。インタプリタは complex オブジェクトに対して
<a class="reference internal" href="../reference/datamodel.html#object.__coerce__" title="object.__coerce__"><tt class="xref py py-meth docutils literal"><span class="pre">__coerce__()</span></tt></a> メソッドを呼び出そうとしません。
(Removed by Meador Inge and Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue5211">issue 5211</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><tt class="xref py py-meth docutils literal"><span class="pre">str.format()</span></tt></a> メソッドは置換フィールドに対する自動ナンバリングをサポートするようになりました。これにより <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><tt class="xref py py-meth docutils literal"><span class="pre">str.format()</span></tt></a> をより <tt class="docutils literal"><span class="pre">%s</span></tt> と同じように使えるようになりました。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;{}:{}:{}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mo">04</span><span class="p">,</span> <span class="s">&#39;Sunday&#39;</span><span class="p">)</span>
<span class="go">&#39;2009:4:Sunday&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="s">&#39;{}:{}:{day}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="mi">2009</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">day</span><span class="o">=</span><span class="s">&#39;Sunday&#39;</span><span class="p">)</span>
<span class="go">&#39;2009:4:Sunday&#39;</span>
</pre></div>
</div>
<p>自動ナンバリングは左のフィールドから右のフィールドへと行われるので、最初の <tt class="docutils literal"><span class="pre">{...}</span></tt> 指定は <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><tt class="xref py py-meth docutils literal"><span class="pre">str.format()</span></tt></a> メソッドの最初の引数を利用し、次の指定は次の引数を利用します。自動ナンバリングと明示的なナンバリングを混ぜて使うことはできず、全ての置換指定に手動でナンバリングするか、全てを自動ナンバリングに任せなければなりません。ただし、上の例の2つめのように、自動ナンバリングと名前フィールドを混ぜて使うことは可能です。
(Contributed by Eric Smith; <a class="reference external" href="http://bugs.python.org/issue5237">issue 5237</a>.)</p>
<p>複素数が <a class="reference internal" href="../library/functions.html#format" title="format"><tt class="xref py py-func docutils literal"><span class="pre">format()</span></tt></a> をサポートするようになりました。デフォルトでは右寄せになります。精度やカンマ区切りの指定は、実部と虚部のそれぞれに対して適用されます。アラインの指定は <tt class="docutils literal"><span class="pre">1.5+3j</span></tt> のような複素数全体に対して適用されます。
(Contributed by Eric Smith; <a class="reference external" href="http://bugs.python.org/issue1588">issue 1588</a> and <a class="reference external" href="http://bugs.python.org/issue7988">issue 7988</a>.)</p>
<p>&#8216;F&#8217; 書式符号は常に大文字を使って出力するようになり、
&#8216;INF&#8217; や &#8216;NAN&#8217; が出力されるようになりました。
(Contributed by Eric Smith; <a class="reference external" href="http://bugs.python.org/issue3382">issue 3382</a>.)</p>
<p>低レベルな変更: <tt class="xref py py-meth docutils literal"><span class="pre">object.__format__()</span></tt> メソッドは <a class="reference internal" href="../library/exceptions.html#exceptions.PendingDeprecationWarning" title="exceptions.PendingDeprecationWarning"><tt class="xref py py-exc docutils literal"><span class="pre">PendingDeprecationWarning</span></tt></a>
を発生させるようになりました。 <a class="reference internal" href="../library/functions.html#object" title="object"><tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></a> に対する <tt class="xref py py-meth docutils literal"><span class="pre">__format__()</span></tt>
メソッドはオブジェクトを文字列表現に変換してそれをフォーマットするからです。以前は、このメソッドは書式文字列を受け取り文字列表現を返していましたが、この仕様は Python コードのミスを隠してしまう可能性がありました。アライメントや精度のようなフォーマット指定情報を渡した時、そのなにかそのオブジェクトに合ったフォーマットがあることを期待しているはずなのに、 <tt class="xref py py-meth docutils literal"><span class="pre">object.__format__()</span></tt> メソッドはそれを無視します。
(Fixed by Eric Smith; <a class="reference external" href="http://bugs.python.org/issue7994">issue 7994</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/functions.html#int" title="int"><tt class="xref py py-func docutils literal"><span class="pre">int()</span></tt></a> と <a class="reference internal" href="../library/functions.html#long" title="long"><tt class="xref py py-func docutils literal"><span class="pre">long()</span></tt></a> 型に <tt class="docutils literal"><span class="pre">bit_length</span></tt> メソッドが追加されました。このメソッドはその値を2進数で表現したときに何ビット必要になるかを返します:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">37</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">bin</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="go">&#39;0b100101&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
<span class="go">6</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">123</span><span class="o">-</span><span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">n</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
<span class="go">123</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">bit_length</span><span class="p">()</span>
<span class="go">124</span>
</pre></div>
</div>
<p>(Contributed by Fredrik Johansson and Victor Stinner; <a class="reference external" href="http://bugs.python.org/issue3439">issue 3439</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../reference/simple_stmts.html#import"><tt class="xref std std-keyword docutils literal"><span class="pre">import</span></tt></a> 文が、絶対インポート (例: <tt class="docutils literal"><span class="pre">from</span> <span class="pre">.os</span> <span class="pre">import</span> <span class="pre">sep</span></tt>) が失敗したときに相対インポートを試さなくなりました。これはバグ修正ですが、いままでたまたま動いていただけの <a class="reference internal" href="../reference/simple_stmts.html#import"><tt class="xref std std-keyword docutils literal"><span class="pre">import</span></tt></a>
文を動かなくしてしまう可能性があります。(Fixed by Meador Inge;
<a class="reference external" href="http://bugs.python.org/issue7902">issue 7902</a>.)</p>
</li>
<li><p class="first">ビルトインの <a class="reference internal" href="../library/functions.html#unicode" title="unicode"><tt class="xref py py-class docutils literal"><span class="pre">unicode</span></tt></a> 型のサブクラスが <a class="reference internal" href="../reference/datamodel.html#object.__unicode__" title="object.__unicode__"><tt class="xref py py-meth docutils literal"><span class="pre">__unicode__()</span></tt></a> メソッドをオーバーライドできるようになりました。(Implemented by
Victor Stinner; <a class="reference external" href="http://bugs.python.org/issue1583863">issue 1583863</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/functions.html#bytearray" title="bytearray"><tt class="xref py py-class docutils literal"><span class="pre">bytearray</span></tt></a> 型の <tt class="xref py py-meth docutils literal"><span class="pre">translate()</span></tt> メソッドが第一引数に
<tt class="docutils literal"><span class="pre">None</span></tt> を受け入れるようになりました。 (Fixed by Georg Brandl;
<a class="reference external" href="http://bugs.python.org/issue4759">issue 4759</a>.)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">&#64;classmethod</span></tt> や <tt class="docutils literal"><span class="pre">&#64;staticmethod</span></tt> を使ってクラスメソッドやスタティックメソッドを作成した時、そのラッパーオブジェクトがラップ対象となる関数を <tt class="xref py py-attr docutils literal"><span class="pre">__func__</span></tt> 属性で公開するようになりました。(Contributed by Amaury Forgeot d&#8217;Arc, after a suggestion by
George Sakkis; <a class="reference external" href="http://bugs.python.org/issue5982">issue 5982</a>.)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">__slots__</span></tt> を利用して属性を制限した場合に、設定されていない属性を
del したときに <a class="reference internal" href="../library/exceptions.html#exceptions.AttributeError" title="exceptions.AttributeError"><tt class="xref py py-exc docutils literal"><span class="pre">AttributeError</span></tt></a> にならなかったのを修正しました。
(Fixed by Benjamin Peterson; <a class="reference external" href="http://bugs.python.org/issue7604">issue 7604</a>.)</p>
</li>
<li><p class="first">2つの新しいエンコーディングが追加されました: &#8220;cp720&#8221; は主にアラビア文字に使われます。 &#8220;cp858&#8221; は cp850 の一種ですが、ユーロ記号を追加しています。
(CP720 contributed by Alexander Belchenko and Amaury
Forgeot d&#8217;Arc in <a class="reference external" href="http://bugs.python.org/issue1616979">issue 1616979</a>; CP858 contributed by Tim Hatch in
<a class="reference external" href="http://bugs.python.org/issue8016">issue 8016</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/functions.html#file" title="file"><tt class="xref py py-class docutils literal"><span class="pre">file</span></tt></a> オブジェクトは、POSIX環境に置いてディレクトリを開こうとした時に発生する <a class="reference internal" href="../library/exceptions.html#exceptions.IOError" title="exceptions.IOError"><tt class="xref py py-exc docutils literal"><span class="pre">IOError</span></tt></a> 例外に <tt class="xref py py-attr docutils literal"><span class="pre">filename</span></tt> 属性を設定するようになりました。
(noted by Jan Kaliszewski; <a class="reference external" href="http://bugs.python.org/issue4764">issue 4764</a>)
また、読み取りのみのファイルに対する書き込みを、Cライブラリ側のエラー検出・報告に頼るのではなく、明示的にチェックするようになりました。
(fixed by Stefan Krah; <a class="reference external" href="http://bugs.python.org/issue5677">issue 5677</a>).</p>
</li>
<li><p class="first">Python の字句解析機は改行をそれ自身に変換するようになりました。それにより、組み込みの <a class="reference internal" href="../library/functions.html#compile" title="compile"><tt class="xref py py-func docutils literal"><span class="pre">compile()</span></tt></a> 関数がどの改行コードを利用したコードでも受け付けるようになりました。また、コードの終端の改行も不要になりました。</p>
</li>
<li><p class="first">関数宣言中の余分な丸括弧は Python 3.x では不正になりました。つまり、 <tt class="docutils literal"><span class="pre">def</span> <span class="pre">f((x)):</span> <span class="pre">pass</span></tt> はsyntax errorになります。
Python3 警告モードでは、 Python 2.7 はこの利用方法について警告を出すようになりました。
(Noted by James Lingard; <a class="reference external" href="http://bugs.python.org/issue7362">issue 7362</a>.)</p>
</li>
<li><p class="first">古いスタイルのクラスのオブジェクトに対して弱参照を作れるようになりました。新スタイルクラスには以前から弱参照を利用できます。(Fixed
by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue8268">issue 8268</a>.)</p>
</li>
<li><p class="first">モジュールオブジェクトがGCされたとき、モジュールの辞書は、他にその辞書への参照を持っているものがない場合にのみクリアされるようになりました。(<a class="reference external" href="http://bugs.python.org/issue7140">issue 7140</a>).</p>
</li>
</ul>
<span class="target" id="new-27-interpreter"></span><div class="section" id="id2">
<h3>インタプリタの変更<a class="headerlink" href="#id2" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>新しい環境変数 <span class="target" id="index-7"></span><a class="reference internal" href="../using/cmdline.html#envvar-PYTHONWARNINGS"><tt class="xref std std-envvar docutils literal"><span class="pre">PYTHONWARNINGS</span></tt></a> を使って警告を制御できるようになりました。この環境変数には、 <a class="reference internal" href="../using/cmdline.html#cmdoption-W"><em class="xref std std-option">-W</em></a> スイッチに使われる警告の設定を、カンマ区切りの文字列として指定します。
(Contributed by Brian Curtin; <a class="reference external" href="http://bugs.python.org/issue7301">issue 7301</a>.)</p>
<p>例えば、以下の設定は警告が発生するたびにそれを表示しますが、
<a class="reference internal" href="../library/cookie.html#module-Cookie" title="Cookie: HTTP状態管理(cookies)のサポート。"><tt class="xref py py-mod docutils literal"><span class="pre">Cookie</span></tt></a> モジュールからの警告はエラーにします。
(環境変数を設定するための文法はOSとシェルに依存します)</p>
<div class="highlight-python"><pre>export PYTHONWARNINGS=all,error:::Cookie:0</pre>
</div>
</div>
<div class="section" id="id3">
<h3>最適化<a class="headerlink" href="#id3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>いくつかの場面でパフォーマンスが向上しています。</p>
<ul>
<li><p class="first"><a class="reference internal" href="../reference/compound_stmts.html#with"><tt class="xref std std-keyword docutils literal"><span class="pre">with</span></tt></a> 文の初期セットアップを行うための新しいオペコードが追加されました。
<a class="reference internal" href="../reference/datamodel.html#object.__enter__" title="object.__enter__"><tt class="xref py py-meth docutils literal"><span class="pre">__enter__()</span></tt></a> と <a class="reference internal" href="../reference/datamodel.html#object.__exit__" title="object.__exit__"><tt class="xref py py-meth docutils literal"><span class="pre">__exit__()</span></tt></a> メソッドの検索を行います。
(Contributed by Benjamin Peterson.)</p>
</li>
<li><p class="first">たくさんのオブジェクトを開放せずに確保していくという、よくある使い方の
1つにおいて、GCのパフォーマンスが向上しました。以前はこの場合にGCにかかる時間はオブジェクトの数の2乗に比例していました。現在はフルGCの数は増えたヒープ上のオブジェクトの数に比例しています。新しい方式では、3世代中2世代目に対するGCが10回実行されたうえで、
2世代目から3世代目に移ったオブジェクトの数が3世代目のオブジェクトの数の
10%を超えたときにフルGCが発生します。(Suggested by Martin
von Löwis and implemented by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue4074">issue 4074</a>.)</p>
</li>
<li><p class="first">GCが循環参照になりえないシンプルなコンテナ型の追跡を避けるようになりました。
Python 2.7 では、アトミックな型(整数、文字列など)のみを含むタプルと辞書は追跡されません。推移的に、アトミックな型のみを含むタプルを含む辞書も、同じく追跡されません。これにより、GCによって巡回されチェックされるオブジェクトの数が減るので、
GCのコストを減らすことができます。
(Contributed by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue4688">issue 4688</a>.)</p>
</li>
<li><p class="first">多倍長整数の内部格納方式が、 2**15 ベースと 2**30 ベースのどちらかをビルド時に選択するようになりました。以前は常に 2**15 ベースで格納していました。
2**30 ベースにすると 64bit マシンに置いては確実にパフォーマンスが向上しますが、
32bit マシンではパフォーマンスが向上する場合も低下する場合もあります。なので、デフォルトでは 64bit マシンでは 2**30 ベースで、 32bit マシンでは
2**15 ベースになるようになります。
Unix では新しい configure オプションとして <em class="xref std std-option">--enable-big-digis</em>
が追加され、このデフォルトの選択をオーバーライドできるようになっています。</p>
<p>この変更はパフォーマンスの向上以外の形ではユーザーに見えないはずですが、
1つだけ例外があります。テストとデバッグを目的として、 <a class="reference internal" href="../library/sys.html#sys.long_info" title="sys.long_info"><tt class="xref py py-data docutils literal"><span class="pre">sys.long_info</span></tt></a>
というデータが追加され、内部フォーマットとして digit あたりのビット数と、それに使うCのデータ型のバイト数の情報を提供します:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">long_info</span>
<span class="go">sys.long_info(bits_per_digit=30, sizeof_digit=4)</span>
</pre></div>
</div>
<p>(Contributed by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue4258">issue 4258</a>.)</p>
<p>その他の変更により、多倍長整数オブジェクトのサイズは数バイト小さくなりました。
32bit システムでは 2byte, 64bit システムでは 6byte 小さくなりました。
(Contributed by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue5260">issue 5260</a>.)</p>
</li>
<li><p class="first">多倍長整数の除算アルゴリズムが、内部のループの軽量化や乗算からシフト演算への置き換え、不要なイテレーションの削除により高速化されました。いくつかのベンチマークによると、多倍長整数の剰余演算は 50% から 150% 高速化されています。
(Contributed by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue5512">issue 5512</a>.)
ビット演算も高速化されています。(initial patch by
Gregory Smith; <a class="reference external" href="http://bugs.python.org/issue1087418">issue 1087418</a>)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">%</span></tt> の実装が、左側のオペランドが文字列型かどうかをチェックしてその場合の処理を特殊化しました。これにより文字列に対して <tt class="docutils literal"><span class="pre">%</span></tt> を頻繁に使う、テンプレートライブラリなどのアプリケーションのパフォーマンスが1-3%向上します。
(Implemented by Collin Winter; <a class="reference external" href="http://bugs.python.org/issue5176">issue 5176</a>.)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">if</span></tt> 条件付きのリスト内包表記がより高速なバイトコードにコンパイルされるようになりました。(Patch by Antoine Pitrou, back-ported to 2.7
by Jeffrey Yasskin; <a class="reference external" href="http://bugs.python.org/issue4715">issue 4715</a>.)</p>
</li>
<li><p class="first">整数や多倍長整数から10進文字列への変換を、任意の基数をサポートした汎用の変換関数を使う代わりに10進数に特殊化した処理を行うことで高速化しました。
(Patch by Gawain Bolton; <a class="reference external" href="http://bugs.python.org/issue6713">issue 6713</a>.)</p>
</li>
<li><p class="first">文字列等(str, unicode, <a class="reference internal" href="../library/functions.html#bytearray" title="bytearray"><tt class="xref py py-class docutils literal"><span class="pre">bytearray</span></tt></a>) の
<tt class="xref py py-meth docutils literal"><span class="pre">split()</span></tt>, <tt class="xref py py-meth docutils literal"><span class="pre">replace()</span></tt>, <tt class="xref py py-meth docutils literal"><span class="pre">rindex()</span></tt>, <tt class="xref py py-meth docutils literal"><span class="pre">rpartition()</span></tt>,
<tt class="xref py py-meth docutils literal"><span class="pre">rsplit()</span></tt> メソッドが、1文字ずつのスキャンの代わりに高速な逆方向スキャンアルゴリズムを使うようになりました。これにより、場合によっては10倍レベルの高速化になります。(Added by
Florent Xicluna; <a class="reference external" href="http://bugs.python.org/issue7462">issue 7462</a> and <a class="reference external" href="http://bugs.python.org/issue7622">issue 7622</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/pickle.html#module-pickle" title="pickle: Python オブジェクトからバイトストリームへの変換、およびその逆。"><tt class="xref py py-mod docutils literal"><span class="pre">pickle</span></tt></a> と <a class="reference internal" href="../library/pickle.html#module-cPickle" title="cPickle: pickle の高速バージョンですが、サブクラスはできません。"><tt class="xref py py-mod docutils literal"><span class="pre">cPickle</span></tt></a> モジュールが、属性名に使われている文字列を自動的にインターンするようになりました。これにより unpickle 後のオブジェクトのメモリ使用量が減ります。(Contributed by Jake
McGuire; <a class="reference external" href="http://bugs.python.org/issue5084">issue 5084</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/pickle.html#module-cPickle" title="cPickle: pickle の高速バージョンですが、サブクラスはできません。"><tt class="xref py py-mod docutils literal"><span class="pre">cPickle</span></tt></a> モジュールが辞書に対する特殊化を行い、 pickle にかかる時間をおよそ半分に減らしました。
(Contributed by Collin Winter; <a class="reference external" href="http://bugs.python.org/issue5670">issue 5670</a>.)</p>
</li>
</ul>
</div>
</div>
<div class="section" id="id4">
<h2>新しいモジュールと改良されたモジュール<a class="headerlink" href="#id4" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>全てのリリースに置いて、 Python の標準ライブラリはたくさんの改良とバグ修正がされてきました。ここでは一部の注目に値する変更を、モジュール名で辞書順ソートしてリストアップしています。可燃な変更が見たければ、ソースツリー内の <tt class="file docutils literal"><span class="pre">Misc/NEWS</span></tt> ファイルか、全ての完全な詳細が入っている Subversion のログを参照してください。</p>
<ul>
<li><p class="first"><a class="reference internal" href="../library/bdb.html#module-bdb" title="bdb: デバッガーフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">bdb</span></tt></a> モジュールの基底デバッガクラス <a class="reference internal" href="../library/bdb.html#bdb.Bdb" title="bdb.Bdb"><tt class="xref py py-class docutils literal"><span class="pre">Bdb</span></tt></a> に、モジュールをスキップする機能が追加されました。コンストラクタは
<tt class="docutils literal"><span class="pre">django.*</span></tt> のような glob スタイルのパターンをもった iterable を引数として受け取ります。デバッガはパターンのどれかにマッチするスタックフレームにステップインしません。
(Contributed by Maru Newby after a suggestion by
Senthil Kumaran; <a class="reference external" href="http://bugs.python.org/issue5142">issue 5142</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/binascii.html#module-binascii" title="binascii: バイナリと各種 ASCII コード化バイナリ表現との間の\ 変換を行うツール群。"><tt class="xref py py-mod docutils literal"><span class="pre">binascii</span></tt></a> モジュールが buffer API をサポートするようになり、
<a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><tt class="xref py py-class docutils literal"><span class="pre">memoryview</span></tt></a> インスタンスやその他のバッファオブジェクトともに利用できるようになりました。
(Backported from 3.x by Florent Xicluna; <a class="reference external" href="http://bugs.python.org/issue7703">issue 7703</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/bsddb.html#module-bsddb" title="bsddb: Berkeley DB ライブラリへのインタフェース"><tt class="xref py py-mod docutils literal"><span class="pre">bsddb</span></tt></a> モジュールが
<a class="reference external" href="http://www.jcea.es/programacion/pybsddb.htm">the pybsddb package</a>
の 4.7.2devel9 から 4.8.4 に更新されました。新しいバージョンはより Python 3.x との互換性がよくなり、いくつかのバグ修正と、いくつかの新しい BerkeleyDB のフラグとメソッドが追加されています。
(Updated by Jesús Cea Avión; <a class="reference external" href="http://bugs.python.org/issue8156">issue 8156</a>.  The pybsddb
changelog can be read at <a class="reference external" href="http://hg.jcea.es/pybsddb/file/tip/ChangeLog">http://hg.jcea.es/pybsddb/file/tip/ChangeLog</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/bz2.html#module-bz2" title="bz2: bzip2 互換の圧縮／解凍ルーチンへのインタフェース"><tt class="xref py py-mod docutils literal"><span class="pre">bz2</span></tt></a> モジュールの <a class="reference internal" href="../library/bz2.html#bz2.BZ2File" title="bz2.BZ2File"><tt class="xref py py-class docutils literal"><span class="pre">BZ2File</span></tt></a> がコンテキストマネージャープロトコルをサポートするようになりました。これにより、
<tt class="docutils literal"><span class="pre">with</span> <span class="pre">bz2.BZ2File(...)</span> <span class="pre">as</span> <span class="pre">f:</span></tt> といった書き方ができます。
(Contributed by Hagen Fürstenau; <a class="reference external" href="http://bugs.python.org/issue3860">issue 3860</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/collections.html#module-collections" title="collections: High-performance container datatypes"><tt class="xref py py-mod docutils literal"><span class="pre">collections</span></tt></a> モジュールの新しい <a class="reference internal" href="../library/collections.html#collections.Counter" title="collections.Counter"><tt class="xref py py-class docutils literal"><span class="pre">Counter</span></tt></a> クラスは、データの数え上げをするときに便利です。
<a class="reference internal" href="../library/collections.html#collections.Counter" title="collections.Counter"><tt class="xref py py-class docutils literal"><span class="pre">Counter</span></tt></a> インスタンスは辞書のように振る舞いますが、キーが存在しなかったときに <a class="reference internal" href="../library/exceptions.html#exceptions.KeyError" title="exceptions.KeyError"><tt class="xref py py-exc docutils literal"><span class="pre">KeyError</span></tt></a> 例外を発生させる代わりに 0 を返します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="s">&#39;here is a sample of english text&#39;</span><span class="p">:</span>
<span class="gp">... </span>  <span class="n">c</span><span class="p">[</span><span class="n">letter</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="gp">...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span>
<span class="go">Counter({&#39; &#39;: 6, &#39;e&#39;: 5, &#39;s&#39;: 3, &#39;a&#39;: 2, &#39;i&#39;: 2, &#39;h&#39;: 2,</span>
<span class="go">&#39;l&#39;: 2, &#39;t&#39;: 2, &#39;g&#39;: 1, &#39;f&#39;: 1, &#39;m&#39;: 1, &#39;o&#39;: 1, &#39;n&#39;: 1,</span>
<span class="go">&#39;p&#39;: 1, &#39;r&#39;: 1, &#39;x&#39;: 1})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="p">[</span><span class="s">&#39;e&#39;</span><span class="p">]</span>
<span class="go">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">c</span><span class="p">[</span><span class="s">&#39;z&#39;</span><span class="p">]</span>
<span class="go">0</span>
</pre></div>
</div>
</li>
</ul>
<ul>
<li><p class="first"><a class="reference internal" href="../library/configparser.html#module-ConfigParser" title="ConfigParser: Configuration file parser."><tt class="xref py py-mod docutils literal"><span class="pre">ConfigParser</span></tt></a> モジュールのパーサークラスのコンストラクタが
<em>allow_no_value</em> 引数を受け取るようになりました。これはデフォルトでは False です。真の場合、値のないオプションが利用できるようになります。例えば:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">ConfigParser</span><span class="o">,</span> <span class="nn">StringIO</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sample_config</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;</span>
<span class="gp">... </span><span class="s">[mysqld]</span>
<span class="gp">... </span><span class="s">user = mysql</span>
<span class="gp">... </span><span class="s">pid-file = /var/run/mysqld/mysqld.pid</span>
<span class="gp">... </span><span class="s">skip-bdb</span>
<span class="gp">... </span><span class="s">&quot;&quot;&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span> <span class="o">=</span> <span class="n">ConfigParser</span><span class="o">.</span><span class="n">RawConfigParser</span><span class="p">(</span><span class="n">allow_no_value</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="o">.</span><span class="n">readfp</span><span class="p">(</span><span class="n">StringIO</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">sample_config</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;mysqld&#39;</span><span class="p">,</span> <span class="s">&#39;user&#39;</span><span class="p">)</span>
<span class="go">&#39;mysql&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;mysqld&#39;</span><span class="p">,</span> <span class="s">&#39;skip-bdb&#39;</span><span class="p">)</span>
<span class="go">None</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;mysqld&#39;</span><span class="p">,</span> <span class="s">&#39;unknown&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  <span class="c">...</span>
<span class="nc">NoOptionError: No option &#39;unknown&#39; in section</span>: <span class="n-Identifier">&#39;mysqld&#39;</span>
</pre></div>
</div>
<p>(Contributed by Mats Kindahl; <a class="reference external" href="http://bugs.python.org/issue7005">issue 7005</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/contextlib.html#contextlib.nested" title="contextlib.nested"><tt class="xref py py-func docutils literal"><span class="pre">contextlib.nested()</span></tt></a> 関数が廃止予定になりました。これは1つの <a class="reference internal" href="../reference/compound_stmts.html#with"><tt class="xref std std-keyword docutils literal"><span class="pre">with</span></tt></a>
文で1つ以上のコンテキストマネージャーを扱うためのものでしたが、 <a class="reference internal" href="../reference/compound_stmts.html#with"><tt class="xref std std-keyword docutils literal"><span class="pre">with</span></tt></a>
文が複数のコンテキストマネージャーをサポートするようになりました。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/cookielib.html#module-cookielib" title="cookielib: HTTP cookie を自動的に処理するためのクラスライブラリ"><tt class="xref py py-mod docutils literal"><span class="pre">cookielib</span></tt></a> モジュールが不正な、値が整数値ではないバージョンフィールドを持つ cookie を無視するようになりました。(Fixed by
John J. Lee; <a class="reference external" href="http://bugs.python.org/issue3924">issue 3924</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/copy.html#module-copy" title="copy: 浅いコピーおよび深いコピー操作。"><tt class="xref py py-mod docutils literal"><span class="pre">copy</span></tt></a> モジュールの <a class="reference internal" href="../library/copy.html#copy.deepcopy" title="copy.deepcopy"><tt class="xref py py-func docutils literal"><span class="pre">deepcopy()</span></tt></a> 関数が、束縛ずみインスタンスメソッドを正しくコピーするようになりました。(Implemented by
Robert Collins; <a class="reference external" href="http://bugs.python.org/issue1515">issue 1515</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/ctypes.html#module-ctypes" title="ctypes: A foreign function library for Python."><tt class="xref py py-mod docutils literal"><span class="pre">ctypes</span></tt></a> モジュールが、ポインタとして宣言された引数に対して <tt class="docutils literal"><span class="pre">None</span></tt>
が渡された場合常に C の NULL ポインタに変換するようになりました。(Changed by Thomas
Heller; <a class="reference external" href="http://bugs.python.org/issue4606">issue 4606</a>.) 基盤となっている <a class="reference external" href="http://sourceware.org/libffi/">libffi ライブラリ</a> が 3.0.9 にアップデートされ、いくつかのプラットフォームにおけるいろいろな問題が修正されました。(Updated
by Matthias Klose; <a class="reference external" href="http://bugs.python.org/issue8142">issue 8142</a>.)</p>
</li>
<li><p class="first">新しいメソッド: <a class="reference internal" href="../library/datetime.html#module-datetime" title="datetime: 基本的な日付型および時間型。"><tt class="xref py py-mod docutils literal"><span class="pre">datetime</span></tt></a> モジュールの <a class="reference internal" href="../library/datetime.html#datetime.timedelta" title="datetime.timedelta"><tt class="xref py py-class docutils literal"><span class="pre">timedelta</span></tt></a> クラスに
<a class="reference internal" href="../library/datetime.html#datetime.timedelta.total_seconds" title="datetime.timedelta.total_seconds"><tt class="xref py py-meth docutils literal"><span class="pre">total_seconds()</span></tt></a> メソッドが追加されました。これはその期間の秒数を返します。(Contributed by Brian Quinlan; <a class="reference external" href="http://bugs.python.org/issue5788">issue 5788</a>.)</p>
</li>
<li><p class="first">新しいメソッド: <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt></a> クラスに、浮動小数点数から
<a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt></a> への正確な変換を行う <a class="reference internal" href="../library/decimal.html#decimal.Decimal.from_float" title="decimal.Decimal.from_float"><tt class="xref py py-meth docutils literal"><span class="pre">from_float()</span></tt></a>
クラスメソッドが追加されました。この正確な変換は、浮動小数点数が示す値に一番近い近似となる10進数を求めます。なので、このメソッドを使ったとしてもある程度の誤差は残ります。例えば、 <tt class="docutils literal"><span class="pre">Decimal.from_float(0.1)</span></tt> は
<tt class="docutils literal"><span class="pre">Decimal('0.1000000000000000055511151231257827021181583404541015625')</span></tt>
を返します。
(Implemented by Raymond Hettinger; <a class="reference external" href="http://bugs.python.org/issue4796">issue 4796</a>.)</p>
<p><a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt></a> のインスタンスと浮動小数点数の比較は、オペランドの値に応じた賢い結果を返すようになりました。以前はこの比較は Python のデフォルトのオブジェクト比較にフォールバックし、オペランドの型に応じて不定な結果が返されていました。ただし、 <tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt> と浮動小数点数を加算などの他の演算で組み合わせることはいまでも許可されていません。浮動小数点数と <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt></a> の間の変換方法を明示的に指定するべきです。(Fixed by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue2531">issue 2531</a>.)</p>
<p><a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt></a> のコンストラクタが浮動小数点数を受け入れるようになりました。
(added by Raymond Hettinger; <a class="reference external" href="http://bugs.python.org/issue8257">issue 8257</a>)
また、アラビア・インド数字などの、ヨーロッパ以外の Unicode 文字も受け入れるようになりました。
(contributed by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue6595">issue 6595</a>).</p>
<p><a class="reference internal" href="../library/decimal.html#decimal.Context" title="decimal.Context"><tt class="xref py py-class docutils literal"><span class="pre">Context</span></tt></a> クラスのほとんどのメソッドが <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt></a>
インスタンスと同じく整数を受け入れるようになりました。例外は <tt class="xref py py-meth docutils literal"><span class="pre">caonical()</span></tt> と <a class="reference internal" href="../library/decimal.html#decimal.Context.is_canonical" title="decimal.Context.is_canonical"><tt class="xref py py-meth docutils literal"><span class="pre">is_canonical()</span></tt></a>
メソッドだけです。 (Patch by Juan José Conti; <a class="reference external" href="http://bugs.python.org/issue7633">issue 7633</a>.)</p>
<p><a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt></a> インスタンスを文字列の <a class="reference internal" href="../library/stdtypes.html#str.format" title="str.format"><tt class="xref py py-meth docutils literal"><span class="pre">format()</span></tt></a>
メソッドで利用した場合、デフォルトのアライメントが左揃えから、数値型に適した右揃えに変更されました。  (Changed by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue6857">issue 6857</a>.)</p>
<p>signaling NaN (あるいは <tt class="docutils literal"><span class="pre">sNAN</span></tt>) との比較は、暗黙に比較演算に応じて真偽値を返すのではなく、 <tt class="xref py py-const docutils literal"><span class="pre">InvalidOperation</span></tt> 例外を発生させるようになりました。 Quiet NaN (あるいは <tt class="docutils literal"><span class="pre">NAN</span></tt>) はハッシュ可能になりました。
(Fixed by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue7279">issue 7279</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/difflib.html#module-difflib" title="difflib: オブジェクト同士の違いを計算する"><tt class="xref py py-mod docutils literal"><span class="pre">difflib</span></tt></a> モジュールの出力が、ファイル名を含むヘッダのセパレータにスペースではなくタブ文字を使うようになり、最近の <strong class="command">diff</strong>/<strong class="command">patch</strong>
ツールとの互換性が高くなりました。(Fixed by Anatoly
Techtonik; <a class="reference external" href="http://bugs.python.org/issue7585">issue 7585</a>.)</p>
</li>
<li><p class="first">Distutils <tt class="docutils literal"><span class="pre">sdist</span></tt> コマンドが、 <tt class="file docutils literal"><span class="pre">MANIFEST.in</span></tt> や <tt class="file docutils literal"><span class="pre">setup.py</span></tt>
ファイルが変更されていなくても、ユーザーが作成したかもしれない新しいファイルが含まれるようにするために、毎回 <tt class="file docutils literal"><span class="pre">MANIFEST</span></tt> ファイルを再生成するようになりました。
(Fixed by Tarek Ziadé; <a class="reference external" href="http://bugs.python.org/issue8688">issue 8688</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/doctest.html#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> モジュールの <tt class="xref py py-const docutils literal"><span class="pre">IGNORE_EXCEPTION_DETAIL</span></tt> フラグが、テストされている例外を含むモジュールの名前を無視するようになりました。
(Patch by Lennart Regebro; <a class="reference external" href="http://bugs.python.org/issue7490">issue 7490</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/email.html#module-email" title="email: 電子メールのメッセージを解析、操作および生成を支援するパッケージ。 これには MIME 文書もふくまれる。"><tt class="xref py py-mod docutils literal"><span class="pre">email</span></tt></a> モジュールの <a class="reference internal" href="../library/email.message.html#email.message.Message" title="email.message.Message"><tt class="xref py py-class docutils literal"><span class="pre">Message</span></tt></a> クラスが
Uniode値のペイロードを受け入れるようになり、自動的に <tt class="xref py py-attr docutils literal"><span class="pre">output_charset</span></tt>
で指定されたエンコーディングに変換するようになりました。
(Added by R. David Murray; <a class="reference external" href="http://bugs.python.org/issue1368247">issue 1368247</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/fractions.html#fractions.Fraction" title="fractions.Fraction"><tt class="xref py py-class docutils literal"><span class="pre">Fraction</span></tt></a> クラスが、コンストラクタの引数として、
1つの float 値、 <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt></a> インスタンス、
2つの有理数を受け入れるようになりました。(Implemented by Mark Dickinson;
rationals added in <a class="reference external" href="http://bugs.python.org/issue5812">issue 5812</a>, and float/decimal in
<a class="reference external" href="http://bugs.python.org/issue8294">issue 8294</a>.)</p>
<p>fraction と complex 数の間の順序比較演算 (<tt class="docutils literal"><span class="pre">&lt;</span></tt>, <tt class="docutils literal"><span class="pre">&lt;=</span></tt>, <tt class="docutils literal"><span class="pre">&gt;</span></tt>, <tt class="docutils literal"><span class="pre">&gt;=</span></tt>)
が <a class="reference internal" href="../library/exceptions.html#exceptions.TypeError" title="exceptions.TypeError"><tt class="xref py py-exc docutils literal"><span class="pre">TypeError</span></tt></a> 例外を発生させるようになりました。これは過失を修正し、 <a class="reference internal" href="../library/fractions.html#fractions.Fraction" title="fractions.Fraction"><tt class="xref py py-class docutils literal"><span class="pre">Fraction</span></tt></a> を他の数値型とマッチさせます。</p>
</li>
<li><p class="first">新しいクラス: <a class="reference internal" href="../library/ftplib.html#ftplib.FTP_TLS" title="ftplib.FTP_TLS"><tt class="xref py py-class docutils literal"><span class="pre">FTP_TLS</span></tt></a> が <a class="reference internal" href="../library/ftplib.html#module-ftplib" title="ftplib: FTPプロトコルクライアント(ソケットを必要とします)。"><tt class="xref py py-mod docutils literal"><span class="pre">ftplib</span></tt></a> に追加されました。認証とその後の制御・データ転送をTLSカプセル化することでセキュアなFTP接続を提供します。
(Contributed by Giampaolo Rodola; <a class="reference external" href="http://bugs.python.org/issue2054">issue 2054</a>.)</p>
<p>バイナリデータのアップロードを行う <a class="reference internal" href="../library/ftplib.html#ftplib.FTP.storbinary" title="ftplib.FTP.storbinary"><tt class="xref py py-meth docutils literal"><span class="pre">storbinary()</span></tt></a> に <em>rest</em>
引数が追加され、アップロードのリスタートができるようになりました。
(patch by Pablo Mouzo; <a class="reference external" href="http://bugs.python.org/issue6845">issue 6845</a>.)</p>
</li>
<li><p class="first">新しいクラスデコレータ: <a class="reference internal" href="../library/functools.html#module-functools" title="functools: 高階関数と呼び出し可能オブジェクトの操作"><tt class="xref py py-mod docutils literal"><span class="pre">functools</span></tt></a> モジュールに <a class="reference internal" href="../library/functools.html#functools.total_ordering" title="functools.total_ordering"><tt class="xref py py-func docutils literal"><span class="pre">total_ordering()</span></tt></a>
が追加されました。 <a class="reference internal" href="../reference/datamodel.html#object.__eq__" title="object.__eq__"><tt class="xref py py-meth docutils literal"><span class="pre">__eq__()</span></tt></a> と、 <a class="reference internal" href="../reference/datamodel.html#object.__lt__" title="object.__lt__"><tt class="xref py py-meth docutils literal"><span class="pre">__lt__()</span></tt></a>, <a class="reference internal" href="../reference/datamodel.html#object.__le__" title="object.__le__"><tt class="xref py py-meth docutils literal"><span class="pre">__le__()</span></tt></a>, <a class="reference internal" href="../reference/datamodel.html#object.__gt__" title="object.__gt__"><tt class="xref py py-meth docutils literal"><span class="pre">__gt__()</span></tt></a>,
<a class="reference internal" href="../reference/datamodel.html#object.__ge__" title="object.__ge__"><tt class="xref py py-meth docutils literal"><span class="pre">__ge__()</span></tt></a> のいづれか1つを定義したクラスを受け取り、残りの比較メソッドを生成します。
<a class="reference internal" href="../reference/datamodel.html#object.__cmp__" title="object.__cmp__"><tt class="xref py py-meth docutils literal"><span class="pre">__cmp__()</span></tt></a> メソッドが Python 3.x では廃止されたので、順序のあるクラスを定義するのを簡単にするためにこのデコレータがあります。
(Added by Raymond Hettinger; <a class="reference external" href="http://bugs.python.org/issue5479">issue 5479</a>.)</p>
<p>新しい関数: <a class="reference internal" href="../library/functools.html#functools.cmp_to_key" title="functools.cmp_to_key"><tt class="xref py py-func docutils literal"><span class="pre">cmp_to_key()</span></tt></a> 関数は、古いスタイルの2引数を受け取る比較関数を受け取り、 <a class="reference internal" href="../library/functions.html#sorted" title="sorted"><tt class="xref py py-func docutils literal"><span class="pre">sorted()</span></tt></a>, <a class="reference internal" href="../library/functions.html#min" title="min"><tt class="xref py py-func docutils literal"><span class="pre">min()</span></tt></a>, <a class="reference internal" href="../library/functions.html#max" title="max"><tt class="xref py py-func docutils literal"><span class="pre">max()</span></tt></a> などの
<em>key</em> 引数に利用できる呼び出し可能オブジェクトを返します。この関数の主な目的は、古いコードを Python 3.x へ対応させるのを手助けすることです。
(Added by Raymond Hettinger.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/gc.html#module-gc" title="gc: 循環検出ガベージコレクタのインターフェース。"><tt class="xref py py-mod docutils literal"><span class="pre">gc</span></tt></a> モジュールに <a class="reference internal" href="../library/gc.html#gc.is_tracked" title="gc.is_tracked"><tt class="xref py py-func docutils literal"><span class="pre">is_tracked()</span></tt></a> 関数が追加されました。渡されたオブジェクトがGCに追跡されている場合に True を、そうでない場合に
False を返します。 (Contributed by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue4688">issue 4688</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/gzip.html#module-gzip" title="gzip: ファイルオブジェクトを用いた gzip  圧縮および解凍のためのインタフェース"><tt class="xref py py-mod docutils literal"><span class="pre">gzip</span></tt></a> モジュールの <a class="reference internal" href="../library/gzip.html#gzip.GzipFile" title="gzip.GzipFile"><tt class="xref py py-class docutils literal"><span class="pre">GzipFile</span></tt></a> がコンテキストマネージャープロトコルをサポートしました。 <tt class="docutils literal"><span class="pre">with</span> <span class="pre">gzip.GzipFile(...)</span> <span class="pre">as</span> <span class="pre">f:</span></tt> と書くことができます。(contributed by Hagen Fürstenau; <a class="reference external" href="http://bugs.python.org/issue3860">issue 3860</a>
また、 <a class="reference internal" href="../library/io.html#io.BufferedIOBase" title="io.BufferedIOBase"><tt class="xref py py-class docutils literal"><span class="pre">io.BufferedIOBase</span></tt></a> ABC を実装しています。なので、より高速な処理のために <a class="reference internal" href="../library/io.html#io.BufferedReader" title="io.BufferedReader"><tt class="xref py py-class docutils literal"><span class="pre">io.BufferedReader</span></tt></a> でラップすることができます。
(contributed by Nir Aides; <a class="reference external" href="http://bugs.python.org/issue7471">issue 7471</a>).
さらに、コンストラクタにオプションのタイムスタンプを指定することで、
gzip ファイル内の変更時間レコードをオーバーライドすることができるようになりました。  (Contributed by Jacques Frechet; <a class="reference external" href="http://bugs.python.org/issue4272">issue 4272</a>.)</p>
<p>gzip ファイルフォーマットのファイルは最後にゼロバイトによるパディングができるようになりました。 <a class="reference internal" href="../library/gzip.html#module-gzip" title="gzip: ファイルオブジェクトを用いた gzip  圧縮および解凍のためのインタフェース"><tt class="xref py py-mod docutils literal"><span class="pre">gzip</span></tt></a> モジュールは末尾のゼロバイトを消費します。(Fixed by Tadek Pietraszek and Brian Curtin; <a class="reference external" href="http://bugs.python.org/issue2846">issue 2846</a>.)</p>
</li>
<li><p class="first">新しい属性: <a class="reference internal" href="../library/hashlib.html#module-hashlib" title="hashlib: セキュアハッシュおよびメッセージダイジェストのアルゴリズム"><tt class="xref py py-mod docutils literal"><span class="pre">hashlib</span></tt></a> モジュールに <a class="reference internal" href="../library/hashlib.html#hashlib.hashlib.algorithms" title="hashlib.hashlib.algorithms"><tt class="xref py py-attr docutils literal"><span class="pre">algorithms</span></tt></a>
属性が追加されました。これはサポートしているアルゴリズムを含むタプルです。
Python 2.7 では、 <tt class="docutils literal"><span class="pre">hashlib.algorithms</span></tt> は
<tt class="docutils literal"><span class="pre">('md5',</span> <span class="pre">'sha1',</span> <span class="pre">'sha224',</span> <span class="pre">'sha256',</span> <span class="pre">'sha384',</span> <span class="pre">'sha512')</span></tt> が含まれています。
(Contributed by Carl Chenet; <a class="reference external" href="http://bugs.python.org/issue7418">issue 7418</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/httplib.html#module-httplib" title="httplib: HTTP および HTTPS プロトコルのクライアント  (ソケットを必要とします) 。"><tt class="xref py py-mod docutils literal"><span class="pre">httplib</span></tt></a> モジュールで使われているデフォルトの <a class="reference internal" href="../library/httplib.html#httplib.HTTPResponse" title="httplib.HTTPResponse"><tt class="xref py py-class docutils literal"><span class="pre">HTTPResponse</span></tt></a>
クラスがバッファリングをサポートし、HTTPレスポンスをより高速に読み込めるようになりました。
(Contributed by Kristján Valur Jónsson; <a class="reference external" href="http://bugs.python.org/issue4879">issue 4879</a>.)</p>
<p><a class="reference internal" href="../library/httplib.html#httplib.HTTPConnection" title="httplib.HTTPConnection"><tt class="xref py py-class docutils literal"><span class="pre">HTTPConnection</span></tt></a> と <a class="reference internal" href="../library/httplib.html#httplib.HTTPSConnection" title="httplib.HTTPSConnection"><tt class="xref py py-class docutils literal"><span class="pre">HTTPSConnection</span></tt></a> クラスが
<em>source_address</em> 引数として <tt class="docutils literal"><span class="pre">(host,</span> <span class="pre">port)</span></tt> の2要素タプルを受け取るようになりました。これは接続のソースアドレスとして利用されます。
(Contributed by Eldon Ziegler; <a class="reference external" href="http://bugs.python.org/issue3972">issue 3972</a>.)</p>
</li>
<li><p class="first"><tt class="xref py py-mod docutils literal"><span class="pre">ihooks</span></tt> モジュールが相対 import をサポートしました。
<tt class="xref py py-mod docutils literal"><span class="pre">ihooks</span></tt> import をカスタマイズするための古いモジュールで、
Python 2.0 で追加された <a class="reference internal" href="../library/imputil.html#module-imputil" title="imputil: import 処理の管理と増強 (撤廃)"><tt class="xref py py-mod docutils literal"><span class="pre">imputil</span></tt></a> モジュールに取って変わられていることに注意してください。
(Relative import support added by Neil Schemenauer.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/imaplib.html#module-imaplib" title="imaplib: IMAP4 protocol client (requires sockets)."><tt class="xref py py-mod docutils literal"><span class="pre">imaplib</span></tt></a> モジュールが IPv6 アドレスをサポートするようになりました。
(Contributed by Derek Morr; <a class="reference external" href="http://bugs.python.org/issue1655">issue 1655</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/inspect.html#module-inspect" title="inspect: 活動中のオブジェクトから、情報とソースコードを取得する。"><tt class="xref py py-mod docutils literal"><span class="pre">inspect</span></tt></a> モジュールに <a class="reference internal" href="../library/inspect.html#inspect.getcallargs" title="inspect.getcallargs"><tt class="xref py py-func docutils literal"><span class="pre">getcallargs()</span></tt></a> 関数が追加されました。
callable とその位置引数、キーワード引数を受け取り、
callable のどの仮引数がどの実引数を受け取るかを計算し、引数名から値へマップする辞書を返します。例えば:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getcallargs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">pos</span><span class="p">,</span> <span class="o">**</span><span class="n">named</span><span class="p">):</span>
<span class="gp">... </span>    <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getcallargs</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">{&#39;a&#39;: 1, &#39;b&#39;: 2, &#39;pos&#39;: (3,), &#39;named&#39;: {}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getcallargs</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="go">{&#39;a&#39;: 2, &#39;b&#39;: 1, &#39;pos&#39;: (), &#39;named&#39;: {&#39;x&#39;: 4}}</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">getcallargs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="c">...</span>
<span class="nc">TypeError</span>: <span class="n-Identifier">f() takes at least 1 argument (0 given)</span>
</pre></div>
</div>
<p>Contributed by George Sakkis; <a class="reference external" href="http://bugs.python.org/issue3135">issue 3135</a>.</p>
</li>
<li><p class="first">更新されたモジュール: <a class="reference internal" href="../library/io.html#module-io" title="io: Core tools for working with streams."><tt class="xref py py-mod docutils literal"><span class="pre">io</span></tt></a> ライブラリが、Python 3.1 に同梱されるバージョンに更新されました。
3.1 では、I/O ライブラリは完全に C で書き直され、処理されるタスクに依って
2 から 20 倍速くなりました。元の Python バージョンは <tt class="xref py py-mod docutils literal"><span class="pre">_pyio</span></tt>
モジュールに改名されました。</p>
<p>結果の軽微な変更: <a class="reference internal" href="../library/io.html#io.TextIOBase" title="io.TextIOBase"><tt class="xref py py-class docutils literal"><span class="pre">io.TextIOBase</span></tt></a> クラスは、エンコーディングやデコーディングのエラーに使われるエラー設定 (<tt class="docutils literal"><span class="pre">'strict'</span></tt>, <tt class="docutils literal"><span class="pre">'replace'</span></tt>,
<tt class="docutils literal"><span class="pre">'ignore'</span></tt> のいずれか) を与える <tt class="xref py py-attr docutils literal"><span class="pre">errors</span></tt>
属性を持つようになりました。</p>
<p><a class="reference internal" href="../library/io.html#io.FileIO" title="io.FileIO"><tt class="xref py py-class docutils literal"><span class="pre">io.FileIO</span></tt></a> クラスは、無効なファイルディスクリプタを渡されたときに
<a class="reference internal" href="../library/exceptions.html#exceptions.OSError" title="exceptions.OSError"><tt class="xref py py-exc docutils literal"><span class="pre">OSError</span></tt></a> を送出するようになりました。(Implemented by Benjamin Peterson;
<a class="reference external" href="http://bugs.python.org/issue4991">issue 4991</a>.) <a class="reference internal" href="../library/io.html#io.IOBase.truncate" title="io.IOBase.truncate"><tt class="xref py py-meth docutils literal"><span class="pre">truncate()</span></tt></a> メソッドは、ファイル位置を保存するようになりました。以前は、ファイル位置を新しいファイルの末尾に変更しました。(Fixed by Pascal Chambon; <a class="reference external" href="http://bugs.python.org/issue6939">issue 6939</a>.)</p>
</li>
<li><p class="first">新しい関数: <tt class="docutils literal"><span class="pre">itertools.compress(data,</span> <span class="pre">selectors)</span></tt> は、2 つのイテレータを取ります。 <em>data</em> の要素は、 <em>selectors</em> の対応する値が真であれば返されます:</p>
<div class="highlight-python"><pre>itertools.compress('ABCDEF', [1,0,1,0,1,1]) =&gt;
  A, C, E, F</pre>
</div>
<p>新しい関数: <tt class="docutils literal"><span class="pre">itertools.combinations_with_replacement(iter,</span> <span class="pre">r)</span></tt> は、
<em>iter</em> から、すべての可能な長さ <em>r</em> の要素の組合せを返します。
<a class="reference internal" href="../library/itertools.html#itertools.combinations" title="itertools.combinations"><tt class="xref py py-func docutils literal"><span class="pre">combinations()</span></tt></a> とは異なり、生成された組合せに個別の要素が繰り返し出現できます:</p>
<div class="highlight-python"><pre>itertools.combinations_with_replacement('abc', 2) =&gt;
  ('a', 'a'), ('a', 'b'), ('a', 'c'),
  ('b', 'b'), ('b', 'c'), ('c', 'c')</pre>
</div>
<p>なお要素は、実際の値ではなく、その入力内での位置に依って一意であるとみなされます。</p>
<p><a class="reference internal" href="../library/itertools.html#itertools.count" title="itertools.count"><tt class="xref py py-func docutils literal"><span class="pre">itertools.count()</span></tt></a> 関数は、1 以外の値を増分できるように、 <em>step</em> 引数を追加しました。 <a class="reference internal" href="../library/itertools.html#itertools.count" title="itertools.count"><tt class="xref py py-func docutils literal"><span class="pre">count()</span></tt></a> はまた、キーワード引数に対応し、さらに浮動小数点数や <a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt></a> インスタンスのような、非整数の値を使えるようになりました。(Implemented by Raymond
Hettinger; <a class="reference external" href="http://bugs.python.org/issue5032">issue 5032</a>.)</p>
<p><a class="reference internal" href="../library/itertools.html#itertools.combinations" title="itertools.combinations"><tt class="xref py py-func docutils literal"><span class="pre">itertools.combinations()</span></tt></a> および <a class="reference internal" href="../library/itertools.html#itertools.product" title="itertools.product"><tt class="xref py py-func docutils literal"><span class="pre">itertools.product()</span></tt></a> は、以前は入力のイテレート可能オブジェクトより大きい <em>r</em> に <a class="reference internal" href="../library/exceptions.html#exceptions.ValueError" title="exceptions.ValueError"><tt class="xref py py-exc docutils literal"><span class="pre">ValueError</span></tt></a> を返していました。これは仕様エラーと認められ、空のイテレータを返すようになりました。(Fixed by Raymond Hettinger; <a class="reference external" href="http://bugs.python.org/issue4816">issue 4816</a>.)</p>
</li>
<li><p class="first">更新されたモジュール: <a class="reference internal" href="../library/json.html#module-json" title="json: JSON 形式のエンコードおよびデコード"><tt class="xref py py-mod docutils literal"><span class="pre">json</span></tt></a> モジュールが、エンコーディングやデコーディングを高速化する C 拡張を含んだ、 simplejson パッケージのバージョン 2.0.9 にアップグレードされました。
(Contributed by Bob Ippolito; <a class="reference external" href="http://bugs.python.org/issue4136">issue 4136</a>.)</p>
<p>新しい <a class="reference internal" href="../library/collections.html#collections.OrderedDict" title="collections.OrderedDict"><tt class="xref py py-class docutils literal"><span class="pre">collections.OrderedDict</span></tt></a> 型をサポートするために、
<a class="reference internal" href="../library/json.html#json.load" title="json.load"><tt class="xref py py-func docutils literal"><span class="pre">json.load()</span></tt></a> はオプションとして、任意のオブジェクトリテラルに対して呼び出され、ペアのリストにデコードする <em>object_pairs_hook</em> パラメタを追加しました。(Contributed by Raymond Hettinger; <a class="reference external" href="http://bugs.python.org/issue5381">issue 5381</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/mailbox.html#module-mailbox" title="mailbox: 様々な形式のメールボックス操作"><tt class="xref py py-mod docutils literal"><span class="pre">mailbox</span></tt></a> モジュールの <a class="reference internal" href="../library/mailbox.html#mailbox.Maildir" title="mailbox.Maildir"><tt class="xref py py-class docutils literal"><span class="pre">Maildir</span></tt></a> クラスは、読み込むディレクトリのタイムスタンプを記録し、その後に更新時刻が変わった場合にのみ再読み込みするようになりました。これは不必要なディレクトリ走査を避けることでパフォーマンスを向上させます。
A.M. Kuchling and Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue1607951">issue 1607951</a>, <a class="reference external" href="http://bugs.python.org/issue6896">issue 6896</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/math.html#module-math" title="math: 数学関数(sin() など)。"><tt class="xref py py-mod docutils literal"><span class="pre">math</span></tt></a> モジュールは、誤差関数と相補誤差関数
<a class="reference internal" href="../library/math.html#math.erf" title="math.erf"><tt class="xref py py-func docutils literal"><span class="pre">erf()</span></tt></a> および <a class="reference internal" href="../library/math.html#math.erfc" title="math.erfc"><tt class="xref py py-func docutils literal"><span class="pre">erfc()</span></tt></a> 、
<tt class="docutils literal"><span class="pre">e**x</span> <span class="pre">-</span> <span class="pre">1</span></tt> を <a class="reference internal" href="../library/math.html#math.exp" title="math.exp"><tt class="xref py py-func docutils literal"><span class="pre">exp()</span></tt></a> から 1 を引くのよりも高い精度で計算する
<a class="reference internal" href="../library/math.html#math.expm1" title="math.expm1"><tt class="xref py py-func docutils literal"><span class="pre">expm1()</span></tt></a> 、ガンマ関数 <a class="reference internal" href="../library/math.html#math.gamma" title="math.gamma"><tt class="xref py py-func docutils literal"><span class="pre">gamma()</span></tt></a> 、そしてガンマ関数の自然対数 <a class="reference internal" href="../library/math.html#math.lgamma" title="math.lgamma"><tt class="xref py py-func docutils literal"><span class="pre">lgamma()</span></tt></a> を追加しました。
(Contributed by Mark Dickinson and nirinA raseliarison; <a class="reference external" href="http://bugs.python.org/issue3366">issue 3366</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/multiprocessing.html#module-multiprocessing" title="multiprocessing: Process-based &quot;threading&quot; interface."><tt class="xref py py-mod docutils literal"><span class="pre">multiprocessing</span></tt></a> モジュールの <tt class="xref py py-class docutils literal"><span class="pre">Manager*</span></tt> クラスに、サブプロセスの開始時に呼び出される呼び出し可能オブジェクトと、それに渡される引数群を渡すことができるようになりました。
(Contributed by lekma; <a class="reference external" href="http://bugs.python.org/issue5585">issue 5585</a>.)</p>
<p>ワーカプロセスのプールを制御する <tt class="xref py py-class docutils literal"><span class="pre">Pool</span></tt> クラスに、オプションの <em>maxtasksperchild</em> パラメタが追加されました。ワーカプロセスはこれで指定された数のタスクを処理したら、退出して
<tt class="xref py py-class docutils literal"><span class="pre">Pool</span></tt> に新しいワーカーを開始させます。これは、タスクがメモリその他のリソースをリークし得るときや、ワーカをとても大きくしてしまうようなタスクがあるときに便利です。
(Contributed by Charles Cazabon; <a class="reference external" href="http://bugs.python.org/issue6963">issue 6963</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/nntplib.html#module-nntplib" title="nntplib: NNTP プロトコルクライアント (ソケットを必要とします)。"><tt class="xref py py-mod docutils literal"><span class="pre">nntplib</span></tt></a> モジュールは、IPv6 アドレスをサポートするようになりました。
(Contributed by Derek Morr; <a class="reference external" href="http://bugs.python.org/issue1664">issue 1664</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/os.html#module-os" title="os: 雑多なオペレーティングシステムインタフェース。"><tt class="xref py py-mod docutils literal"><span class="pre">os</span></tt></a> モジュールは、以下の POSIX システムコールをラップします: real, effective, および saved GID と UID を返す、
<a class="reference internal" href="../library/os.html#os.getresgid" title="os.getresgid"><tt class="xref py py-func docutils literal"><span class="pre">getresgid()</span></tt></a> と <a class="reference internal" href="../library/os.html#os.getresuid" title="os.getresuid"><tt class="xref py py-func docutils literal"><span class="pre">getresuid()</span></tt></a> 、
real, effective, および saved GID と UID を新しく設定する、
<a class="reference internal" href="../library/os.html#os.setresgid" title="os.setresgid"><tt class="xref py py-func docutils literal"><span class="pre">setresgid()</span></tt></a> と <a class="reference internal" href="../library/os.html#os.setresuid" title="os.setresuid"><tt class="xref py py-func docutils literal"><span class="pre">setresuid()</span></tt></a> 、現在のプロセスにグループアクセスリストを初期化する <a class="reference internal" href="../library/os.html#os.initgroups" title="os.initgroups"><tt class="xref py py-func docutils literal"><span class="pre">initgroups()</span></tt></a>  。
(GID/UID functions contributed by Travis H.; <a class="reference external" href="http://bugs.python.org/issue6508">issue 6508</a>.
Support for initgroups added by Jean-Paul Calderone; <a class="reference external" href="http://bugs.python.org/issue7333">issue 7333</a>.)</p>
<p><a class="reference internal" href="../library/os.html#os.fork" title="os.fork"><tt class="xref py py-func docutils literal"><span class="pre">os.fork()</span></tt></a> 関数は、子プロセス中で import ロックを再初期化するようになりました。これは、Solaris における <a class="reference internal" href="../library/os.html#os.fork" title="os.fork"><tt class="xref py py-func docutils literal"><span class="pre">fork()</span></tt></a> がスレッドから呼び出された時の問題を修正します。(Fixed by Zsolt Cserna; <a class="reference external" href="http://bugs.python.org/issue7242">issue 7242</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/os.path.html#module-os.path" title="os.path: Operations on pathnames."><tt class="xref py py-mod docutils literal"><span class="pre">os.path</span></tt></a> モジュールの、 <a class="reference internal" href="../library/os.path.html#os.path.normpath" title="os.path.normpath"><tt class="xref py py-func docutils literal"><span class="pre">normpath()</span></tt></a> および
<a class="reference internal" href="../library/os.path.html#os.path.abspath" title="os.path.abspath"><tt class="xref py py-func docutils literal"><span class="pre">abspath()</span></tt></a> 関数は、Unicode を保存するようになりました。入力パスが Unicode なら、戻り値も Unicode 文字列になります。
(<a class="reference internal" href="../library/os.path.html#os.path.normpath" title="os.path.normpath"><tt class="xref py py-meth docutils literal"><span class="pre">normpath()</span></tt></a> fixed by Matt Giuca in <a class="reference external" href="http://bugs.python.org/issue5827">issue 5827</a>;
<a class="reference internal" href="../library/os.path.html#os.path.abspath" title="os.path.abspath"><tt class="xref py py-meth docutils literal"><span class="pre">abspath()</span></tt></a> fixed by Ezio Melotti in <a class="reference external" href="http://bugs.python.org/issue3426">issue 3426</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/pydoc.html#module-pydoc" title="pydoc: ドキュメント生成とオンラインヘルプシステム"><tt class="xref py py-mod docutils literal"><span class="pre">pydoc</span></tt></a> モジュールは、Python が使う様々なシンボルのヘルプを追加しました。例えば、 <tt class="docutils literal"><span class="pre">help('&lt;&lt;')</span></tt> や <tt class="docutils literal"><span class="pre">help('&#64;')</span></tt> とできるようになりました。(Contributed by David Laban; <a class="reference external" href="http://bugs.python.org/issue4739">issue 4739</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/re.html#module-re" title="re: 正規表現操作"><tt class="xref py py-mod docutils literal"><span class="pre">re</span></tt></a> モジュールの <a class="reference internal" href="../library/re.html#re.split" title="re.split"><tt class="xref py py-func docutils literal"><span class="pre">split()</span></tt></a>, <a class="reference internal" href="../library/re.html#re.sub" title="re.sub"><tt class="xref py py-func docutils literal"><span class="pre">sub()</span></tt></a>, および
<a class="reference internal" href="../library/re.html#re.subn" title="re.subn"><tt class="xref py py-func docutils literal"><span class="pre">subn()</span></tt></a> は、モジュールの他の関数との一貫性のため、オプションの <em>flags</em> 引数を受け付けるようになりました。
(Added by Gregory P. Smith.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/runpy.html#module-runpy" title="runpy: 先行インポートなしの Python モジュールの位置特定と実行。"><tt class="xref py py-mod docutils literal"><span class="pre">runpy</span></tt></a> モジュールの <a class="reference internal" href="../library/runpy.html#runpy.run_path" title="runpy.run_path"><tt class="xref py py-func docutils literal"><span class="pre">run_path()</span></tt></a> は、与えられた <em>path</em> 引数のコードを実行します。 <em>path</em> は Python
ソースファイルのパス (<tt class="file docutils literal"><span class="pre">example.py</span></tt>)、コンパイル済みバイトコードファイル (<tt class="file docutils literal"><span class="pre">example.pyc</span></tt>)、ディレクトリ
(<tt class="file docutils literal"><span class="pre">./package/</span></tt>)、または zip アーカイブ (<tt class="file docutils literal"><span class="pre">example.zip</span></tt>) にできます。ディレクトリか zip パスが与えられると、それが <tt class="docutils literal"><span class="pre">sys.path</span></tt>
の最初に加えられ、モジュール <a class="reference internal" href="../library/__main__.html#module-__main__" title="__main__: トップレベルスクリプトが実行される環境。"><tt class="xref py py-mod docutils literal"><span class="pre">__main__</span></tt></a> が import されます。これは、ディレクトリや zip が <tt class="file docutils literal"><span class="pre">__main__.py</span></tt> を含むことを期待します。なければ、他の <tt class="file docutils literal"><span class="pre">__main__.py</span></tt> が <tt class="docutils literal"><span class="pre">sys.path</span></tt> の後の部分から
import されることがあります。これにより、Python のコマンドラインが明示的なパス名を処理する方法を真似たいようなスクリプトに、 <a class="reference internal" href="../library/runpy.html#module-runpy" title="runpy: 先行インポートなしの Python モジュールの位置特定と実行。"><tt class="xref py py-mod docutils literal"><span class="pre">runpy</span></tt></a> のより多くの機構が利用できるようになります。
(Added by Nick Coghlan; <a class="reference external" href="http://bugs.python.org/issue6816">issue 6816</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/shutil.html#module-shutil" title="shutil: コピーを含む高レベルなファイル操作。"><tt class="xref py py-mod docutils literal"><span class="pre">shutil</span></tt></a> モジュールの <a class="reference internal" href="../library/shutil.html#shutil.make_archive" title="shutil.make_archive"><tt class="xref py py-func docutils literal"><span class="pre">make_archive()</span></tt></a>
は、ファイル名、アーカイブ型 (zip または tar-format)、およびディレクトリパスを取って、そのディレクトリの内容を含むアーカイブを生成します。(Added by Tarek Ziadé.)</p>
<p><a class="reference internal" href="../library/shutil.html#module-shutil" title="shutil: コピーを含む高レベルなファイル操作。"><tt class="xref py py-mod docutils literal"><span class="pre">shutil</span></tt></a>&#8216;s の <a class="reference internal" href="../library/shutil.html#shutil.copyfile" title="shutil.copyfile"><tt class="xref py py-func docutils literal"><span class="pre">copyfile()</span></tt></a> および <a class="reference internal" href="../library/shutil.html#shutil.copytree" title="shutil.copytree"><tt class="xref py py-func docutils literal"><span class="pre">copytree()</span></tt></a>
関数は、名前付きパイプのコピーを求められたときに
<tt class="xref py py-exc docutils literal"><span class="pre">SpecialFileError</span></tt> 例外を送出する様になりました。以前は、コードは、名前付きパイプを、通常のファイルのように読み込み用に開いて扱い、いつまでもブロックしていました。
(Fixed by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue3002">issue 3002</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/signal.html#module-signal" title="signal: 非同期イベントにハンドラを設定します。"><tt class="xref py py-mod docutils literal"><span class="pre">signal</span></tt></a> モジュールは、シグナルハンドラを本当に必要でない限り再インストールしなくなりました。これで、EINTR シグナルを強く捕えられないバグが修正されました。(Fixed by Charles-Francois Natali; <a class="reference external" href="http://bugs.python.org/issue8354">issue 8354</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/site.html#module-site" title="site: サイト固有のモジュールを参照する標準の方法。"><tt class="xref py py-mod docutils literal"><span class="pre">site</span></tt></a> モジュールの、新しい関数群は様々なサイトおよびユーザに特有のパスを返します。
<a class="reference internal" href="../library/site.html#site.getsitepackages" title="site.getsitepackages"><tt class="xref py py-func docutils literal"><span class="pre">getsitepackages()</span></tt></a> は、全てのグローバル site-packages
ディレクトリを含むリストを返します。
<a class="reference internal" href="../library/site.html#site.getusersitepackages" title="site.getusersitepackages"><tt class="xref py py-func docutils literal"><span class="pre">getusersitepackages()</span></tt></a> は、ユーザの site-packages
ディレクトリのパスを返します。そして、
<a class="reference internal" href="../library/site.html#site.getuserbase" title="site.getuserbase"><tt class="xref py py-func docutils literal"><span class="pre">getuserbase()</span></tt></a> は、データの保存に使えるディレクトリへのパスを与える、 <span class="target" id="index-8"></span><tt class="xref std std-envvar docutils literal"><span class="pre">USER_BASE</span></tt> 環境変数の値を返します。
(Contributed by Tarek Ziadé; <a class="reference external" href="http://bugs.python.org/issue6693">issue 6693</a>.)</p>
<p><a class="reference internal" href="../library/site.html#module-site" title="site: サイト固有のモジュールを参照する標準の方法。"><tt class="xref py py-mod docutils literal"><span class="pre">site</span></tt></a> モジュールは <tt class="xref py py-mod docutils literal"><span class="pre">sitecustomize</span></tt> モジュールが import されたときに例外を報告するようになり、 <a class="reference internal" href="../library/exceptions.html#exceptions.KeyboardInterrupt" title="exceptions.KeyboardInterrupt"><tt class="xref py py-exc docutils literal"><span class="pre">KeyboardInterrupt</span></tt></a> 例外が捕捉されて飲み込まれることはなくなりました。
(Fixed by Victor Stinner; <a class="reference external" href="http://bugs.python.org/issue3137">issue 3137</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/socket.html#socket.create_connection" title="socket.create_connection"><tt class="xref py py-func docutils literal"><span class="pre">create_connection()</span></tt></a> 関数は、接続に使われるソースアドレスを与える <tt class="docutils literal"><span class="pre">(host,</span> <span class="pre">port)</span></tt> の 2-タプル、 <em>source_address</em> パラメタを追加しました。
(Contributed by Eldon Ziegler; <a class="reference external" href="http://bugs.python.org/issue3972">issue 3972</a>.)</p>
<p><a class="reference internal" href="../library/socket.html#socket.socket.recv_into" title="socket.socket.recv_into"><tt class="xref py py-meth docutils literal"><span class="pre">recv_into()</span></tt></a> および <a class="reference internal" href="../library/socket.html#socket.socket.recvfrom_into" title="socket.socket.recvfrom_into"><tt class="xref py py-meth docutils literal"><span class="pre">recvfrom_into()</span></tt></a>
メソッドは、バッファ API をサポートするオブジェクト、最も便利なのは
<a class="reference internal" href="../library/functions.html#bytearray" title="bytearray"><tt class="xref py py-class docutils literal"><span class="pre">bytearray</span></tt></a> や <a class="reference internal" href="../library/stdtypes.html#memoryview" title="memoryview"><tt class="xref py py-class docutils literal"><span class="pre">memoryview</span></tt></a> 、に書きこむようになりました。
(Implemented by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue8104">issue 8104</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/socketserver.html#module-SocketServer" title="SocketServer: ネットワークサーバ構築のためのフレームワーク。"><tt class="xref py py-mod docutils literal"><span class="pre">SocketServer</span></tt></a> モジュールの <tt class="xref py py-class docutils literal"><span class="pre">TCPServer</span></tt> クラスは、ソケットタイムアウトと Nagle アルゴリズムの無効化をサポートするようになりました。 <tt class="xref py py-attr docutils literal"><span class="pre">disable_nagle_algorithm</span></tt>
クラス属性は、デフォルトで False です。上書きされて True になると、新しいリクエスト接続は、TCP_NODELAY オプションを設定され、一つの
TCP パケットにたくさんの小さな送信がバッファリングされることを防ぎます。
<a class="reference internal" href="../library/socketserver.html#SocketServer.BaseServer.timeout" title="SocketServer.BaseServer.timeout"><tt class="xref py py-attr docutils literal"><span class="pre">timeout</span></tt></a> クラス属性は、リクエストソケットに適用されるタイムアウトを秒で保持できます。その時間内にリクエストが受け付けられなければ、
<a class="reference internal" href="../library/socketserver.html#SocketServer.BaseServer.handle_timeout" title="SocketServer.BaseServer.handle_timeout"><tt class="xref py py-meth docutils literal"><span class="pre">handle_timeout()</span></tt></a> が呼び出され、
<a class="reference internal" href="../library/socketserver.html#SocketServer.BaseServer.handle_request" title="SocketServer.BaseServer.handle_request"><tt class="xref py py-meth docutils literal"><span class="pre">handle_request()</span></tt></a> が返されます。
(Contributed by Kristján Valur Jónsson; <a class="reference external" href="http://bugs.python.org/issue6192">issue 6192</a> and <a class="reference external" href="http://bugs.python.org/issue6267">issue 6267</a>.)</p>
</li>
<li><p class="first">更新されたモジュール: <a class="reference internal" href="../library/sqlite3.html#module-sqlite3" title="sqlite3: A DB-API 2.0 implementation using SQLite 3.x."><tt class="xref py py-mod docutils literal"><span class="pre">sqlite3</span></tt></a> モジュールが
<a class="reference external" href="http://code.google.com/p/pysqlite/">pysqlite package</a> のバージョン
2.6.0 にアップデートされました。バージョン 2.6.0 はいくつかのバグ修正を含み、共有ライブラリから SQLite 拡張をロードできるようになりました。拡張を有効にするには <tt class="docutils literal"><span class="pre">enable_load_extension(True)</span></tt> メソッドを呼び出し、そして特定の共有ライブラリをロードするには <tt class="docutils literal"><span class="pre">enable_load_extension(True)</span></tt> を呼び出してください。
(Updated by Gerhard Häring.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/ssl.html#module-ssl" title="ssl: ソケットオブジェクトに対する TLS/SSL ラッパー"><tt class="xref py py-mod docutils literal"><span class="pre">ssl</span></tt></a> モジュールの <tt class="xref py py-class docutils literal"><span class="pre">SSLSocket</span></tt> オブジェクトは、バッファ API
をサポートするようになりました。これは、テストスイートの障害を修正します (fix by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue7133">issue 7133</a>)。また、OpenSSL の <tt class="xref c c-macro docutils literal"><span class="pre">SSL_MODE_AUTO_RETRY</span></tt> を自動的に設定することで、
<tt class="xref py py-meth docutils literal"><span class="pre">recv()</span></tt> 演算によって SSL 再ネゴシエーションを引き起こすエラーコードが返されるのを防ぎます (fix by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue8222">issue 8222</a>)。</p>
<p><a class="reference internal" href="../library/ssl.html#ssl.wrap_socket" title="ssl.wrap_socket"><tt class="xref py py-func docutils literal"><span class="pre">ssl.wrap_socket()</span></tt></a> コンストラクタ関数は、許可される暗号化アルゴリズムを列挙する文字列である <em>ciphers</em> 引数を取るようになりました。この文字列の書式は、 <a class="reference external" href="http://www.openssl.org/docs/apps/ciphers.html#CIPHER_LIST_FORMAT">OpenSSL ドキュメントで</a>.
解説されています。
(Added by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue8322">issue 8322</a>.)</p>
<p>その他の変更により、拡張はOpenSSL の全ての暗号をロードし、それらすべてが利用できるようアルゴリズムを消化します。SSL 暗号化の中には検証できないものもあり、&#8221;unknown algorithm&#8221; エラーを報告します。
(Reported by Beda Kosata, and fixed by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue8484">issue 8484</a>.)</p>
<p>OpenSSL の、使われるバージョンは、モジュール属性 <a class="reference internal" href="../library/ssl.html#ssl.OPENSSL_VERSION" title="ssl.OPENSSL_VERSION"><tt class="xref py py-data docutils literal"><span class="pre">ssl.OPENSSL_VERSION</span></tt></a>
(文字列)、 <a class="reference internal" href="../library/ssl.html#ssl.OPENSSL_VERSION_INFO" title="ssl.OPENSSL_VERSION_INFO"><tt class="xref py py-data docutils literal"><span class="pre">ssl.OPENSSL_VERSION_INFO</span></tt></a> (5-タプル)、および
<a class="reference internal" href="../library/ssl.html#ssl.OPENSSL_VERSION_NUMBER" title="ssl.OPENSSL_VERSION_NUMBER"><tt class="xref py py-data docutils literal"><span class="pre">ssl.OPENSSL_VERSION_NUMBER</span></tt></a> (整数) として利用できるようになりました。
(Added by Antoin Pitrou; <a class="reference external" href="http://bugs.python.org/issue8321">issue 8321</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/struct.html#module-struct" title="struct: 文字列データをパックされたバイナリデータとして解釈する."><tt class="xref py py-mod docutils literal"><span class="pre">struct</span></tt></a> モジュールは、値が特定の整数フォーマットコード
(<tt class="docutils literal"><span class="pre">bBhHiIlLqQ</span></tt> のいずれか) に対して大きすぎるときに、オーバーフローエラーを静かに無視しなくなりました。これは必ず
<a class="reference internal" href="../library/struct.html#struct.error" title="struct.error"><tt class="xref py py-exc docutils literal"><span class="pre">struct.error</span></tt></a> 例外を送出するようになりました。
(Changed by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue1523">issue 1523</a>.)
<a class="reference internal" href="../library/struct.html#struct.pack" title="struct.pack"><tt class="xref py py-func docutils literal"><span class="pre">pack()</span></tt></a> 関数は、非整数を変換してパックするのに、
<a class="reference internal" href="../reference/datamodel.html#object.__int__" title="object.__int__"><tt class="xref py py-meth docutils literal"><span class="pre">__int__()</span></tt></a> メソッドを試したりエラーを報告したりする前に、
<a class="reference internal" href="../reference/datamodel.html#object.__index__" title="object.__index__"><tt class="xref py py-meth docutils literal"><span class="pre">__index__()</span></tt></a> の使用も試すようになりました。
(Changed by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue8300">issue 8300</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/subprocess.html#module-subprocess" title="subprocess: サブプロセス管理"><tt class="xref py py-mod docutils literal"><span class="pre">subprocess</span></tt></a> モジュールの <a class="reference internal" href="../library/subprocess.html#subprocess.check_output" title="subprocess.check_output"><tt class="xref py py-func docutils literal"><span class="pre">check_output()</span></tt></a>
は、指定された引数群でコマンドを実行し、コマンドがエラーを起こさずに実行したらコマンドの出力を文字列として返し、そうでなければ
<tt class="xref py py-exc docutils literal"><span class="pre">CalledProcessError</span></tt> 例外を送出します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s">&#39;df&#39;</span><span class="p">,</span> <span class="s">&#39;-h&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">])</span>
<span class="go">&#39;Filesystem     Size   Used  Avail Capacity  Mounted on\n</span>
<span class="go">/dev/disk0s2    52G    49G   3.0G    94%    /\n&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">subprocess</span><span class="o">.</span><span class="n">check_output</span><span class="p">([</span><span class="s">&#39;df&#39;</span><span class="p">,</span> <span class="s">&#39;-h&#39;</span><span class="p">,</span> <span class="s">&#39;/bogus&#39;</span><span class="p">])</span>
<span class="go">  ...</span>
<span class="go">subprocess.CalledProcessError: Command &#39;[&#39;df&#39;, &#39;-h&#39;, &#39;/bogus&#39;]&#39; returned non-zero exit status 1</span>
</pre></div>
</div>
<p>(Contributed by Gregory P. Smith.)</p>
<p><a class="reference internal" href="../library/subprocess.html#module-subprocess" title="subprocess: サブプロセス管理"><tt class="xref py py-mod docutils literal"><span class="pre">subprocess</span></tt></a> モジュールは、 <tt class="xref py py-const docutils literal"><span class="pre">EINTR</span></tt> シグナルを受け取り次第内部システムコールを最施行するようになりました。(Reported by several people;
final patch by Gregory P. Smith in <a class="reference external" href="http://bugs.python.org/issue1068268">issue 1068268</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../library/symtable.html#module-symtable" title="symtable: コンパイラ内部の記号表へのインターフェイス。"><tt class="xref py py-mod docutils literal"><span class="pre">symtable</span></tt></a> モジュールの
<a class="reference internal" href="../library/symtable.html#symtable.Symbol.is_declared_global" title="symtable.Symbol.is_declared_global"><tt class="xref py py-func docutils literal"><span class="pre">is_declared_global()</span></tt></a> は、明示的に global と宣言された引数には真、暗示的に global である引数には偽を返します。
(Contributed by Jeremy Hylton.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/syslog.html#module-syslog" title="syslog: Unix syslog ライブラリルーチン群へのインタフェース。 (Unix)"><tt class="xref py py-mod docutils literal"><span class="pre">syslog</span></tt></a> モジュールは、識別子として、以前デフォルトであった
<tt class="docutils literal"><span class="pre">'python'</span></tt> の値ではなく、 <tt class="docutils literal"><span class="pre">sys.argv[0]</span></tt> の値を使うようになりました。
(Changed by Sean Reifschneider; <a class="reference external" href="http://bugs.python.org/issue8451">issue 8451</a>.)</p>
</li>
<li><p class="first"><tt class="docutils literal"><span class="pre">sys.version_info</span></tt> の値は、属性名 <tt class="xref py py-attr docutils literal"><span class="pre">major</span></tt>, <tt class="xref py py-attr docutils literal"><span class="pre">minor</span></tt>,
<tt class="xref py py-attr docutils literal"><span class="pre">micro</span></tt>, <tt class="xref py py-attr docutils literal"><span class="pre">releaselevel</span></tt>, および <tt class="xref py py-attr docutils literal"><span class="pre">serial</span></tt> を持つ名前付きタプルになりました。</p>
<p><a class="reference internal" href="../library/sys.html#sys.getwindowsversion" title="sys.getwindowsversion"><tt class="xref py py-func docutils literal"><span class="pre">sys.getwindowsversion()</span></tt></a> もまた、属性名 <tt class="xref py py-attr docutils literal"><span class="pre">major</span></tt>, <tt class="xref py py-attr docutils literal"><span class="pre">minor</span></tt>,
<tt class="xref py py-attr docutils literal"><span class="pre">build</span></tt>, <a class="reference internal" href="../library/platform.html#module-platform" title="platform: 実行中プラットフォームからできるだけ多くの固有情報を取得する"><tt class="xref py py-attr docutils literal"><span class="pre">platform</span></tt></a>, <tt class="xref py py-attr docutils literal"><span class="pre">service_pack</span></tt>,
<tt class="xref py py-attr docutils literal"><span class="pre">service_pack_major</span></tt>, <tt class="xref py py-attr docutils literal"><span class="pre">service_pack_minor</span></tt>,
<tt class="xref py py-attr docutils literal"><span class="pre">suite_mask</span></tt>, および <tt class="xref py py-attr docutils literal"><span class="pre">product_type</span></tt> を持つ名前付きタプルを返します。(Contributed by Brian Curtin; <a class="reference external" href="http://bugs.python.org/issue7766">issue 7766</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/tarfile.html#module-tarfile" title="tarfile: tar-形式のアーカイブファイルを読み書きします。"><tt class="xref py py-mod docutils literal"><span class="pre">tarfile</span></tt></a> モジュールのデフォルトエラー処理が変更され、致命的なエラーを抑制しないようになりました。デフォルトのエラーレベルは以前は 0 で、エラーはメッセージとしてデバッグログに書き込まれるだけでしたが、デバッグログはデフォルトでは活性化されていないため、エラーは顧みられませんでした。デフォルトのエラーレベルは 1 になり、エラーがあれば例外が送出されます。
(Changed by Lars Gustäbel; <a class="reference external" href="http://bugs.python.org/issue7357">issue 7357</a>.)</p>
<p><a class="reference internal" href="../library/tarfile.html#module-tarfile" title="tarfile: tar-形式のアーカイブファイルを読み書きします。"><tt class="xref py py-mod docutils literal"><span class="pre">tarfile</span></tt></a> は、tar ファイルに追加される <a class="reference internal" href="../library/tarfile.html#tarfile.TarInfo" title="tarfile.TarInfo"><tt class="xref py py-class docutils literal"><span class="pre">TarInfo</span></tt></a>
オブジェクトのフィルタリングをサポートするようになりました。
<a class="reference internal" href="../library/tarfile.html#tarfile.TarFile.add" title="tarfile.TarFile.add"><tt class="xref py py-meth docutils literal"><span class="pre">add()</span></tt></a> を呼び出したとき、オプションの呼び出し可能オブジェクトである <em>filter</em> 引数を与えることができます。
<em>filter</em> オブジェクトには、ファイルが追加される度に <a class="reference internal" href="../library/tarfile.html#tarfile.TarInfo" title="tarfile.TarInfo"><tt class="xref py py-class docutils literal"><span class="pre">TarInfo</span></tt></a>
を渡され、これを変形して返せます。このオブジェクトが <tt class="docutils literal"><span class="pre">None</span></tt> を返したら、そのファイルは結果のアーカイブから除かれます。これは既存の <em>exclude</em>
引数より強力で、それゆえこれは非推奨となります。
(Added by Lars Gustäbel; <a class="reference external" href="http://bugs.python.org/issue6856">issue 6856</a>.)
<a class="reference internal" href="../library/tarfile.html#tarfile.TarFile" title="tarfile.TarFile"><tt class="xref py py-class docutils literal"><span class="pre">TarFile</span></tt></a> クラスはまた、コンテキストマネージャプロトコルもサポートするようになりました。
(Added by Lars Gustäbel; <a class="reference external" href="http://bugs.python.org/issue7232">issue 7232</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/threading.html#threading.Event" title="threading.Event"><tt class="xref py py-class docutils literal"><span class="pre">threading.Event</span></tt></a> クラスの <a class="reference internal" href="../library/threading.html#threading.Event.wait" title="threading.Event.wait"><tt class="xref py py-meth docutils literal"><span class="pre">wait()</span></tt></a> メソッドは、終了時に内部フラグを返すようになりました。 <a class="reference internal" href="../library/threading.html#threading.Event.wait" title="threading.Event.wait"><tt class="xref py py-meth docutils literal"><span class="pre">wait()</span></tt></a>
は内部フラグが真になるまでブロックすることを想定されているため、この関数は通常真を返すことになります。この戻り値は、タイムアウトが与えられ、オペレーションがタイムアウトした時のみ偽になります。
(Contributed by Tim Lesher; <a class="reference external" href="http://bugs.python.org/issue1674032">issue 1674032</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/unicodedata.html#module-unicodedata" title="unicodedata: Access the Unicode Database."><tt class="xref py py-mod docutils literal"><span class="pre">unicodedata</span></tt></a> モジュールに提供される Unicode データベースは、どの文字が数字や空白文字か、または改行を表すかを決定するために、内部で使われるようになりました。このデータベースはまた、
<tt class="file docutils literal"><span class="pre">Unihan.txt</span></tt> データファイルからの情報も含みます (patch
by Anders Chrigström and Amaury Forgeot d&#8217;Arc; <a class="reference external" href="http://bugs.python.org/issue1571184">issue 1571184</a>)。また、バージョン 5.2.0 にアップデートされました (updated by
Florent Xicluna; <a class="reference external" href="http://bugs.python.org/issue8024">issue 8024</a>)。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/urlparse.html#module-urlparse" title="urlparse: URL の解析と構築"><tt class="xref py py-mod docutils literal"><span class="pre">urlparse</span></tt></a> モジュールの <a class="reference internal" href="../library/urlparse.html#urlparse.urlsplit" title="urlparse.urlsplit"><tt class="xref py py-func docutils literal"><span class="pre">urlsplit()</span></tt></a> は、未知の URL スキームを <span class="target" id="index-9"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc3986.html"><strong>RFC 3986</strong></a> に応じた方法で処理します。
URL が <tt class="docutils literal"><span class="pre">&quot;&lt;something&gt;://...&quot;</span></tt> の形式なら、 <tt class="docutils literal"><span class="pre">://</span></tt> の前のテキストを、それがモジュールの知らない作り物のスキームであってさえ、スキームとして扱います。この変更は、古い働きを使って動作していたコードを破壊することがあります。例えば、Python 2.6.4 や 2.5 は以下を返します:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urlparse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlparse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="s">&#39;invented://host/filename?query&#39;</span><span class="p">)</span>
<span class="go">(&#39;invented&#39;, &#39;&#39;, &#39;//host/filename?query&#39;, &#39;&#39;, &#39;&#39;)</span>
</pre></div>
</div>
<p>Python 2.7 (や Python 2.6.5) は以下を返します:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urlparse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlparse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="s">&#39;invented://host/filename?query&#39;</span><span class="p">)</span>
<span class="go">(&#39;invented&#39;, &#39;host&#39;, &#39;/filename?query&#39;, &#39;&#39;, &#39;&#39;)</span>
</pre></div>
</div>
<p>(Python 2.7 では、これは普通のタプルではなく名前付きタプルを返すので、実際は微妙に異なる出力をします。)</p>
<p><a class="reference internal" href="../library/urlparse.html#module-urlparse" title="urlparse: URL の解析と構築"><tt class="xref py py-mod docutils literal"><span class="pre">urlparse</span></tt></a> モジュールは、 <span class="target" id="index-10"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc2732.html"><strong>RFC 2732</strong></a> で定義された IPv6
リテラルアドレスもサポートします
(contributed by Senthil Kumaran; <a class="reference external" href="http://bugs.python.org/issue2987">issue 2987</a>)。:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">urlparse</span><span class="o">.</span><span class="n">urlparse</span><span class="p">(</span><span class="s">&#39;http://[1080::8:800:200C:417A]/foo&#39;</span><span class="p">)</span>
<span class="go">ParseResult(scheme=&#39;http&#39;, netloc=&#39;[1080::8:800:200C:417A]&#39;,</span>
<span class="go">            path=&#39;/foo&#39;, params=&#39;&#39;, query=&#39;&#39;, fragment=&#39;&#39;)</span>
</pre></div>
</div>
</li>
<li><p class="first">新しいクラス: <a class="reference internal" href="../library/weakref.html#module-weakref" title="weakref: 弱参照と弱辞書のサポート。"><tt class="xref py py-mod docutils literal"><span class="pre">weakref</span></tt></a> モジュールの <a class="reference internal" href="../library/weakref.html#weakref.WeakSet" title="weakref.WeakSet"><tt class="xref py py-class docutils literal"><span class="pre">WeakSet</span></tt></a>
クラスは、その要素の弱参照だけを保持する集合です。要素は、それを指す参照がなくなり次第除去されます。
(Originally implemented in Python 3.x by Raymond Hettinger, and backported
to 2.7 by Michael Foord.)</p>
</li>
<li><p class="first">エレメントツリーライブラリ、 <tt class="xref py py-mod docutils literal"><span class="pre">xml.etree</span></tt> は、
(<tt class="docutils literal"><span class="pre">&lt;?xml-stylesheet</span> <span class="pre">href=&quot;#style1&quot;?&gt;</span></tt> のような) 命令や
(<tt class="docutils literal"><span class="pre">&lt;!--</span> <span class="pre">comment</span> <span class="pre">--&gt;</span></tt> のような) コメントを処理する XML を出力するとき、アンパサンドや山括弧をエスケープしなくなりました。
(Patch by Neil Muller; <a class="reference external" href="http://bugs.python.org/issue2746">issue 2746</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/xmlrpclib.html#module-xmlrpclib" title="xmlrpclib: XML-RPC client access."><tt class="xref py py-mod docutils literal"><span class="pre">xmlrpclib</span></tt></a> と <a class="reference internal" href="../library/simplexmlrpcserver.html#module-SimpleXMLRPCServer" title="SimpleXMLRPCServer: 基本的なXML-RPCサーバーの実装。"><tt class="xref py py-mod docutils literal"><span class="pre">SimpleXMLRPCServer</span></tt></a> によって提供される
XML-RPC クライアントおよびサーバは、HTTP/1.1 keep-alive をサポートし、場合によっては gzip エンコーディングを使って XML の送受を圧縮することで、パフォーマンスが向上しました。gzip 圧縮は
<tt class="xref py py-class docutils literal"><span class="pre">SimpleXMLRPCRequestHandler</span></tt> の <tt class="xref py py-attr docutils literal"><span class="pre">encode_threshold</span></tt> 属性によって制御されます。これはバイト数で、これより大きな応答は圧縮されます。
(Contributed by Kristján Valur Jónsson; <a class="reference external" href="http://bugs.python.org/issue6267">issue 6267</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/zipfile.html#module-zipfile" title="zipfile: ZIP-フォーマットのアーカイブファイルを読み書きする"><tt class="xref py py-mod docutils literal"><span class="pre">zipfile</span></tt></a> モジュールの <a class="reference internal" href="../library/zipfile.html#zipfile.ZipFile" title="zipfile.ZipFile"><tt class="xref py py-class docutils literal"><span class="pre">ZipFile</span></tt></a> は、コンテキストマネジメントプロトコルをサポートし、 <tt class="docutils literal"><span class="pre">with</span> <span class="pre">zipfile.ZipFile(...)</span> <span class="pre">as</span> <span class="pre">f:</span></tt>
と書けるようになりました。
(Contributed by Brian Curtin; <a class="reference external" href="http://bugs.python.org/issue5511">issue 5511</a>.)</p>
<p><a class="reference internal" href="../library/zipfile.html#module-zipfile" title="zipfile: ZIP-フォーマットのアーカイブファイルを読み書きする"><tt class="xref py py-mod docutils literal"><span class="pre">zipfile</span></tt></a> は、空のディレクトリのアーカイブ化をサポートするようになり、これを正しく解凍します。(Fixed by Kuba Wieczorek; <a class="reference external" href="http://bugs.python.org/issue4710">issue 4710</a>.)
アーカイブ内のファイルの読み込みが速くなり、 <a class="reference internal" href="../library/zipfile.html#zipfile.ZipFile.read" title="zipfile.ZipFile.read"><tt class="xref py py-meth docutils literal"><span class="pre">read()</span></tt></a>
および <tt class="xref py py-meth docutils literal"><span class="pre">readline()</span></tt> の割り込みが正しく働くようになりました。(Fixed by Kuba Wieczorek; <a class="reference external" href="http://bugs.python.org/issue4710">issue 4710</a>.)</p>
<p><a class="reference internal" href="../library/zipfile.html#zipfile.is_zipfile" title="zipfile.is_zipfile"><tt class="xref py py-func docutils literal"><span class="pre">is_zipfile()</span></tt></a> 関数は、以前受け付けられていたパス名に加え、ファイルオブジェクトも受け付けるようになりました。
(Contributed by Gabriel Genellina; <a class="reference external" href="http://bugs.python.org/issue4756">issue 4756</a>.)</p>
<p><a class="reference internal" href="../library/zipfile.html#zipfile.ZipFile.writestr" title="zipfile.ZipFile.writestr"><tt class="xref py py-meth docutils literal"><span class="pre">writestr()</span></tt></a> メソッドは、 <a class="reference internal" href="../library/zipfile.html#zipfile.ZipFile" title="zipfile.ZipFile"><tt class="xref py py-class docutils literal"><span class="pre">ZipFile</span></tt></a>
コンストラクタで指定されたデフォルトの圧縮メソッドをオーバライドする、オプションの <em>compress_type</em> パラメタを追加しました。
(Contributed by Ronald Oussoren; <a class="reference external" href="http://bugs.python.org/issue6003">issue 6003</a>.)</p>
</li>
</ul>
<div class="section" id="importlib">
<span id="importlib-section"></span><h3>新しいモジュール: importlib<a class="headerlink" href="#importlib" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Python 3.1 は、根底の Python の <a class="reference internal" href="../reference/simple_stmts.html#import"><tt class="xref std std-keyword docutils literal"><span class="pre">import</span></tt></a> 文のロジックの最実装である <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: Convenience wrappers for __import__"><tt class="xref py py-mod docutils literal"><span class="pre">importlib</span></tt></a> パッケージを含みます。
<a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: Convenience wrappers for __import__"><tt class="xref py py-mod docutils literal"><span class="pre">importlib</span></tt></a> は、Python インタプリタの実装者や、import プロセスに関与する新しいインポータを書きたいと願うユーザにとって便利です。
Python 2.7 は <a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: Convenience wrappers for __import__"><tt class="xref py py-mod docutils literal"><span class="pre">importlib</span></tt></a> パッケージを完全には含みませんが、代わりに 1 つの関数 <a class="reference internal" href="../library/importlib.html#importlib.import_module" title="importlib.import_module"><tt class="xref py py-func docutils literal"><span class="pre">import_module()</span></tt></a> を含む小さなサブセットがあります。</p>
<p><tt class="docutils literal"><span class="pre">import_module(name,</span> <span class="pre">package=None)</span></tt> はモジュールを import します。
<em>name</em> はモジュールまたはパッケージの名前を含む文字列です。
<tt class="docutils literal"><span class="pre">..utils.errors</span></tt> のように <tt class="docutils literal"><span class="pre">.</span></tt> 文字で始まる文字列を与えることで、相対 import も可能です。相対 import では、 <em>package</em> 引数は必ず与えられなければならず、相対 import のアンカーとして使われるパッケージの名前でなければなりません。 <a class="reference internal" href="../library/importlib.html#importlib.import_module" title="importlib.import_module"><tt class="xref py py-func docutils literal"><span class="pre">import_module()</span></tt></a> は、
import されたモジュールを <tt class="docutils literal"><span class="pre">sys.modules</span></tt> に挿入し、モジュールオブジェクトを返すこともします。</p>
<p>ここに例があります:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">importlib</span> <span class="kn">import</span> <span class="n">import_module</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">anydbm</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="s">&#39;anydbm&#39;</span><span class="p">)</span>  <span class="c"># Standard absolute import</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">anydbm</span>
<span class="go">&lt;module &#39;anydbm&#39; from &#39;/p/python/Lib/anydbm.py&#39;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c"># Relative import</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_util</span> <span class="o">=</span> <span class="n">import_module</span><span class="p">(</span><span class="s">&#39;..file_util&#39;</span><span class="p">,</span> <span class="s">&#39;distutils.command&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">file_util</span>
<span class="go">&lt;module &#39;distutils.file_util&#39; from &#39;/python/Lib/distutils/file_util.pyc&#39;&gt;</span>
</pre></div>
</div>
<p><a class="reference internal" href="../library/importlib.html#module-importlib" title="importlib: Convenience wrappers for __import__"><tt class="xref py py-mod docutils literal"><span class="pre">importlib</span></tt></a> は、Brett Cannon によって実装され、 Python 3.1 に導入されました。</p>
</div>
<div class="section" id="sysconfig">
<h3>新しいモジュール: sysconfig<a class="headerlink" href="#sysconfig" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><tt class="xref py py-mod docutils literal"><span class="pre">sysconfig</span></tt></a> モジュールが Distutils パッケージから引き抜かれ、新しいトップレベルモジュールになりました。
<a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><tt class="xref py py-mod docutils literal"><span class="pre">sysconfig</span></tt></a> は、Python のビルドプロセスについての以下の情報を得るための関数群を提供しています。コンパイラスイッチ、インストレーションパス、プラットフォーム名、そして Python がソースディレクトリから実行されているかどうかです。</p>
<p>モジュールの関数のいくつかを紹介すると:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_config_var" title="sysconfig.get_config_var"><tt class="xref py py-func docutils literal"><span class="pre">get_config_var()</span></tt></a> は、Python の Makefile と
<tt class="file docutils literal"><span class="pre">pyconfig.h</span></tt> ファイルから変数を返します。</li>
<li><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_config_vars" title="sysconfig.get_config_vars"><tt class="xref py py-func docutils literal"><span class="pre">get_config_vars()</span></tt></a> は、すべての環境設定変数を含む辞書を返します。</li>
<li><a class="reference internal" href="../library/sysconfig.html#sysconfig.get_path" title="sysconfig.get_path"><tt class="xref py py-func docutils literal"><span class="pre">get_path()</span></tt></a> は、特定のタイプのモジュール、つまり標準ライブラリ、サイト特有のモジュール、プラットフォーム特有のライブフラリなど、への設定されたパスを返します。</li>
<li><a class="reference internal" href="../library/sysconfig.html#sysconfig.is_python_build" title="sysconfig.is_python_build"><tt class="xref py py-func docutils literal"><span class="pre">is_python_build()</span></tt></a> は、Python ソースツリーからバイナリを起動していれば真を、そうでなければ偽を返します。</li>
</ul>
<p>詳細と関数の完全な一覧は <a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><tt class="xref py py-mod docutils literal"><span class="pre">sysconfig</span></tt></a> ドキュメントを参照してください。</p>
<p>Distutils パッケージと <a class="reference internal" href="../library/sysconfig.html#module-sysconfig" title="sysconfig: Python's configuration information"><tt class="xref py py-mod docutils literal"><span class="pre">sysconfig</span></tt></a> は Tarek Ziadé によってメンテナンスされていて、彼は Distutils の新世代版を開発するために
Distutils2 パッケージ (source repository at <a class="reference external" href="http://hg.python.org/distutils2/">http://hg.python.org/distutils2/</a>)
も開始しました。</p>
</div>
<div class="section" id="ttk-tk">
<h3>ttk: Tk のテーマ付きウィジェット<a class="headerlink" href="#ttk-tk" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Tcl/Tk 8.5 は、基本的な Tk ウィジェットを最実装しながらより自由な外観のカスタマイズが広がり、よりネイティブなプラットフォームのウィジェットに似たテーマ付きウィジェット群を含みます。このウィジェット群は、元は Tile と呼ばれていましたが、Tcl/Tck リリース 8.5 への追加の際に
(&#8220;themed Tk&#8221; を略して) Ttk に改名されました。</p>
<p>詳しく知るには、 <a class="reference internal" href="../library/ttk.html#module-ttk" title="ttk: Tk themed widget set"><tt class="xref py py-mod docutils literal"><span class="pre">ttk</span></tt></a> モジュールのドキュメントをお読みください。
<a class="reference external" href="http://www.tcl.tk/man/tcl8.5/TkCmd/ttk_intro.htm">http://www.tcl.tk/man/tcl8.5/TkCmd/ttk_intro.htm</a> にある、Ttk テーマエンジンを解説した Tcl/Tk マニュアルページを読むのもいいでしょう。
Python/Ttk コードを動かしているスクリーンショットは
<a class="reference external" href="http://code.google.com/p/python-ttk/wiki/Screenshots">http://code.google.com/p/python-ttk/wiki/Screenshots</a> にあります。</p>
<p><a class="reference internal" href="../library/ttk.html#module-ttk" title="ttk: Tk themed widget set"><tt class="xref py py-mod docutils literal"><span class="pre">ttk</span></tt></a> モジュールは Guilherme Polo によって書かれ、 <a class="reference external" href="http://bugs.python.org/issue2983">issue 2983</a> に追加されました。 <tt class="docutils literal"><span class="pre">Tile.py</span></tt> と呼ばれる別バージョン <tt class="docutils literal"><span class="pre">Tile.py</span></tt> は、
Martin Franklin によって書かれ、Kevin Walzer によってメンテナンスされているもので、組み込みが <a class="reference external" href="http://bugs.python.org/issue2618">issue 2618</a> で提案されましたが、著者は Guilherme Polo の作品のほうがより包括的であると主張しました。</p>
</div>
<div class="section" id="unittest">
<span id="unittest-section"></span><h3>更新されたモジュール: unittest<a class="headerlink" href="#unittest" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="../library/unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> モジュールが大幅に改善されました。多くの新機能が追加されました。それらの機能のほとんどは、特に注釈のない限り、
Michael Foord によって実装されました。このモジュールの改善された版は、
Python バージョン 2.4 から 2.6 で使うために、
<a class="reference external" href="http://pypi.python.org/pypi/unittest2">http://pypi.python.org/pypi/unittest2</a> から <tt class="xref py py-mod docutils literal"><span class="pre">unittest2</span></tt> パッケージとして別にダウンロードできます。</p>
<p>コマンドラインから使われるとき、このモジュールはテストを自動的に発見します。これは <a class="reference external" href="http://pytest.org">py.test</a> や
<a class="reference external" href="http://code.google.com/p/python-nose/">nose</a> ほど派手ではありませんが、テストをパッケージディレクトリに保持されたテストを簡潔に実行する方法を提供します。例えば、以下のコマンドは <tt class="file docutils literal"><span class="pre">test/</span></tt> サブディレクトリから
<tt class="docutils literal"><span class="pre">test*.py</span></tt> という名前の import できるテストファイル検索します:</p>
<div class="highlight-python"><pre>python -m unittest discover -s test</pre>
</div>
<p>詳細は、 <a class="reference internal" href="../library/unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> モジュールのドキュメントを参照してください。
(Developed in <a class="reference external" href="http://bugs.python.org/issue6001">issue 6001</a>.)</p>
<p><a class="reference internal" href="../library/unittest.html#unittest.main" title="unittest.main"><tt class="xref py py-func docutils literal"><span class="pre">main()</span></tt></a> 関数は、その他幾つかの新しいオプションを提供します:</p>
<ul>
<li><p class="first"><em class="xref std std-option">-b</em> や <em class="xref std std-option">--buffer</em> は、標準出力や標準エラーストリームをそれぞれのテストの間バッファに入れます。テストが通れば、結果の出力は全て捨てられます。失敗したら、バッファに入れられた出力が表示されます。</p>
</li>
<li><p class="first"><a class="reference internal" href="../using/cmdline.html#cmdoption-c"><em class="xref std std-option">-c</em></a> や <em class="xref std std-option">--catch</em> は、control-C による中断をより上品にします。テストプロセスを即座に中断するのではなく、現在実行中のテストは完了させ、中断までの部分的な結果は報告されます。待ちきれなければ、control-C をもう一度押せば、即座に中断されます。</p>
<p>この control-C ハンドラは、コードがテストされているときや、実行されているテストが独自のシグナルハンドラを定義したとき、シグナルハンドラがすでに設定されていてそして呼び出されたということを知らせることで、問題を起こさないようにします。これがまずいなら、
<a class="reference internal" href="../library/unittest.html#unittest.removeHandler" title="unittest.removeHandler"><tt class="xref py py-func docutils literal"><span class="pre">removeHandler()</span></tt></a> デコレータを使って、テストが control-C
ハンドリングを無効にするべきであると示せます。</p>
</li>
<li><p class="first"><em class="xref std std-option">-f</em> や <em class="xref std std-option">--failfast</em> は、テストが失敗したとき、他のテストを続けるのではなく、テストの実行を即座に停止します。
(Suggested by Cliff Dyer and implemented by Michael Foord; <a class="reference external" href="http://bugs.python.org/issue8074">issue 8074</a>.)</p>
</li>
</ul>
<p>進捗メッセージは、verbose モードで実行したとき、期待された失敗に &#8216;x&#8217; を、期待されない成功に &#8216;u&#8217; を表示するようになりました。
(Contributed by Benjamin Peterson.)</p>
<p>テストケースは、テストをスキップするために <tt class="xref py py-exc docutils literal"><span class="pre">SkipTest</span></tt>
例外を送出します。(<a class="reference external" href="http://bugs.python.org/issue1034053">issue 1034053</a>).</p>
<p><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertEqual()</span></tt></a>, <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertTrue" title="unittest.TestCase.assertTrue"><tt class="xref py py-meth docutils literal"><span class="pre">assertTrue()</span></tt></a>,
および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertFalse" title="unittest.TestCase.assertFalse"><tt class="xref py py-meth docutils literal"><span class="pre">assertFalse()</span></tt></a> 失敗のメッセージは、提供する情報量が増えました。 <a class="reference internal" href="../library/unittest.html#unittest.TestCase" title="unittest.TestCase"><tt class="xref py py-class docutils literal"><span class="pre">TestCase</span></tt></a> クラスの
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.longMessage" title="unittest.TestCase.longMessage"><tt class="xref py py-attr docutils literal"><span class="pre">longMessage</span></tt></a> 属性を True に設定すると、失敗時に、標準のエラーメッセージと追加して提供したメッセージの両方が表示されます。(Added by Michael Foord; <a class="reference external" href="http://bugs.python.org/issue5663">issue 5663</a>.)</p>
<p><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertRaises" title="unittest.TestCase.assertRaises"><tt class="xref py py-meth docutils literal"><span class="pre">assertRaises()</span></tt></a> メソッドは、実行する呼び出し可能オブジェクトを与えずに呼び出されたとき、コンテキストハンドラを返すようになりました。例えば、こう書くことができます:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">assertRaises</span><span class="p">(</span><span class="ne">KeyError</span><span class="p">):</span>
    <span class="p">{}[</span><span class="s">&#39;foo&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>(Implemented by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue4444">issue 4444</a>.)</p>
<p>モジュールレベルおよびクラスレベルの設定と、ティアダウンフィクスチャがサポートされました。モジュールは、 <tt class="xref py py-func docutils literal"><span class="pre">setUpModule()</span></tt> および
<tt class="xref py py-func docutils literal"><span class="pre">tearDownModule()</span></tt> 関数を含むことができます。クラスは
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.setUpClass" title="unittest.TestCase.setUpClass"><tt class="xref py py-meth docutils literal"><span class="pre">setUpClass()</span></tt></a> および
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.tearDownClass" title="unittest.TestCase.tearDownClass"><tt class="xref py py-meth docutils literal"><span class="pre">tearDownClass()</span></tt></a> メソッドを含むことができ、これらは (<tt class="docutils literal"><span class="pre">&#64;classmethod</span></tt> や透過なものを使って) クラスメソッドとして定義しなければなりません。これらの関数とメソッドは、テストランナーが別のモジュールやクラスのテストケースに切り替えるときに呼び出されます。</p>
<p>メソッド <a class="reference internal" href="../library/unittest.html#unittest.TestCase.addCleanup" title="unittest.TestCase.addCleanup"><tt class="xref py py-meth docutils literal"><span class="pre">addCleanup()</span></tt></a> および
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.doCleanups" title="unittest.TestCase.doCleanups"><tt class="xref py py-meth docutils literal"><span class="pre">doCleanups()</span></tt></a> が追加されました。
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.addCleanup" title="unittest.TestCase.addCleanup"><tt class="xref py py-meth docutils literal"><span class="pre">addCleanup()</span></tt></a> で、無条件に呼び出されるクリーンアップ関数を (<a class="reference internal" href="../library/unittest.html#unittest.TestCase.setUp" title="unittest.TestCase.setUp"><tt class="xref py py-meth docutils literal"><span class="pre">setUp()</span></tt></a> が失敗したら
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.setUp" title="unittest.TestCase.setUp"><tt class="xref py py-meth docutils literal"><span class="pre">setUp()</span></tt></a> の後に、そうでなければ
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.tearDown" title="unittest.TestCase.tearDown"><tt class="xref py py-meth docutils literal"><span class="pre">tearDown()</span></tt></a> の後に) 追加できるようにします。これにより、テスト中のリソースの配置と開放が簡潔になります。(<a class="reference external" href="http://bugs.python.org/issue5679">issue 5679</a>).</p>
<p>より特化したテストを提供するメソッドがいくつか追加されました。これらのメソッドの多くは、Google のエンジニアたちによってそのテストスイートのために書かれました。Gregory P. Smith, Michael Foord, and
GvR が、これを <a class="reference internal" href="../library/unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> の Python 版にマージしました。</p>
<ul class="simple">
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertIsNone" title="unittest.TestCase.assertIsNone"><tt class="xref py py-meth docutils literal"><span class="pre">assertIsNone()</span></tt></a> および
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertIsNotNone" title="unittest.TestCase.assertIsNotNone"><tt class="xref py py-meth docutils literal"><span class="pre">assertIsNotNone()</span></tt></a> はひとつの式を取り、その結果が
<tt class="docutils literal"><span class="pre">NONE</span></tt> であるか、またはないかを確かめます。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertIs" title="unittest.TestCase.assertIs"><tt class="xref py py-meth docutils literal"><span class="pre">assertIs()</span></tt></a> および
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertIsNot" title="unittest.TestCase.assertIsNot"><tt class="xref py py-meth docutils literal"><span class="pre">assertIsNot()</span></tt></a> は、2 つの値を取り、その評価が同一のオブジェクトであるか、またはないかを確かめます。
(Added by Michael Foord; <a class="reference external" href="http://bugs.python.org/issue2578">issue 2578</a>.)</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertIsInstance" title="unittest.TestCase.assertIsInstance"><tt class="xref py py-meth docutils literal"><span class="pre">assertIsInstance()</span></tt></a> および
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNotIsInstance" title="unittest.TestCase.assertNotIsInstance"><tt class="xref py py-meth docutils literal"><span class="pre">assertNotIsInstance()</span></tt></a> は、結果のオブジェクトが特定のクラス、またはタプルにあるクラスのいずれかのインスタンスであるかを調べます。(Added by Georg Brandl; <a class="reference external" href="http://bugs.python.org/issue7031">issue 7031</a>.)</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertGreater" title="unittest.TestCase.assertGreater"><tt class="xref py py-meth docutils literal"><span class="pre">assertGreater()</span></tt></a>, <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertGreaterEqual" title="unittest.TestCase.assertGreaterEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertGreaterEqual()</span></tt></a>,
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertLess" title="unittest.TestCase.assertLess"><tt class="xref py py-meth docutils literal"><span class="pre">assertLess()</span></tt></a>, および
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertLessEqual" title="unittest.TestCase.assertLessEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertLessEqual()</span></tt></a> は、二つの量を比較します。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertMultiLineEqual" title="unittest.TestCase.assertMultiLineEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertMultiLineEqual()</span></tt></a> は 2 つの文字列を比較し、等しくなければ、2 文字列の差分をハイライトする有益な比較を表示します。この比較は、Unicode 文字列が <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertEqual()</span></tt></a>
で比較されるときのデフォルトに使われるようになりました。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertRegexpMatches" title="unittest.TestCase.assertRegexpMatches"><tt class="xref py py-meth docutils literal"><span class="pre">assertRegexpMatches()</span></tt></a> および
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNotRegexpMatches" title="unittest.TestCase.assertNotRegexpMatches"><tt class="xref py py-meth docutils literal"><span class="pre">assertNotRegexpMatches()</span></tt></a> は、第一引数が第二引数として与えられた正規表現にマッチする、またはしない文字列であるかどうかを調べます。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertRaisesRegexp" title="unittest.TestCase.assertRaisesRegexp"><tt class="xref py py-meth docutils literal"><span class="pre">assertRaisesRegexp()</span></tt></a> は、特定の式が送出されるかを調べ、そしてまたその式の文字列表現が与えられた正規表現にマッチするかを調べます。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertIn" title="unittest.TestCase.assertIn"><tt class="xref py py-meth docutils literal"><span class="pre">assertIn()</span></tt></a> および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNotIn" title="unittest.TestCase.assertNotIn"><tt class="xref py py-meth docutils literal"><span class="pre">assertNotIn()</span></tt></a>
は、 <em>first</em> が <em>second</em> に属するか、または属さないかを調べます。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertItemsEqual" title="unittest.TestCase.assertItemsEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertItemsEqual()</span></tt></a> は、2 つの与えられたシーケンスが同じ要素を含むかを調べます。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertSetEqual" title="unittest.TestCase.assertSetEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertSetEqual()</span></tt></a> は、2 つの集合が等しいか比較し、エラーの場合のみ、集合間の差分を報告します。</li>
<li>同様に、 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertListEqual" title="unittest.TestCase.assertListEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertListEqual()</span></tt></a> および <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertTupleEqual" title="unittest.TestCase.assertTupleEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertTupleEqual()</span></tt></a>
は、指定された型を比較し、差分を説明しますが、完全な値を表示するとはかぎりません。これらのメソッドは、リストやタプルを
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertEqual()</span></tt></a> で比較するときにデフォルトで使われるようになりました。より一般的には、
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertSequenceEqual" title="unittest.TestCase.assertSequenceEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertSequenceEqual()</span></tt></a> は 2 つのシーケンスを比較し、必要なら両方のシーケンスが特定の型であるかを調べます。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertDictEqual" title="unittest.TestCase.assertDictEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertDictEqual()</span></tt></a> は、二つの辞書を比較し、差分を報告します。これは、辞書を <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertEqual()</span></tt></a>
で比較するときにデフォルトで使われるようになりました。
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertDictContainsSubset" title="unittest.TestCase.assertDictContainsSubset"><tt class="xref py py-meth docutils literal"><span class="pre">assertDictContainsSubset()</span></tt></a> は、
<em>first</em> に属するキー/値の対の全てが <em>second</em> に現れるかを調べます。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertAlmostEqual" title="unittest.TestCase.assertAlmostEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertAlmostEqual()</span></tt></a> および
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertNotAlmostEqual" title="unittest.TestCase.assertNotAlmostEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertNotAlmostEqual()</span></tt></a> は、 <em>first</em> と <em>second</em>
がほぼ等しいかを判定します。このメソッドは、オプションで指定された
<em>places</em> (デフォルトは 7) の数に差を丸めてそれをゼロと比べるか、差が与えられた <em>delta</em> の値より小さいことを要求します。</li>
<li><a class="reference internal" href="../library/unittest.html#unittest.TestLoader.loadTestsFromName" title="unittest.TestLoader.loadTestsFromName"><tt class="xref py py-meth docutils literal"><span class="pre">loadTestsFromName()</span></tt></a> は、
<a class="reference internal" href="../library/unittest.html#unittest.TestLoader" title="unittest.TestLoader"><tt class="xref py py-class docutils literal"><span class="pre">TestLoader</span></tt></a> の <a class="reference internal" href="../library/unittest.html#unittest.TestLoader.suiteClass" title="unittest.TestLoader.suiteClass"><tt class="xref py py-attr docutils literal"><span class="pre">suiteClass</span></tt></a>
属性を適切に受け入れます。(Fixed by Mark Roddy; <a class="reference external" href="http://bugs.python.org/issue6866">issue 6866</a>.)</li>
<li>新しいフックにより、 <a class="reference internal" href="../library/unittest.html#unittest.TestCase.assertEqual" title="unittest.TestCase.assertEqual"><tt class="xref py py-meth docutils literal"><span class="pre">assertEqual()</span></tt></a> メソッドを拡張して新しいデータ型を扱わせられます。
<a class="reference internal" href="../library/unittest.html#unittest.TestCase.addTypeEqualityFunc" title="unittest.TestCase.addTypeEqualityFunc"><tt class="xref py py-meth docutils literal"><span class="pre">addTypeEqualityFunc()</span></tt></a> メソッドは型オブジェクトと関数を取ります。この関数は、比較される両方のオブジェクトが特定の型であるときに使われます。この関数は、2 つのオブジェクトを比較し、マッチしなければ例外を送出するべきです。この関数が、新しいシーケンス比較メソッドがするように、2 つのオブジェクトがなぜマッチしないのかについて追加の情報を提供するのがいいアイデアです。</li>
</ul>
<p><a class="reference internal" href="../library/unittest.html#unittest.main" title="unittest.main"><tt class="xref py py-func docutils literal"><span class="pre">unittest.main()</span></tt></a> はオプションの <tt class="docutils literal"><span class="pre">exit</span></tt> 引数を取るようになりました。
False なら、 <a class="reference internal" href="../library/unittest.html#unittest.main" title="unittest.main"><tt class="xref py py-func docutils literal"><span class="pre">main()</span></tt></a> は <a class="reference internal" href="../library/sys.html#sys.exit" title="sys.exit"><tt class="xref py py-func docutils literal"><span class="pre">sys.exit()</span></tt></a> を呼び出さず、これにより対話型インタプリタから <a class="reference internal" href="../library/unittest.html#unittest.main" title="unittest.main"><tt class="xref py py-func docutils literal"><span class="pre">main()</span></tt></a> が使えるようになります。
(Contributed by J. Pablo Fernández; <a class="reference external" href="http://bugs.python.org/issue3379">issue 3379</a>.)</p>
<p><a class="reference internal" href="../library/unittest.html#unittest.TestResult" title="unittest.TestResult"><tt class="xref py py-class docutils literal"><span class="pre">TestResult</span></tt></a> に、テストランの直前と直後に呼び出される
<a class="reference internal" href="../library/unittest.html#unittest.TestResult.startTestRun" title="unittest.TestResult.startTestRun"><tt class="xref py py-meth docutils literal"><span class="pre">startTestRun()</span></tt></a> および
<a class="reference internal" href="../library/unittest.html#unittest.TestResult.stopTestRun" title="unittest.TestResult.stopTestRun"><tt class="xref py py-meth docutils literal"><span class="pre">stopTestRun()</span></tt></a> が追加されました。
(Contributed by Robert Collins; <a class="reference external" href="http://bugs.python.org/issue5728">issue 5728</a>.)</p>
<p>これら一連の変更により、 <tt class="file docutils literal"><span class="pre">unittest.py</span></tt> は無様に大きくなったので、モジュールはパッケージとなり、コードは複数のファイルに分割されました
(by Benjamin Peterson)。これは、モジュールをインポートして使う方法には影響しません。</p>
<div class="admonition- admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.voidspace.org.uk/python/articles/unittest2.shtml">http://www.voidspace.org.uk/python/articles/unittest2.shtml</a></dt>
<dd>Describes the new features, how to use them, and the
rationale for various design decisions.  (By Michael Foord.)</dd>
</dl>
</div>
</div>
<div class="section" id="elementtree-1-3">
<span id="elementtree-section"></span><h3>更新されたモジュール: ElementTree 1.3<a class="headerlink" href="#elementtree-1-3" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Python に同梱される ElementTree ライブラリのバージョンが、バージョン 1.3 にアップデートされました。新機能の一部は:</p>
<ul>
<li><p class="first">様々な解析関数が、使われる <tt class="xref py py-class docutils literal"><span class="pre">XMLParser</span></tt> インスタンスを与える
<em>parser</em> キーワード引数を取るようになりました。これにより、ファイルの内部エンコーディングをオーバーライドできるようになりました:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">p</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">XMLParser</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf-8&#39;</span><span class="p">)</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;root/&gt;&quot;&quot;&quot;</span><span class="p">,</span> <span class="n">parser</span><span class="o">=</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<p>XML を解析するときのエラーは、 <tt class="xref py py-exc docutils literal"><span class="pre">ParseError</span></tt> 例外を送出するようになりました。この例外のインスタンスは、問題の位置を与える (<em>line</em>, <em>column</em>)
タプルを含む <tt class="xref py py-attr docutils literal"><span class="pre">position</span></tt> 属性を持ちます。</p>
</li>
<li><p class="first">ツリーを文字列に変換する ElementTree のコードが大幅に改善され、多くの場合でおおよそ 2 倍速くなりました。 <tt class="xref py py-class docutils literal"><span class="pre">ElementTree</span></tt> <tt class="xref py py-meth docutils literal"><span class="pre">write()</span></tt>
および <tt class="xref py py-class docutils literal"><span class="pre">Element</span></tt> <tt class="xref py py-meth docutils literal"><span class="pre">write()</span></tt> メソッドは、 <em>method</em> パラメタを追加し、これは &#8220;xml&#8221; (デフォルト), &#8220;html&#8221;, または &#8220;text&#8221; にできます。
HTML モードは、空の要素を <tt class="docutils literal"><span class="pre">&lt;empty/&gt;</span></tt> ではなく <tt class="docutils literal"><span class="pre">&lt;empty&gt;&lt;/empty&gt;</span></tt> として出力し、text モードは要素を無視し、テキストのチャンクのみ出力します。要素の <tt class="xref py py-attr docutils literal"><span class="pre">tag</span></tt> 属性を <tt class="docutils literal"><span class="pre">None</span></tt> に設定してその子はそのままにすると、ツリーが書き出されるとき、その要素は省かれるので、それ以上再編成することなく要素を一つ取り除けます。</p>
<p>名前空間の操作も改善されました。すべての <tt class="docutils literal"><span class="pre">xmlns:&lt;whatever&gt;</span></tt> 宣言は、結果の XML に散らばるのではなく、ルート要素に出力されます。
<tt class="xref py py-attr docutils literal"><span class="pre">default_namespace</span></tt> 属性を設定することでデフォルトの名前空間を設定でき、 <tt class="xref py py-meth docutils literal"><span class="pre">register_namespace()</span></tt> で新しい接頭辞を登録できます。
XML モードでは、XML 宣言を抑制するために真/偽の <em>xml_declaration</em>
パラメタを使えます。</p>
</li>
<li><p class="first">新しい <tt class="xref py py-class docutils literal"><span class="pre">Element</span></tt> メソッド: <tt class="xref py py-meth docutils literal"><span class="pre">extend()</span></tt> はシーケンスから項目の子に要素を追加します。要素それ自体はシーケンスのように振る舞うので、子をある要素から別の要素に移すのが簡単です:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span> <span class="k">as</span> <span class="n">ET</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;list&gt;</span>
<span class="s">  &lt;item&gt;1&lt;/item&gt; &lt;item&gt;2&lt;/item&gt;  &lt;item&gt;3&lt;/item&gt;</span>
<span class="s">&lt;/list&gt;&quot;&quot;&quot;</span><span class="p">)</span>
<span class="n">new</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s">&#39;&lt;root/&gt;&#39;</span><span class="p">)</span>
<span class="n">new</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="c"># Outputs &lt;root&gt;&lt;item&gt;1&lt;/item&gt;...&lt;/root&gt;</span>
<span class="k">print</span> <span class="n">ET</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">新しい <tt class="xref py py-class docutils literal"><span class="pre">Element</span></tt> メソッド: <a class="reference internal" href="../library/functions.html#iter" title="iter"><tt class="xref py py-meth docutils literal"><span class="pre">iter()</span></tt></a> は、要素の子をジェネレータとして与えます。また、 <tt class="docutils literal"><span class="pre">for</span> <span class="pre">child</span> <span class="pre">in</span> <span class="pre">elem:</span></tt> と書いて要素の子に渡ってループできます。既存のメソッド <tt class="xref py py-meth docutils literal"><span class="pre">getiterator()</span></tt> と、子のリストを構成して返す <tt class="xref py py-meth docutils literal"><span class="pre">getchildren()</span></tt> は、非推奨になりました。</p>
</li>
<li><p class="first">新しい <tt class="xref py py-class docutils literal"><span class="pre">Element</span></tt> メソッド: <tt class="xref py py-meth docutils literal"><span class="pre">itertext()</span></tt> は、その要素の子孫であるテキストのチャンクを全て与えます。例えば:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">t</span> <span class="o">=</span> <span class="n">ET</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s">&quot;&quot;&quot;&lt;list&gt;</span>
<span class="s">  &lt;item&gt;1&lt;/item&gt; &lt;item&gt;2&lt;/item&gt;  &lt;item&gt;3&lt;/item&gt;</span>
<span class="s">&lt;/list&gt;&quot;&quot;&quot;</span><span class="p">)</span>

<span class="c"># Outputs [&#39;\n  &#39;, &#39;1&#39;, &#39; &#39;, &#39;2&#39;, &#39;  &#39;, &#39;3&#39;, &#39;\n&#39;]</span>
<span class="k">print</span> <span class="nb">list</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">itertext</span><span class="p">())</span>
</pre></div>
</div>
</li>
<li><p class="first">非推奨: 要素をブール値として使う (すなわち、 <tt class="docutils literal"><span class="pre">if</span> <span class="pre">elem:</span></tt>) と、要素が子を持てば真を、子を持たなければ偽を返します。この振る舞いは紛らわしいです &#8211; ですから、 <a class="reference internal" href="../library/exceptions.html#exceptions.FutureWarning" title="exceptions.FutureWarning"><tt class="xref py py-exc docutils literal"><span class="pre">FutureWarning</span></tt></a> を引き起こすようになりました。コードでは、明示するべきです。子の数に興味があるなら <tt class="docutils literal"><span class="pre">len(elem)</span> <span class="pre">!=</span> <span class="pre">0</span></tt> と、または <tt class="docutils literal"><span class="pre">elem</span> <span class="pre">is</span> <span class="pre">not</span> <span class="pre">None</span></tt>
と書いてください。</p>
</li>
</ul>
<p>Fredrik Lundh は ElementTree を開発し、1.3 バージョンを作成しました。
1.3 を解説した彼の記事を
<a class="reference external" href="http://effbot.org/zone/elementtree-13-intro.htm">http://effbot.org/zone/elementtree-13-intro.htm</a> で読めます。
Florent Xicluna は、python-dev および <a class="reference external" href="http://bugs.python.org/issue6472">issue 6472</a> での議論の後、
Python に含まれるバージョンをアップデートしました。</p>
</div>
</div>
<div class="section" id="c-api">
<h2>ビルドと C API の変更<a class="headerlink" href="#c-api" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>パイソンのビルド過程と C API に以下のような変更がなされました:</p>
<ul>
<li><p class="first">GNU デバッガ、GDB 7、の最新のリリースは <a class="reference external" href="http://sourceware.org/gdb/current/onlinedocs/gdb/Python.html">Python を使って書けます</a>
実行可能なプログラム P のデバッグを始めるとき、GDB は <tt class="docutils literal"><span class="pre">P-gdb.py</span></tt> という名前のファイルをロックし、それを自動的に読み込みます。Dave Malcolm は
Python 自体をデバッグするときに便利ないくつかのコマンドを加える
<tt class="file docutils literal"><span class="pre">python-gdb.py</span></tt> に貢献しました。例えば、 <tt class="docutils literal"><span class="pre">py-up</span></tt> および
<tt class="docutils literal"><span class="pre">py-down</span></tt> は、通常いくつかの C スタックフレームに対応する、
Python のスタックフレームを上がったり下がったりします。
<tt class="docutils literal"><span class="pre">py-print</span></tt> は、Python 変数の値を表示し、 <tt class="docutils literal"><span class="pre">py-bt</span></tt> は、
Python スタックトレースを表示します。(Added as a result of <a class="reference external" href="http://bugs.python.org/issue8032">issue 8032</a>.)</p>
</li>
<li><p class="first">Python に備え付けの <tt class="file docutils literal"><span class="pre">.gdbinit</span></tt> ファイルを使うと、デバッグされているスレッドが GIL をほじしていないとき、2.7 バージョンの
&#8220;pyo&#8221; マクロが正常に動くようになりました。このマクロは、表示の前にこれを取得するようになりました。
(Contributed by Victor Stinner; <a class="reference external" href="http://bugs.python.org/issue3632">issue 3632</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../c-api/init.html#Py_AddPendingCall" title="Py_AddPendingCall"><tt class="xref c c-func docutils literal"><span class="pre">Py_AddPendingCall()</span></tt></a> はスレッドセーフになり、ワーカスレッドがメイン Python スレッドに通知を投入することができるようになりました。これは特に、非同時性の IO 処理に便利です。
(Contributed by Kristján Valur Jónsson; <a class="reference external" href="http://bugs.python.org/issue4293">issue 4293</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../c-api/code.html#PyCode_NewEmpty" title="PyCode_NewEmpty"><tt class="xref c c-func docutils literal"><span class="pre">PyCode_NewEmpty()</span></tt></a> は、空のコードオブジェクトを生成します。要求されるのは、ファイル名、関数名、そして最初の行番号だけです。これは、より便利なトレースバックスタックを構成しようとする拡張モジュールに便利です。以前は、このような拡張はより多くの引数を必要とする
<a class="reference internal" href="../c-api/code.html#PyCode_New" title="PyCode_New"><tt class="xref c c-func docutils literal"><span class="pre">PyCode_New()</span></tt></a> を呼び出す必要がありました。(Added by Jeffrey Yasskin.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../c-api/exceptions.html#PyErr_NewExceptionWithDoc" title="PyErr_NewExceptionWithDoc"><tt class="xref c c-func docutils literal"><span class="pre">PyErr_NewExceptionWithDoc()</span></tt></a> は、既存の <a class="reference internal" href="../c-api/exceptions.html#PyErr_NewException" title="PyErr_NewException"><tt class="xref c c-func docutils literal"><span class="pre">PyErr_NewException()</span></tt></a> と同じように新しい例外クラスを生成しますが、新しい例外クラスの docstring を含む、追加の <tt class="docutils literal"><span class="pre">char</span> <span class="pre">*</span></tt> 引数を取ります。(Added by &#8216;lekma&#8217; on the Python bug tracker; <a class="reference external" href="http://bugs.python.org/issue7033">issue 7033</a>.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../c-api/reflection.html#PyFrame_GetLineNumber" title="PyFrame_GetLineNumber"><tt class="xref c c-func docutils literal"><span class="pre">PyFrame_GetLineNumber()</span></tt></a> はフレームオブジェクトを取り、そのフレームが現在実行している行番号を返します。以前は、コードは現在実行しているバイトコード命令のインデクスを得て、それからそのアドレスに対応する行番号を探索する必要がありました。
(Added by Jeffrey Yasskin.)</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../c-api/long.html#PyLong_AsLongAndOverflow" title="PyLong_AsLongAndOverflow"><tt class="xref c c-func docutils literal"><span class="pre">PyLong_AsLongAndOverflow()</span></tt></a> および
<a class="reference internal" href="../c-api/long.html#PyLong_AsLongLongAndOverflow" title="PyLong_AsLongLongAndOverflow"><tt class="xref c c-func docutils literal"><span class="pre">PyLong_AsLongLongAndOverflow()</span></tt></a> は、C の <tt class="xref c c-type docutils literal"><span class="pre">long</span></tt> や
<tt class="xref c c-type docutils literal"><span class="pre">long</span> <span class="pre">long</span></tt> のような Python の長整数に近いです。この数が出力型に適合するには大きすぎるなら、 <em>overflow</em> フラグが設定され、呼び出し元に返されます。
(Contributed by Case Van Horsen; <a class="reference external" href="http://bugs.python.org/issue7528">issue 7528</a> and <a class="reference external" href="http://bugs.python.org/issue7767">issue 7767</a>.)</p>
</li>
<li><p class="first">新しい関数: 文字列から浮動小数点数への変換から由来する、新しい
<a class="reference internal" href="../c-api/conversion.html#PyOS_string_to_double" title="PyOS_string_to_double"><tt class="xref c c-func docutils literal"><span class="pre">PyOS_string_to_double()</span></tt></a> 関数が追加されました。古い <a class="reference internal" href="../c-api/conversion.html#PyOS_ascii_strtod" title="PyOS_ascii_strtod"><tt class="xref c c-func docutils literal"><span class="pre">PyOS_ascii_strtod()</span></tt></a> および <a class="reference internal" href="../c-api/conversion.html#PyOS_ascii_atof" title="PyOS_ascii_atof"><tt class="xref c c-func docutils literal"><span class="pre">PyOS_ascii_atof()</span></tt></a> は、非推奨となりました。</p>
</li>
<li><p class="first">新しい関数: <a class="reference internal" href="../c-api/init.html#PySys_SetArgvEx" title="PySys_SetArgvEx"><tt class="xref c c-func docutils literal"><span class="pre">PySys_SetArgvEx()</span></tt></a> は、 <tt class="docutils literal"><span class="pre">sys.argv</span></tt> の値を設定し、
<em>updatepath</em> に依ってオプションで <tt class="docutils literal"><span class="pre">sys.path</span></tt> を更新して
<tt class="docutils literal"><span class="pre">sys.argv[0]</span></tt> で指名されたスクリプトを含むディレクトリを含めることができます。</p>
<p>この関数は、Python を埋め込んだアプリケーションのセキュリティホールを塞ぐために追加されました。古い関数 <a class="reference internal" href="../c-api/init.html#PySys_SetArgv" title="PySys_SetArgv"><tt class="xref c c-func docutils literal"><span class="pre">PySys_SetArgv()</span></tt></a> は、必ず
<tt class="docutils literal"><span class="pre">sys.path</span></tt> を更新し、これはカレントディレクトリを追加することがあります。これにより、Python を埋め込んだアプリケーションを別の誰かが制御するディレクトリで実行すると、攻撃者がディレクトリにトロイの木馬モジュール
(例えば、 <tt class="file docutils literal"><span class="pre">os.py</span></tt> という名前のファイル) を仕込み、インポートさせ実行させる事ができました。</p>
<p>Python を埋め込んだアプリケーションを保守しているなら、
<a class="reference internal" href="../c-api/init.html#PySys_SetArgv" title="PySys_SetArgv"><tt class="xref c c-func docutils literal"><span class="pre">PySys_SetArgv()</span></tt></a> を呼び出していないか調べ、 <em>updatepath</em> を偽に設定した
<a class="reference internal" href="../c-api/init.html#PySys_SetArgvEx" title="PySys_SetArgvEx"><tt class="xref c c-func docutils literal"><span class="pre">PySys_SetArgvEx()</span></tt></a> を使うべきかよく考えてください。</p>
<p><a class="reference external" href="http://bugs.python.org/issue5753">issue 5753</a> で <a class="reference external" href="http://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2008-5983">CVE-2008-5983</a>
として報告され、Antoine Pitrou によって修正されたたセキュリティ問題です。</p>
</li>
<li><p class="first">新しいマクロ: Python ヘッダファイルは、以下のマクロを定義しました:
<tt class="xref c c-macro docutils literal"><span class="pre">Py_ISALNUM</span></tt>,
<tt class="xref c c-macro docutils literal"><span class="pre">Py_ISALPHA</span></tt>,
<tt class="xref c c-macro docutils literal"><span class="pre">Py_ISDIGIT</span></tt>,
<tt class="xref c c-macro docutils literal"><span class="pre">Py_ISLOWER</span></tt>,
<tt class="xref c c-macro docutils literal"><span class="pre">Py_ISSPACE</span></tt>,
<tt class="xref c c-macro docutils literal"><span class="pre">Py_ISUPPER</span></tt>,
<tt class="xref c c-macro docutils literal"><span class="pre">Py_ISXDIGIT</span></tt>,
<tt class="xref c c-macro docutils literal"><span class="pre">Py_TOLOWER</span></tt>, および <tt class="xref c c-macro docutils literal"><span class="pre">Py_TOUPPER</span></tt> 。これらすべての関数は、文字を分類する C の標準マクロと類似ですが、
Python は文字をロケールに依らず文字を分析したいときがあるため、現在のロケール設定を無視します。(Added by Eric Smith; <a class="reference external" href="http://bugs.python.org/issue5793">issue 5793</a>.)</p>
</li>
<li><p class="first">取り除かれた関数: <tt class="xref c c-macro docutils literal"><span class="pre">PyEval_CallObject</span></tt> は、マクロとしてのみ利用できるようになりました。関数版は、ABI リンク互換性を保つために残されましたが、それは 1997 年のことです。今となっては削除するべきです。
(Removed by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue8276">issue 8276</a>.)</p>
</li>
<li><p class="first">新しいフォーマットコード: <tt class="xref c c-func docutils literal"><span class="pre">PyFormat_FromString()</span></tt>,
<tt class="xref c c-func docutils literal"><span class="pre">PyFormat_FromStringV()</span></tt>, および <a class="reference internal" href="../c-api/exceptions.html#PyErr_Format" title="PyErr_Format"><tt class="xref c c-func docutils literal"><span class="pre">PyErr_Format()</span></tt></a> 関数は、
C の <tt class="xref c c-type docutils literal"><span class="pre">long</span> <span class="pre">long</span></tt> 型を表示する <tt class="docutils literal"><span class="pre">%lld</span></tt> および <tt class="docutils literal"><span class="pre">%llu</span></tt> フォーマットを受け付けるようになりました。
(Contributed by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue7228">issue 7228</a>.)</p>
</li>
<li><p class="first">スレッドとプロセスのフォークの間の複雑な相互関係が変更されました。以前は、 <a class="reference internal" href="../library/os.html#os.fork" title="os.fork"><tt class="xref py py-func docutils literal"><span class="pre">os.fork()</span></tt></a> によって生成された子プロセスは失敗していました。これは、子は動作しているスレッド 1 つだけで生成され、そのスレッドが
<a class="reference internal" href="../library/os.html#os.fork" title="os.fork"><tt class="xref py py-func docutils literal"><span class="pre">os.fork()</span></tt></a> を処理するからです。他のスレッドが、Python のインポートロックのような、ロックを保持していたら、フォークが実行されたとき、ロックは新しいプロセスでも &#8220;held&#8221; としてマークされたままです。しかし、子プロセスでは、他のスレッドは複製されないため、ロックを開放するものは何もないので、子プロセスは import の実行を続けることができません。</p>
<p>Python 2.7 は、 <a class="reference internal" href="../library/os.html#os.fork" title="os.fork"><tt class="xref py py-func docutils literal"><span class="pre">os.fork()</span></tt></a> を実行する前に import ロックを取得し、また
<a class="reference internal" href="../library/threading.html#module-threading" title="threading: 高水準のスレッドインタフェース"><tt class="xref py py-mod docutils literal"><span class="pre">threading</span></tt></a> モジュールを使って生成された全てのロックをクリーンアップします。内部ロックを持っていたり、自身で <tt class="xref c c-func docutils literal"><span class="pre">fork()</span></tt> を呼び出したりするような C 拡張モジュールは、このクリーンアップの恩恵を受けません。</p>
<p>(Fixed by Thomas Wouters; <a class="reference external" href="http://bugs.python.org/issue1590864">issue 1590864</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../c-api/init.html#Py_Finalize" title="Py_Finalize"><tt class="xref c c-func docutils literal"><span class="pre">Py_Finalize()</span></tt></a> 関数は、内部の <tt class="xref py py-func docutils literal"><span class="pre">threading._shutdown()</span></tt>
関数を呼び出します。これにより、インタプリタがシャトダウンするときに送出が防がれる例外があります。
(Patch by Adam Olsen; <a class="reference external" href="http://bugs.python.org/issue1722344">issue 1722344</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../c-api/structures.html#PyMemberDef" title="PyMemberDef"><tt class="xref c c-type docutils literal"><span class="pre">PyMemberDef</span></tt></a> 構造を使って型の属性を定義するとき、それ以上
<tt class="xref py py-const docutils literal"><span class="pre">T_STRING_INPLACE</span></tt> 属性を削除または設定できなくなります。</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/ctypes.html#module-ctypes" title="ctypes: A foreign function library for Python."><tt class="xref py py-mod docutils literal"><span class="pre">ctypes</span></tt></a> によって定義されたグローバルシンボルには、 <tt class="docutils literal"><span class="pre">Py</span></tt> または
<tt class="docutils literal"><span class="pre">_ctypes</span></tt> が接頭されるようになりました。(Implemented by Thomas
Heller; <a class="reference external" href="http://bugs.python.org/issue3102">issue 3102</a>.)</p>
</li>
<li><p class="first">新しい設定オプション: <em class="xref std std-option">--with-system-expat</em> スイッチにより、
<tt class="xref py py-mod docutils literal"><span class="pre">pyexpat</span></tt> モジュールをビルドして、システム Expat ライブラリを使えます。
(Contributed by Arfrever Frehtes Taifersar Arahesis; <a class="reference external" href="http://bugs.python.org/issue7609">issue 7609</a>.)</p>
</li>
<li><p class="first">新しい設定オプション: <em class="xref std std-option">--with-valgrind</em> オプションは、
Valgrind メモリエラー検出器が正しく分析するのが難しい pymalloc アロケータを無効にするようになりました。ですから Valgrind は、メモリリークやオーバーランをより検出できます。
(Contributed by James Henstridge; <a class="reference external" href="http://bugs.python.org/issue2422">issue 2422</a>.)</p>
</li>
<li><p class="first">新しい設定オプション: <em class="xref std std-option">--with-dbmliborder=</em> に空の文字列を与えて様々な DBM モジュールを全て無効にできます。
(Added by Arfrever Frehtes Taifersar Arahesis; <a class="reference external" href="http://bugs.python.org/issue6491">issue 6491</a>.)</p>
</li>
<li><p class="first"><strong class="program">configure</strong> スクリプトは、ある種の 32-bit Intel チップ上の浮動小数点丸めバグを調べ、 <tt class="xref c c-macro docutils literal"><span class="pre">X87_DOUBLE_ROUNDING</span></tt> プリプロセッサ定義を定義します。現在この定義を使うコードはありませんが、使うことを望む人がいたら使えます。(Added by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue2937">issue 2937</a>.)</p>
<p><strong class="program">configure</strong> はまた、C++ リンクをサポートする
<span class="target" id="index-11"></span><tt class="xref std std-envvar docutils literal"><span class="pre">LDCXXSHARED</span></tt> Makefile を設定するようになりました。
(Contributed by Arfrever Frehtes Taifersar Arahesis; <a class="reference external" href="http://bugs.python.org/issue1222585">issue 1222585</a>.)</p>
</li>
<li><p class="first">ビルドプロセスは、pkg-config サポートに必要なファイルを生成するようになりました。(Contributed by Clinton Roy; <a class="reference external" href="http://bugs.python.org/issue3585">issue 3585</a>.)</p>
</li>
<li><p class="first">ビルドプロセスは、Subversion 1.7 をサポートするようになりました。
(Contributed by Arfrever Frehtes Taifersar Arahesis; <a class="reference external" href="http://bugs.python.org/issue6094">issue 6094</a>.)</p>
</li>
</ul>
<div class="section" id="whatsnew27-capsules">
<span id="id5"></span><h3>カプセル<a class="headerlink" href="#whatsnew27-capsules" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>Python 3.1 は、拡張モジュールに C API を提供する新しい C データ型
<a class="reference internal" href="../c-api/capsule.html#PyCapsule" title="PyCapsule"><tt class="xref c c-type docutils literal"><span class="pre">PyCapsule</span></tt></a> を追加しました。カプセルは、本質的には C の <tt class="docutils literal"><span class="pre">void</span> <span class="pre">*</span></tt>
ポインタのホルダであり、モジュール属性として利用できるようになります。例えば、 <a class="reference internal" href="../library/socket.html#module-socket" title="socket: 低レベルネットワークインターフェース。"><tt class="xref py py-mod docutils literal"><span class="pre">socket</span></tt></a> モジュールの API は <tt class="docutils literal"><span class="pre">socket.CAPI</span></tt> として公開されていて、 <a class="reference internal" href="../library/unicodedata.html#module-unicodedata" title="unicodedata: Access the Unicode Database."><tt class="xref py py-mod docutils literal"><span class="pre">unicodedata</span></tt></a> は <tt class="docutils literal"><span class="pre">ucnhash_CAPI</span></tt> を公開しています。その他の拡張はモジュールを import し、辞書にアクセスしてカプセルオブジェクトを取得し、そしてモジュールの様々な API 関数へのポインタの配列を指す <tt class="docutils literal"><span class="pre">void</span> <span class="pre">*</span></tt> ポインタを取得できます。</p>
<p>これに使われる既存のデータ型 <a class="reference internal" href="../c-api/cobject.html#PyCObject" title="PyCObject"><tt class="xref c c-type docutils literal"><span class="pre">PyCObject</span></tt></a> がありますが、これは型安全性を提供しません。pure Python で書かれた邪悪なコードは、
<a class="reference internal" href="../c-api/cobject.html#PyCObject" title="PyCObject"><tt class="xref c c-type docutils literal"><span class="pre">PyCObject</span></tt></a> をモジュール A から取り、どうにかしてそれをモジュール B の
<a class="reference internal" href="../c-api/cobject.html#PyCObject" title="PyCObject"><tt class="xref c c-type docutils literal"><span class="pre">PyCObject</span></tt></a> で代えることで、セグメンテーション違反を起こし得ます。カプセルは自身の名前を知っていて、ポインタを得るには名前を提供しなければなりません:</p>
<div class="highlight-python"><pre>void *vtable;

if (!PyCapsule_IsValid(capsule, "mymodule.CAPI") {
        PyErr_SetString(PyExc_ValueError, "argument type invalid");
        return NULL;
}

vtable = PyCapsule_GetPointer(capsule, "mymodule.CAPI");</pre>
</div>
<p><tt class="docutils literal"><span class="pre">vtable</span></tt> が期待どおりのものを指すことが保証されます。異なるカプセルが渡されたら、 <a class="reference internal" href="../c-api/capsule.html#PyCapsule_IsValid" title="PyCapsule_IsValid"><tt class="xref c c-func docutils literal"><span class="pre">PyCapsule_IsValid()</span></tt></a> は不適合な名前を検知し、偽を返します。これらのオブジェクトの使用について、より詳しい情報は、 <a class="reference internal" href="../extending/extending.html#using-capsules"><em>拡張モジュールに C API を提供する</em></a> を参照してください。</p>
<p>Python 2.7 は、様々な拡張モジュール API を提供するためにカプセルを内部的に使うようになりましたが、カプセルを処理するために
<a class="reference internal" href="../c-api/cobject.html#PyCObject_AsVoidPtr" title="PyCObject_AsVoidPtr"><tt class="xref c c-func docutils literal"><span class="pre">PyCObject_AsVoidPtr()</span></tt></a> が変更され、 <tt class="xref c c-type docutils literal"><span class="pre">CObject</span></tt> インタフェースとのコンパイル時互換性は保たれます。 <a class="reference internal" href="../c-api/cobject.html#PyCObject_AsVoidPtr" title="PyCObject_AsVoidPtr"><tt class="xref c c-func docutils literal"><span class="pre">PyCObject_AsVoidPtr()</span></tt></a> を使うと
<a class="reference internal" href="../library/exceptions.html#exceptions.PendingDeprecationWarning" title="exceptions.PendingDeprecationWarning"><tt class="xref py py-exc docutils literal"><span class="pre">PendingDeprecationWarning</span></tt></a> が合図されますが、デフォルトでは言及されません。</p>
<p>Implemented in Python 3.1 and backported to 2.7 by Larry Hastings;
discussed in <a class="reference external" href="http://bugs.python.org/issue5630">issue 5630</a>.</p>
</div>
<div class="section" id="windows">
<h3>ポート特有の変更: Windows<a class="headerlink" href="#windows" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li><a class="reference internal" href="../library/msvcrt.html#module-msvcrt" title="msvcrt: MS VC++実行時システムの雑多な有用ルーチン群。 (Windows)"><tt class="xref py py-mod docutils literal"><span class="pre">msvcrt</span></tt></a> モジュールは、 <tt class="file docutils literal"><span class="pre">crtassem.h</span></tt> からのいくつかの定数を追加しました。
<tt class="xref py py-data docutils literal"><span class="pre">CRT_ASSEMBLY_VERSION</span></tt>,
<tt class="xref py py-data docutils literal"><span class="pre">VC_ASSEMBLY_PUBLICKEYTOKEN</span></tt>,
および <tt class="xref py py-data docutils literal"><span class="pre">LIBRARIES_ASSEMBLY_NAME_PREFIX</span></tt>.
(Contributed by David Cournapeau; <a class="reference external" href="http://bugs.python.org/issue4365">issue 4365</a>.)</li>
<li>レジストリへのアクセスのための <a class="reference internal" href="../library/_winreg.html#module-_winreg" title="_winreg: Windows レジストリを操作するためのルーチンおよびオブジェクト。 (Windows)"><tt class="xref py py-mod docutils literal"><span class="pre">_winreg</span></tt></a> モジュールは、以前サポートされていた関数群の引数を増やした拡張版である
<a class="reference internal" href="../library/_winreg.html#_winreg.CreateKeyEx" title="_winreg.CreateKeyEx"><tt class="xref py py-func docutils literal"><span class="pre">CreateKeyEx()</span></tt></a> および <a class="reference internal" href="../library/_winreg.html#_winreg.DeleteKeyEx" title="_winreg.DeleteKeyEx"><tt class="xref py py-func docutils literal"><span class="pre">DeleteKeyEx()</span></tt></a> を実装しました。 <a class="reference internal" href="../library/_winreg.html#_winreg.DisableReflectionKey" title="_winreg.DisableReflectionKey"><tt class="xref py py-func docutils literal"><span class="pre">DisableReflectionKey()</span></tt></a>,
<a class="reference internal" href="../library/_winreg.html#_winreg.EnableReflectionKey" title="_winreg.EnableReflectionKey"><tt class="xref py py-func docutils literal"><span class="pre">EnableReflectionKey()</span></tt></a>, および
<a class="reference internal" href="../library/_winreg.html#_winreg.QueryReflectionKey" title="_winreg.QueryReflectionKey"><tt class="xref py py-func docutils literal"><span class="pre">QueryReflectionKey()</span></tt></a> もテストされ、ドキュメント化されました。
(Implemented by Brian Curtin: <a class="reference external" href="http://bugs.python.org/issue7347">issue 7347</a>.)</li>
<li>新しい <tt class="xref c c-func docutils literal"><span class="pre">_beginthreadex()</span></tt> API がスレッドの開始に使われ、ネイティブのスレッドローカルストレージ間数が使われるようになりました。
(Contributed by Kristján Valur Jónsson; <a class="reference external" href="http://bugs.python.org/issue3582">issue 3582</a>.)</li>
<li><a class="reference internal" href="../library/os.html#os.kill" title="os.kill"><tt class="xref py py-func docutils literal"><span class="pre">os.kill()</span></tt></a> 関数が Windows で働くようになりました。このシグナル値は定数 <tt class="xref py py-const docutils literal"><span class="pre">CTRL_C_EVENT</span></tt>, <tt class="xref py py-const docutils literal"><span class="pre">CTRL_BREAK_EVENT</span></tt>, その他の整数にできます。最初の 2 定数は Control-C および Control-Break 打鍵イベントをサブプロセスに送ります。その他の値は、 <tt class="xref c c-func docutils literal"><span class="pre">TerminateProcess()</span></tt> API を使います。(Contributed by Miki Tebeka; <a class="reference external" href="http://bugs.python.org/issue1220212">issue 1220212</a>.)</li>
<li><a class="reference internal" href="../library/os.html#os.listdir" title="os.listdir"><tt class="xref py py-func docutils literal"><span class="pre">os.listdir()</span></tt></a> 関数は、空のパスに対してちゃんと失敗するようになりました。
(Fixed by Hirokazu Yamamoto; <a class="reference external" href="http://bugs.python.org/issue5913">issue 5913</a>.)</li>
<li><tt class="xref py py-mod docutils literal"><span class="pre">mimelib</span></tt> モジュールは、初期化の際に Windows レジストリから
MIME データベースを正しく読みこむようになりました。
(Patch by Gabriel Genellina; <a class="reference external" href="http://bugs.python.org/issue4969">issue 4969</a>.)</li>
</ul>
</div>
<div class="section" id="mac-os-x">
<h3>ポート特有の変更: Mac OS X<a class="headerlink" href="#mac-os-x" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li>追加されたパッケージを、システムインストレーションとユーザがインストールした同じバージョンのコピーで共有するために、 <tt class="docutils literal"><span class="pre">sys.path</span></tt> に
<tt class="docutils literal"><span class="pre">/Library/Python/2.7/site-packages</span></tt> が追加されました。
(Changed by Ronald Oussoren; <a class="reference external" href="http://bugs.python.org/issue4865">issue 4865</a>.)</li>
</ul>
</div>
<div class="section" id="freebsd">
<h3>ポート特有の変更: FreeBSD<a class="headerlink" href="#freebsd" title="このヘッドラインへのパーマリンク">¶</a></h3>
<ul class="simple">
<li>FreeBSD 7.1 の、他のルーティングテーブルを選択するための
<tt class="xref py py-func docutils literal"><span class="pre">getsockopt()</span></tt>/<tt class="xref py py-func docutils literal"><span class="pre">setsockopt()</span></tt> で使われている
<tt class="xref py py-const docutils literal"><span class="pre">SO_SETFIB</span></tt> 定数が、 <a class="reference internal" href="../library/socket.html#module-socket" title="socket: 低レベルネットワークインターフェース。"><tt class="xref py py-mod docutils literal"><span class="pre">socket</span></tt></a> モジュールで使えるようになりました。(Added by Kyle VanderBeek; <a class="reference external" href="http://bugs.python.org/issue8235">issue 8235</a>.)</li>
</ul>
</div>
</div>
<div class="section" id="id6">
<h2>その他の変更と修正<a class="headerlink" href="#id6" title="このヘッドラインへのパーマリンク">¶</a></h2>
<ul class="simple">
<li>ベンチマークスクリプトの 2 つ、 <tt class="file docutils literal"><span class="pre">iobench</span></tt> および <tt class="file docutils literal"><span class="pre">ccbench</span></tt>, が
<tt class="file docutils literal"><span class="pre">Tools</span></tt> ディレクトリに追加されました。 <tt class="file docutils literal"><span class="pre">iobench</span></tt> は、様々な演算を実行している間 <a class="reference internal" href="../library/functions.html#open" title="open"><tt class="xref py py-func docutils literal"><span class="pre">open()</span></tt></a> によって返された組み込みファイル I/O オブジェクトの速度を計測し、 <tt class="file docutils literal"><span class="pre">ccbench</span></tt> は、変化する数のスレッドを使っていくつかのタスクを処理するときの計算スループット、スレッド切り替えレイテンシ、IO 処理バンド幅の計測を試みる同時実行ベンチマークです。</li>
<li><tt class="file docutils literal"><span class="pre">Tools/i18n/msgfmt.py</span></tt> スクリプトは、複数の形式の <tt class="file docutils literal"><span class="pre">.po</span></tt>
ファイルを理解できるようになりました。(Fixed by Martin von Löwis;
<a class="reference external" href="http://bugs.python.org/issue5464">issue 5464</a>.)</li>
<li>既存の対応する <tt class="file docutils literal"><span class="pre">.py</span></tt> が存在する <tt class="file docutils literal"><span class="pre">.pyc</span></tt> または <tt class="file docutils literal"><span class="pre">.pyo</span></tt>
ファイルからモジュールを import するとき、結果のコードオブジェクトの
<tt class="xref py py-attr docutils literal"><span class="pre">co_filename</span></tt> 属性は、元のファイル名が廃止されたとき、上書きされます。これは、ファイルがリネーム、移動、異なるパスを通したアクセスをされたときに起こりえます。(Patch by
Ziga Seilnacht and Jean-Paul Calderone; <a class="reference external" href="http://bugs.python.org/issue1180193">issue 1180193</a>.)</li>
<li><tt class="file docutils literal"><span class="pre">regrtest.py</span></tt> スクリプトは、テストを乱順に実行する
<em class="xref std std-option">-r</em> オプションの、ランダムシードに使われる整数を取る
<em class="xref std std-option">--randseed=</em> スイッチを取るようになりました。
<em class="xref std std-option">-r</em> オプションは、使われたシードも報告します。
(Added by Collin Winter.)</li>
<li>もう一つの <tt class="file docutils literal"><span class="pre">regrtest.py</span></tt> スイッチは <em class="xref std std-option">-j</em> で、いくつのテストを並行して実行するかを指定する整数です。これにより、マルチコア機での合計実行時間を短縮できます。このオプションは、実行時間を長くすることで知られている
<em class="xref std std-option">-R</em> スイッチなど、いくつかの他のオプションと互換です。
(Added by Antoine Pitrou, <a class="reference external" href="http://bugs.python.org/issue6152">issue 6152</a>.)
これはまた、選ばれたテストを失敗するまでループして実行する <em class="xref std std-option">-F</em>
スイッチとも同時に使えます。(Added by Antoine Pitrou; <a class="reference external" href="http://bugs.python.org/issue7312">issue 7312</a>.)</li>
<li>スクリプトとして実行されるとき、 <tt class="file docutils literal"><span class="pre">py_compile.py</span></tt> モジュールは標準入力を読み込んでコンパイルするファイル名のリストとする
<tt class="docutils literal"><span class="pre">'-'</span></tt> を引数として受け付けるようになりました。(Contributed by Piotr
Ożarowski; <a class="reference external" href="http://bugs.python.org/issue8233">issue 8233</a>.)</li>
</ul>
</div>
<div class="section" id="python-2-7">
<h2>Python 2.7 への移植<a class="headerlink" href="#python-2-7" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この説では、先に説明した変更その他のバグ修正の中で、コードの変更を必要とするかもしれないものを列挙します:</p>
<ul class="simple">
<li><a class="reference internal" href="../library/functions.html#range" title="range"><tt class="xref py py-func docutils literal"><span class="pre">range()</span></tt></a> 関数は、引数をより一貫して処理するようになりました。浮動小数点数でもなく整数でもない引数が与えられたら、その
<a class="reference internal" href="../reference/datamodel.html#object.__int__" title="object.__int__"><tt class="xref py py-meth docutils literal"><span class="pre">__int__()</span></tt></a> を呼び出すようになりました。(Fixed by Alexander
Belopolsky; <a class="reference external" href="http://bugs.python.org/issue1533">issue 1533</a>.)</li>
<li>文字列 <a class="reference internal" href="../library/functions.html#format" title="format"><tt class="xref py py-meth docutils literal"><span class="pre">format()</span></tt></a> メソッドは浮動小数点数および複素数に使われるデフォルトの精度を、 <a class="reference internal" href="../library/functions.html#str" title="str"><tt class="xref py py-func docutils literal"><span class="pre">str()</span></tt></a> で使われる精度に合わせ、小数第 6 位から 12 位に変更しました。
(Changed by Eric Smith; <a class="reference external" href="http://bugs.python.org/issue5920">issue 5920</a>.)</li>
<li><a class="reference internal" href="../reference/compound_stmts.html#with"><tt class="xref std std-keyword docutils literal"><span class="pre">with</span></tt></a> 文の最適化のため、特殊メソッド <a class="reference internal" href="../reference/datamodel.html#object.__enter__" title="object.__enter__"><tt class="xref py py-meth docutils literal"><span class="pre">__enter__()</span></tt></a> および
<a class="reference internal" href="../reference/datamodel.html#object.__exit__" title="object.__exit__"><tt class="xref py py-meth docutils literal"><span class="pre">__exit__()</span></tt></a> はオブジェクトの型に属さなければならず、オブジェクトのインスタンスには直接取り付けられません。これは
(<a class="reference internal" href="../library/functions.html#object" title="object"><tt class="xref py py-class docutils literal"><span class="pre">object</span></tt></a> から導出された) 新スタイルクラスと C 拡張型に影響します。
(<a class="reference external" href="http://bugs.python.org/issue6101">issue 6101</a>.)</li>
<li>Python 2.6 におけるバグのため、 <a class="reference internal" href="../reference/datamodel.html#object.__exit__" title="object.__exit__"><tt class="xref py py-meth docutils literal"><span class="pre">__exit__()</span></tt></a> の <em>exc_value</em> パラメタははよく、例外のインスタンスではなく文字列表現になっていました。これは
2.7 では修正され、 <em>exc_value</em> は期待通りインスタンスになります。
(Fixed by Florent Xicluna; <a class="reference external" href="http://bugs.python.org/issue7853">issue 7853</a>.)</li>
<li><tt class="docutils literal"><span class="pre">__slots__</span></tt> を使って属性の制限が設定されたとき、設定されていない属性を削除しても <a class="reference internal" href="../library/exceptions.html#exceptions.AttributeError" title="exceptions.AttributeError"><tt class="xref py py-exc docutils literal"><span class="pre">AttributeError</span></tt></a> が送出されないように修正されました。
(Fixed by Benjamin Peterson; <a class="reference external" href="http://bugs.python.org/issue7604">issue 7604</a>.)</li>
</ul>
<p>標準ライブラリでは:</p>
<ul>
<li><p class="first">年がサポートされている範囲外にはみ出るような
<a class="reference internal" href="../library/datetime.html#datetime.datetime" title="datetime.datetime"><tt class="xref py py-class docutils literal"><span class="pre">datetime</span></tt></a> インスタンスの演算が、 <a class="reference internal" href="../library/exceptions.html#exceptions.OverflowError" title="exceptions.OverflowError"><tt class="xref py py-exc docutils literal"><span class="pre">OverflowError</span></tt></a> を送出しないことがありました。このようなエラーはより注意深く調べられ、例外を送出するようになりました。(Reported by Mark Leander, patch
by Anand B. Pillai and Alexander Belopolsky; <a class="reference external" href="http://bugs.python.org/issue7150">issue 7150</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/decimal.html#decimal.Decimal" title="decimal.Decimal"><tt class="xref py py-class docutils literal"><span class="pre">Decimal</span></tt></a> インスタンスを文字列の <a class="reference internal" href="../library/functions.html#format" title="format"><tt class="xref py py-meth docutils literal"><span class="pre">format()</span></tt></a> メソッドに使うとき、デフォルトの揃えは以前は左揃えでした。これは右揃えに変更され、プログラムの出力が変わるかもしれません。
(Changed by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue6857">issue 6857</a>.)</p>
<p>signaling NaN 値 (または <tt class="docutils literal"><span class="pre">sNAN</span></tt>) を含む比較は、比較演算子に依って静かに真や偽となるのではなく、 <a class="reference internal" href="../library/decimal.html#decimal.InvalidOperation" title="decimal.InvalidOperation"><tt class="xref py py-const docutils literal"><span class="pre">InvalidOperation</span></tt></a> を合図するようになりました。quiet NaN 値 (または <tt class="docutils literal"><span class="pre">NaN</span></tt>) はハッシュ可能になりました。(Fixed by Mark Dickinson; <a class="reference external" href="http://bugs.python.org/issue7279">issue 7279</a>.)</p>
</li>
<li><p class="first">ElementTree ライブラリ <tt class="xref py py-mod docutils literal"><span class="pre">xml.etree</span></tt> は、
(<cite>&lt;?xml-stylesheet href=&#8221;#style1&#8221;?&gt;</cite> のような) 命令や
(<cite>&lt;!&#8211; comment &#8211;&gt;</cite> のような) コメントを処理する XML を出力するときにアンパサンドおよび角括弧をエスケープしなくなりました。
(Patch by Neil Muller; <a class="reference external" href="http://bugs.python.org/issue2746">issue 2746</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/stringio.html#StringIO.StringIO" title="StringIO.StringIO"><tt class="xref py py-class docutils literal"><span class="pre">StringIO</span></tt></a> オブジェクトの <tt class="xref py py-meth docutils literal"><span class="pre">readline()</span></tt>
メソッドは、ファイル風のオブジェクトのように、負の長さが要求されたとき、何もしなくなりました。(<a class="reference external" href="http://bugs.python.org/issue7348">issue 7348</a>)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/syslog.html#module-syslog" title="syslog: Unix syslog ライブラリルーチン群へのインタフェース。 (Unix)"><tt class="xref py py-mod docutils literal"><span class="pre">syslog</span></tt></a> モジュールは、識別子として以前のデフォルト値である <tt class="docutils literal"><span class="pre">'python'</span></tt>
ではなく、 <tt class="docutils literal"><span class="pre">sys.argv[0]</span></tt> の値を使うようになりました。
(Changed by Sean Reifschneider; <a class="reference external" href="http://bugs.python.org/issue8451">issue 8451</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/tarfile.html#module-tarfile" title="tarfile: tar-形式のアーカイブファイルを読み書きします。"><tt class="xref py py-mod docutils literal"><span class="pre">tarfile</span></tt></a> モジュールのデフォルトエラー処理が変更され、致命的なエラーを抑制しないようになりました。デフォルトのエラーレベルは以前は 0 で、エラーはメッセージとしてデバッグログに書き込まれるだけでしたが、デバッグログはデフォルトでは活性化されていないため、エラーは顧みられませんでした。デフォルトのエラーレベルは 1 になり、エラーがあれば例外が送出されます。
(Changed by Lars Gustäbel; <a class="reference external" href="http://bugs.python.org/issue7357">issue 7357</a>.)</p>
</li>
<li><p class="first"><a class="reference internal" href="../library/urlparse.html#module-urlparse" title="urlparse: URL の解析と構築"><tt class="xref py py-mod docutils literal"><span class="pre">urlparse</span></tt></a> モジュールの <a class="reference internal" href="../library/urlparse.html#urlparse.urlsplit" title="urlparse.urlsplit"><tt class="xref py py-func docutils literal"><span class="pre">urlsplit()</span></tt></a> は、未知の URL スキームを <span class="target" id="index-12"></span><a class="rfc reference external" href="http://tools.ietf.org/html/rfc3986.html"><strong>RFC 3986</strong></a> に応じた方法で処理します。
URL が <tt class="docutils literal"><span class="pre">&quot;&lt;something&gt;://...&quot;</span></tt> の形式なら、 <tt class="docutils literal"><span class="pre">://</span></tt> の前のテキストを、それがモジュールの知らない作り物のスキームであってさえ、スキームとして扱います。この変更は、古い働きを使って動作していたコードを破壊することがあります。例えば、Python 2.6.4 や 2.5 は以下を返します:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urlparse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlparse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="s">&#39;invented://host/filename?query&#39;</span><span class="p">)</span>
<span class="go">(&#39;invented&#39;, &#39;&#39;, &#39;//host/filename?query&#39;, &#39;&#39;, &#39;&#39;)</span>
</pre></div>
</div>
<p>Python 2.7 (や Python 2.6.5) は以下を返します:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">urlparse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">urlparse</span><span class="o">.</span><span class="n">urlsplit</span><span class="p">(</span><span class="s">&#39;invented://host/filename?query&#39;</span><span class="p">)</span>
<span class="go">(&#39;invented&#39;, &#39;host&#39;, &#39;/filename?query&#39;, &#39;&#39;, &#39;&#39;)</span>
</pre></div>
</div>
<p>(Python 2.7 では、これは普通のタプルではなく名前付きタプルを返すので、実際は微妙に異なる出力をします。)</p>
</li>
</ul>
<p>C 拡張では:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">PyArg_Parse*</span></tt> 系統の関数で整数フォーマットコードを使う C 拡張は、
<a class="reference internal" href="../library/exceptions.html#exceptions.DeprecationWarning" title="exceptions.DeprecationWarning"><tt class="xref py py-exc docutils literal"><span class="pre">DeprecationWarning</span></tt></a> を引き起こすのではなく、 <a class="reference internal" href="../library/exceptions.html#exceptions.TypeError" title="exceptions.TypeError"><tt class="xref py py-exc docutils literal"><span class="pre">TypeError</span></tt></a>
例外を送出するようになりました。(<a class="reference external" href="http://bugs.python.org/issue5080">issue 5080</a>)</li>
<li>非推奨となった古い <a class="reference internal" href="../c-api/conversion.html#PyOS_ascii_strtod" title="PyOS_ascii_strtod"><tt class="xref c c-func docutils literal"><span class="pre">PyOS_ascii_strtod()</span></tt></a> および
<a class="reference internal" href="../c-api/conversion.html#PyOS_ascii_atof" title="PyOS_ascii_atof"><tt class="xref c c-func docutils literal"><span class="pre">PyOS_ascii_atof()</span></tt></a> 関数の代わりに、新しい
<a class="reference internal" href="../c-api/conversion.html#PyOS_string_to_double" title="PyOS_string_to_double"><tt class="xref c c-func docutils literal"><span class="pre">PyOS_string_to_double()</span></tt></a> 関数を使ってください。</li>
</ul>
<p>Python を埋め込んだアプリケーションでは:</p>
<ul class="simple">
<li><a class="reference internal" href="../c-api/init.html#PySys_SetArgvEx" title="PySys_SetArgvEx"><tt class="xref c c-func docutils literal"><span class="pre">PySys_SetArgvEx()</span></tt></a> 関数が追加され、既存の <a class="reference internal" href="../c-api/init.html#PySys_SetArgv" title="PySys_SetArgv"><tt class="xref c c-func docutils literal"><span class="pre">PySys_SetArgv()</span></tt></a>
関数が使われた時のセキュリティホールをを塞ぐことができるようになりました。
<a class="reference internal" href="../c-api/init.html#PySys_SetArgv" title="PySys_SetArgv"><tt class="xref c c-func docutils literal"><span class="pre">PySys_SetArgv()</span></tt></a> を呼び出していないか調べ、 <em>updatepath</em> を偽に設定した
<a class="reference internal" href="../c-api/init.html#PySys_SetArgvEx" title="PySys_SetArgvEx"><tt class="xref c c-func docutils literal"><span class="pre">PySys_SetArgvEx()</span></tt></a> を使うべきかよく考えてください。</li>
</ul>
</div>
<div class="section" id="acks27">
<span id="id7"></span><h2>謝辞<a class="headerlink" href="#acks27" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>著者は、以下の方々がこの記事の多くの草稿に提案、修正、そして助力を差し伸べてくださったことに感謝の意を表したいと思います: Nick Coghlan,
Philip Jenvey, Ryan Lovett, R. David Murray, Hugh Secker-Walker.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="2.6.html" title="What’s New in Python 2.6"
             >次へ</a> |</li>
        <li class="right" >
          <a href="index.html" title="What’s New in Python (英語)"
             >前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="../index.html">Python 2.7ja1 documentation</a> &raquo;</li>

          <li><a href="index.html" >What&#8217;s New in Python (英語)</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 1990-2011, Python Software Foundation.
      最終更新: 2011-12-26
      このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/02cb752c6a9e で生成しました。
    </div>
  </body>
</html>