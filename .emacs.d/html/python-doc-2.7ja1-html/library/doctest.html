

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>25.2. doctest — 対話的な実行例をテストする &mdash; Python 2.7ja1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.7ja1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 2.7ja1 documentation 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="top" title="Python 2.7ja1 documentation" href="../index.html" />
    <link rel="up" title="25. 開発ツール" href="development.html" />
    <link rel="next" title="25.3. unittest — ユニットテストフレームワーク" href="unittest.html" />
    <link rel="prev" title="25.1. pydoc — ドキュメント生成とオンラインヘルプシステム" href="pydoc.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/_jp.js"></script>
    
 

  </head>
  <body>
    <div class="related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="unittest.html" title="25.3. unittest — ユニットテストフレームワーク"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="pydoc.html" title="25.1. pydoc — ドキュメント生成とオンラインヘルプシステム"
             accesskey="P">前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="../index.html">Python 2.7ja1 documentation</a> &raquo;</li>

          <li><a href="index.html" >Python 標準ライブラリ</a> &raquo;</li>
          <li><a href="development.html" accesskey="U">25. 開発ツール</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">25.2. <tt class="docutils literal"><span class="pre">doctest</span></tt> &#8212; 対話的な実行例をテストする</a><ul>
<li><a class="reference internal" href="#docstring">25.2.1. 簡単な利用法: docstring 中の実行例をチェックする</a></li>
<li><a class="reference internal" href="#doctest-simple-testfile">25.2.2. 簡単な利用法: テキストファイル中の実行例をチェックする</a></li>
<li><a class="reference internal" href="#doctest-how-it-works">25.2.3. doctest のからくり</a><ul>
<li><a class="reference internal" href="#doctest-which-docstrings">25.2.3.1. どの docstring が検証されるのか?</a></li>
<li><a class="reference internal" href="#doctest-finding-examples">25.2.3.2. docstring 内の実行例をどのように認識するのか?</a></li>
<li><a class="reference internal" href="#doctest-execution-context">25.2.3.3. 実行コンテキストとは何か?</a></li>
<li><a class="reference internal" href="#doctest-exceptions">25.2.3.4. 例外はどう扱えばよいか?</a></li>
<li><a class="reference internal" href="#doctest-options">25.2.3.5. オプションフラグとディレクティブ</a></li>
<li><a class="reference internal" href="#doctest-warnings">25.2.3.6. 注意</a></li>
</ul>
</li>
<li><a class="reference internal" href="#api">25.2.4. 基本 API</a></li>
<li><a class="reference internal" href="#doctest-unittest-api">25.2.5. 単体テスト API</a></li>
<li><a class="reference internal" href="#doctest-advanced-api">25.2.6. 拡張 API</a><ul>
<li><a class="reference internal" href="#doctest-doctest">25.2.6.1. DocTest オブジェクト</a></li>
<li><a class="reference internal" href="#example">25.2.6.2. Example オブジェクト</a></li>
<li><a class="reference internal" href="#doctestfinder">25.2.6.3. DocTestFinder オブジェクト</a></li>
<li><a class="reference internal" href="#doctestparser">25.2.6.4. DocTestParser オブジェクト</a></li>
<li><a class="reference internal" href="#doctestrunner">25.2.6.5. DocTestRunner オブジェクト</a></li>
<li><a class="reference internal" href="#outputchecker">25.2.6.6. OutputChecker オブジェクト</a></li>
</ul>
</li>
<li><a class="reference internal" href="#doctest-debugging">25.2.7. デバッグ</a></li>
<li><a class="reference internal" href="#doctest-soapbox">25.2.8. アドバイス</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="pydoc.html"
                        title="前の章へ">25.1. <tt class="docutils literal docutils literal"><span class="pre">pydoc</span></tt> &#8212; ドキュメント生成とオンラインヘルプシステム</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="unittest.html"
                        title="次の章へ">25.3. <tt class="docutils literal docutils literal"><span class="pre">unittest</span></tt> &#8212; ユニットテストフレームワーク</a></p>
  <h3>このページ</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/library/doctest.txt"
           rel="nofollow">ソースコードを表示</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>クイック検索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    モジュール、クラス、または関数名を入力してください
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-doctest">
<span id="doctest"></span><h1>25.2. <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> &#8212; 対話的な実行例をテストする<a class="headerlink" href="#module-doctest" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p><a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> モジュールは、対話的 Python セッションのように見えるテキストを探し出し、セッションの内容を実行して、そこに書かれている通りに振舞うかを調べます。
<a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> は以下のような用途によく使われています。</p>
<ul class="simple">
<li>モジュールの docstring (ドキュメンテーション文字列) 中にある対話実行例のすべてが書かれている通りに動作するか検証することで、
docstring の内容が最新かどうかチェックする。</li>
<li>テストファイルやテストオブジェクト中の対話実行例が期待通りに動作するかを検証することで、回帰テストを実現します。</li>
<li>入出力例を豊富に使ったパッケージのチュートリアルドキュメントが書けます。入出力例と解説文のどちらに注目するかによって、ドキュメントは「読めるテスト」にも「実行できるドキュメント」にもなります。</li>
</ul>
<p>以下に完全かつ短い実行例を示します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">This is the &quot;example&quot; module.</span>

<span class="sd">The example module supplies one function, factorial().  For example,</span>

<span class="sd">&gt;&gt;&gt; factorial(5)</span>
<span class="sd">120</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">def</span> <span class="nf">factorial</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the factorial of n, an exact integer &gt;= 0.</span>

<span class="sd">    If the result is small enough to fit in an int, return an int.</span>
<span class="sd">    Else return a long.</span>

<span class="sd">    &gt;&gt;&gt; [factorial(n) for n in range(6)]</span>
<span class="sd">    [1, 1, 2, 6, 24, 120]</span>
<span class="sd">    &gt;&gt;&gt; [factorial(long(n)) for n in range(6)]</span>
<span class="sd">    [1, 1, 2, 6, 24, 120]</span>
<span class="sd">    &gt;&gt;&gt; factorial(30)</span>
<span class="sd">    265252859812191058636308480000000L</span>
<span class="sd">    &gt;&gt;&gt; factorial(30L)</span>
<span class="sd">    265252859812191058636308480000000L</span>
<span class="sd">    &gt;&gt;&gt; factorial(-1)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    ValueError: n must be &gt;= 0</span>

<span class="sd">    Factorials of floats are OK, but the float must be an exact integer:</span>
<span class="sd">    &gt;&gt;&gt; factorial(30.1)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    ValueError: n must be exact integer</span>
<span class="sd">    &gt;&gt;&gt; factorial(30.0)</span>
<span class="sd">    265252859812191058636308480000000L</span>

<span class="sd">    It must also not be ridiculously large:</span>
<span class="sd">    &gt;&gt;&gt; factorial(1e100)</span>
<span class="sd">    Traceback (most recent call last):</span>
<span class="sd">        ...</span>
<span class="sd">    OverflowError: n too large</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">math</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;n must be &gt;= 0&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">!=</span> <span class="n">n</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;n must be exact integer&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span> <span class="o">==</span> <span class="n">n</span><span class="p">:</span>  <span class="c"># 1e300 のような値を捕らえる</span>
        <span class="k">raise</span> <span class="ne">OverflowError</span><span class="p">(</span><span class="s">&quot;n too large&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">factor</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">while</span> <span class="n">factor</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">*=</span> <span class="n">factor</span>
        <span class="n">factor</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">result</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>
</div>
<p><tt class="file docutils literal"><span class="pre">example.py</span></tt> をコマンドラインから直接実行すると、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> はその魔法を働かせます。</p>
<div class="highlight-python"><pre>$ python example.py
$</pre>
</div>
<p>出力は何もありません！ しかしこれが正常で、すべての実行例が正しく動作することを意味しています。スクリプトに <tt class="docutils literal"><span class="pre">-v</span></tt> を与えると、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> は何を行おうとしているのかを記録した詳細なログを出力し、最後にまとめを出力します。</p>
<div class="highlight-python"><pre>$ python example.py -v
Trying:
    factorial(5)
Expecting:
    120
ok
Trying:
    [factorial(n) for n in range(6)]
Expecting:
    [1, 1, 2, 6, 24, 120]
ok
Trying:
    [factorial(long(n)) for n in range(6)]
Expecting:
    [1, 1, 2, 6, 24, 120]
ok</pre>
</div>
<p>といった具合で、最後には</p>
<div class="highlight-python"><pre>Trying:
    factorial(1e100)
Expecting:
    Traceback (most recent call last):
        ...
    OverflowError: n too large
ok
2 items passed all tests:
   1 tests in __main__
   8 tests in __main__.factorial
9 tests in 2 items.
9 passed and 0 failed.
Test passed.
$</pre>
</div>
<p><a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> の生産的な利用を始めるために知る必要があるのはこれだけです！さあやってみましょう。詳細な事柄は後続の各節ですべて説明しています。
doctest の例は、標準の Python テストスイートやライブラリ中に沢山あります。標準のテストファイル <tt class="file docutils literal"><span class="pre">Lib/test/test_doctest.py</span></tt> には、特に役に立つ例があります。</p>
<div class="section" id="docstring">
<span id="doctest-simple-testmod"></span><h2>25.2.1. 簡単な利用法: docstring 中の実行例をチェックする<a class="headerlink" href="#docstring" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>doctest を試す簡単な方法 (とはいえ、いつもそうする必要はないのですが) は、各モジュール <tt class="xref py py-mod docutils literal"><span class="pre">M</span></tt> の最後を、以下のようにして締めくくることです。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">doctest</span>
    <span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">()</span>
</pre></div>
</div>
<p>こうすると、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> は <tt class="xref py py-mod docutils literal"><span class="pre">M</span></tt> 中の docstring を検査します。</p>
<p>モジュールをスクリプトとして実行すると、docstring 中の実行例が実行され、検証されます。</p>
<div class="highlight-python"><pre>python M.py</pre>
</div>
<p>docstring に書かれた実行例の実行が失敗しない限り、何も表示されません。失敗すると、失敗した実行例と、その原因が (場合によっては複数) 標準出力に印字され、最後に <tt class="docutils literal"><span class="pre">***Test</span> <span class="pre">Failed***</span> <span class="pre">N</span> <span class="pre">failures.</span></tt> という行を出力します。ここで、 <em>N</em> は失敗した実行例の数です。</p>
<p>一方、 <tt class="docutils literal"><span class="pre">-v</span></tt> スイッチをつけて走らせると</p>
<div class="highlight-python"><pre>python M.py -v</pre>
</div>
<p>実行を試みたすべての実行例について詳細に報告し、最後に各種まとめを行った内容が標準出力に印字されます。</p>
<p><tt class="docutils literal"><span class="pre">verbose=True</span></tt> を <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a> に渡せば、詳細報告 (verbose) モードを強制できます。また、
<tt class="docutils literal"><span class="pre">verbose=False</span></tt> にすれば禁止できます。どちらの場合にも、 <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a> は <tt class="docutils literal"><span class="pre">sys.argv</span></tt> 上のスイッチを調べません。(したがって、 <tt class="docutils literal"><span class="pre">-v</span></tt> をつけても効果はありません)。</p>
<p>Python 2.6 からは <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a> を実行するコマンドラインショートカットがあります。
Python インタプリタに doctest モジュールを標準ライブラリから直接実行して、テストするモジュール名をコマンドライン引数に与えます。</p>
<div class="highlight-python"><pre>python -m doctest -v example.py</pre>
</div>
<p>こうすると <tt class="file docutils literal"><span class="pre">example.py</span></tt> を単体モジュールとしてインポートして、それに対して <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a> を実行します。このファイルがパッケージの一部で他のサブモジュールをそのパッケージからインポートしている場合はうまく動かないことに注意してください。</p>
<p><a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a> の詳しい情報は <a class="reference internal" href="#doctest-basic-api"><em>基本 API</em></a> 節を参照してください。</p>
</div>
<div class="section" id="doctest-simple-testfile">
<span id="id1"></span><h2>25.2.2. 簡単な利用法: テキストファイル中の実行例をチェックする<a class="headerlink" href="#doctest-simple-testfile" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>doctest のもう一つの簡単な用途は、テキストファイル中にある対話実行例に対するテストです。これには <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> 関数を使います。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">doctest</span>
<span class="n">doctest</span><span class="o">.</span><span class="n">testfile</span><span class="p">(</span><span class="s">&quot;example.txt&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>この短いスクリプトは、 <tt class="file docutils literal"><span class="pre">example.txt</span></tt> というファイルの中に入っている対話モードの Python
操作例すべてを実行して、その内容を検証します。ファイルの内容は一つの巨大な docstring であるかのように扱われます; ファイルが Python プログラムである必要はありません！例えば、 <tt class="file docutils literal"><span class="pre">example.txt</span></tt> には以下のような内容が入っているとします。</p>
<blockquote>
<div></div></blockquote>
<div class="highlight-python"><pre>``example`` モジュール
======================

``factorial`` の使い方
----------------------

これは reStructuredText 形式で書かれたテキストファイルの例です。
最初に ``factorial`` を ``example`` モジュールからインポートします。

    &gt;&gt;&gt; from example import factorial

そして、インポートした ``factorial`` を使います:

    &gt;&gt;&gt; factorial(6)
    120</pre>
</div>
<p><tt class="docutils literal"><span class="pre">doctest.testfile(&quot;example.txt&quot;)</span></tt> を実行すると、このドキュメント内のエラーを見つけ出します。</p>
<div class="highlight-python"><pre>File "./example.txt", line 14, in example.txt
Failed example:
    factorial(6)
Expected:
    120
Got:
    720</pre>
</div>
<p><a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a> と同じく、 <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> は実行例が失敗しない限り何も表示しません。実行例が失敗すると、失敗した実行例とその原因が (場合によっては複数) <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a>
と同じ書式で標準出力に書き出されます。</p>
<p>デフォルトでは、 <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> は自分自身を呼び出したモジュールのあるディレクトリを探します。その他の場所にあるファイルを見に行くように <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a>
に指示するためのオプション引数についての説明は <a class="reference internal" href="#doctest-basic-api"><em>基本 API</em></a>
節を参照してください。</p>
<p><a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a> と同様に <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> の冗長性 (verbosity) はコマンドラインスイッチ
<tt class="docutils literal"><span class="pre">-v</span></tt> またはオプションのキーワード引数 <em>verbose</em> によって指定できます。</p>
<p>Python 2.6 からは <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> を実行するコマンドラインショートカットがあります。
Python インタプリタに doctest モジュールを標準ライブラリから直接実行して、テストするモジュール名をコマンドライン引数に与えます。</p>
<div class="highlight-python"><pre>python -m doctest -v example.txt</pre>
</div>
<p>ファイル名が <tt class="file docutils literal"><span class="pre">.py</span></tt> で終っていないので、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> は <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a> ではなく
<a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> を使って実行するのだと判断します。</p>
<p><a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> の詳細は <a class="reference internal" href="#doctest-basic-api"><em>基本 API</em></a> 節を参照してください。</p>
</div>
<div class="section" id="doctest-how-it-works">
<span id="id2"></span><h2>25.2.3. doctest のからくり<a class="headerlink" href="#doctest-how-it-works" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この節では、doctest のからくり: どの docstring を見に行くのか、どのように対話実行例を見つけ出すのか、どんな実行コンテキストを使うのか、例外をどう扱うか、上記の振る舞いを制御するためにどのようなオプションフラグを使うか、について詳しく吟味します。こうした情報は、 doctest に対応した実行例を書くために必要な知識です;
書いた実行例に対して実際に doctest を実行する上で必要な情報については後続の節を参照してください。</p>
<div class="section" id="doctest-which-docstrings">
<span id="id3"></span><h3>25.2.3.1. どの docstring が検証されるのか?<a class="headerlink" href="#doctest-which-docstrings" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>モジュールの docstring と、すべての関数、クラスおよびメソッドの docstring が検索されます。モジュールに import されたオブジェクトは検索されません。</p>
<p>加えて、 <tt class="docutils literal"><span class="pre">M.__test__</span></tt> が存在し、 &#8220;真の値を持つ&#8221; 場合、この値は辞書でなければならず、辞書の各エントリは (文字列の) 名前を関数オブジェクト、クラスオブジェクト、または文字列へとマップします。
<tt class="docutils literal"><span class="pre">M.__test__</span></tt> から得られた関数およびクラスオブジェクトの docstring は、その名前がプライベートなものでも検索され、文字列の場合にはそれが docstring であるかのように扱われます。出力においては、 <tt class="docutils literal"><span class="pre">M.__test__</span></tt> におけるキー <tt class="docutils literal"><span class="pre">K</span></tt> は、</p>
<div class="highlight-python"><pre>&lt;name of M&gt;.__test__.K</pre>
</div>
<p>のように表示されます。</p>
<p>検索中に見つかったクラスも同様に再帰的に検索が行われ、クラスに含まれているメソッドおよびネストされたクラスについて
docstring のテストが行われます。</p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.4 で変更: </span>&#8220;プライベート名&#8221; の概念は廃止されたため、ドキュメント化されなくなりました。</p>
</div>
<div class="section" id="doctest-finding-examples">
<span id="id4"></span><h3>25.2.3.2. docstring 内の実行例をどのように認識するのか?<a class="headerlink" href="#doctest-finding-examples" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>ほとんどの場合、対話コンソールセッション上でのコピー／ペーストはうまく動作します。とはいえ、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> は特定の Python シェルの振る舞いを正確にエミュレーションしようとするわけではありません。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="c"># コメントは無視されます</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="mi">12</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">12</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">13</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;yes&quot;</span>
<span class="gp">... </span><span class="k">else</span><span class="p">:</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;no&quot;</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;NO&quot;</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;NO!!!&quot;</span>
<span class="gp">...</span>
<span class="go">no</span>
<span class="go">NO</span>
<span class="go">NO!!!</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p>コードを含む最後の <tt class="docutils literal"><span class="pre">'&gt;&gt;&gt;</span> <span class="pre">'</span></tt> または <tt class="docutils literal"><span class="pre">'...</span> <span class="pre">'</span></tt> 行の直下に期待する出力結果が置かれます。
(出力結果がもしあれば) それは次の <tt class="docutils literal"><span class="pre">'&gt;&gt;&gt;</span> <span class="pre">'</span></tt> 行か、すべて空白文字の行まで続きます。</p>
<p>詳細事項:</p>
<ul>
<li><p class="first">期待する出力結果には、空白だけの行が入っていてはなりません。そのような行は期待する出力結果の終了を表すと見なされるからです。もし期待する出力結果の内容に空白行が入っている場合には、空白行が入るべき場所すべてに <tt class="docutils literal"><span class="pre">&lt;BLANKLINE&gt;</span></tt> を入れてください。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加: </span><tt class="docutils literal"><span class="pre">&lt;BLANKLINE&gt;</span></tt> が追加されました; 以前のバージョンでは、空白行を含む出力結果を扱う方法がありませんでした。</p>
</li>
<li><p class="first">ハードタブはすべて 8 カラムのタブストップを使ってスペースに展開されます。テストコードによって生成された出力におけるタブは変更されていません。サンプル出力におけるハードタブはすべて展開 <em>される</em> ので、これが意味するのは、コード出力がハードタブを含んでいるなら、そのような doctest が成功するのは
<a class="reference internal" href="#doctest.NORMALIZE_WHITESPACE" title="doctest.NORMALIZE_WHITESPACE"><tt class="xref py py-const docutils literal"><span class="pre">NORMALIZE_WHITESPACE</span></tt></a> オプションまたはディレクティブが有効な場合だけだということです。あるいは、テストの一部として出力を得て、それを期待値と比較するようにテストを書き直すことができます。このようなソース中のタブの取り扱いは試行錯誤の結果で、最も誤りの傾向が少ないことが示された方法です。カスタムな <a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><tt class="xref py py-class docutils literal"><span class="pre">DocTestParser</span></tt></a> クラスを書くことによって、タブを扱うのに異なるアルゴリズムを使うことができます。</p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.4 で変更: </span>新たにタブをスペースに展開するようになりました; 以前のバージョンはハードタブを保存しようとしていたので、
混乱させるようなテスト結果になってしまっていました。</p>
</li>
<li><p class="first">標準出力への出力は取り込まれますが、標準エラーは取り込まれません (例外発生時のトレースバックは別の方法で取り込まれます)。</p>
</li>
<li><p class="first">対話セッションにおいて、バックスラッシュを用いて次の行に続ける場合や、その他の理由でバックスラッシュを用いる場合、raw docstring を使ってバックスラッシュを入力どおりに扱わせるようにしなければなりません。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="s">r&#39;&#39;&#39;Backslashes in a raw docstring: m\n&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">f</span><span class="o">.</span><span class="n">__doc__</span>
<span class="go">Backslashes in a raw docstring: m\n</span>
</pre></div>
</div>
<p>こうしなければ、バックスラッシュは文字列の一部として解釈されてしまいます。例えば、上の例の &#8220;\n&#8221; は改行文字として認識されてしまうでしょう。こうする代わりに、(raw docstring を使わずに) doctest 版の中ではバックスラッシュをすべて二重にしてもかまいません。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
<span class="gp">... </span>    <span class="sd">&#39;&#39;&#39;Backslashes in a raw docstring: m\\n&#39;&#39;&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="n">f</span><span class="o">.</span><span class="n">__doc__</span>
<span class="go">Backslashes in a raw docstring: m\n</span>
</pre></div>
</div>
</li>
<li><p class="first">開始カラムはどこでもかまいません。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">assert</span> <span class="s">&quot;Easy!&quot;</span>
<span class="go">      &gt;&gt;&gt; import math</span>
<span class="go">          &gt;&gt;&gt; math.floor(1.9)</span>
<span class="go">          1.0</span>
</pre></div>
</div>
<p>期待する出力結果の先頭部にある空白文字列は、実行例の開始部分にあたる <tt class="docutils literal"><span class="pre">'&gt;&gt;&gt;</span> <span class="pre">'</span></tt> 行の先頭にある空白文字列と同じだけ取り除かれます。</p>
</li>
</ul>
</div>
<div class="section" id="doctest-execution-context">
<span id="id5"></span><h3>25.2.3.3. 実行コンテキストとは何か?<a class="headerlink" href="#doctest-execution-context" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>デフォルトでは、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> はテストを行うべき docstring を見つけるたびに
<tt class="xref py py-mod docutils literal"><span class="pre">M</span></tt> のグローバル名前空間の <em>浅いコピー</em> を使い、テストの実行によってモジュールの実際のグローバル名前空間を変更しないようにし、かつ <tt class="xref py py-mod docutils literal"><span class="pre">M</span></tt> 内で行ったテストが痕跡を残して偶発的に別のテストを誤って動作させないようにしています。したがって、実行例中では <tt class="xref py py-mod docutils literal"><span class="pre">M</span></tt> 内のトップレベルで定義されたすべての名前と、
docstring が動作する以前に定義された名前を自由に使えます。個々の実行例は他の docstring 中で定義された名前を参照できません。</p>
<p><a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a> や <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> に <tt class="docutils literal"><span class="pre">globs=your_dict</span></tt> を渡し、自前の辞書を実行コンテキストとして使うこともできます。</p>
</div>
<div class="section" id="doctest-exceptions">
<span id="id6"></span><h3>25.2.3.4. 例外はどう扱えばよいか?<a class="headerlink" href="#doctest-exceptions" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>トレースバックが実行例によって生成される唯一の出力なら問題ありません。単にトレースバックを貼り付けてください。 <a class="footnote-reference" href="#id15" id="id7">[1]</a>
トレースバックには、頻繁に変更されがちな情報 (例えばファイルパスや行番号など) が入っているものなので、これは受け入れるテスト結果に柔軟性を持たせようと doctest が苦労している部分の一つです。</p>
<p>簡単な例を示しましょう。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">?</span>
<span class="nc">ValueError: list.remove(x)</span>: <span class="n-Identifier">x not in list</span>
</pre></div>
</div>
<p>この doctest は、 <a class="reference internal" href="exceptions.html#exceptions.ValueError" title="exceptions.ValueError"><tt class="xref py py-exc docutils literal"><span class="pre">ValueError</span></tt></a> が送出され、その詳細情報が <tt class="docutils literal"><span class="pre">list.remove(x):</span> <span class="pre">x</span> <span class="pre">not</span> <span class="pre">in</span> <span class="pre">list</span></tt> である場合に成功します。</p>
<p>例外が発生したときの期待する出力はトレースバックヘッダから始まっていなければなりません。トレースバックの形式は以下の二通りの行のいずれかで、実行例の最初の行と同じインデントでなければりません。</p>
<div class="highlight-python"><pre>Traceback (most recent call last):
Traceback (innermost last):</pre>
</div>
<p>トレースバックヘッダの後ろにトレースバックスタックが続いてもかまいませんが、
doctest はその内容を無視します。普通はトレースバックスタックを省略するか、対話セッションからそのままコピーしてきます。</p>
<p>トレースバックスタックの後ろにはもっとも有意義な部分、例外の型と詳細情報の入った行があります。これは通常トレースバックの最後の行ですが、例外が複数行の詳細情報を持っている場合、複数の行にわたることもあります。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;multi</span><span class="se">\n</span><span class="s">    line</span><span class="se">\n</span><span class="s">detail&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">?</span>
<span class="nc">ValueError</span>: <span class="n-Identifier">multi</span>
<span class="go">    line</span>
<span class="go">detail</span>
</pre></div>
</div>
<p>上の例では、最後の 3 行 (<a class="reference internal" href="exceptions.html#exceptions.ValueError" title="exceptions.ValueError"><tt class="xref py py-exc docutils literal"><span class="pre">ValueError</span></tt></a> から始まる行) における例外の型と詳細情報だけが比較され、それ以外の部分は無視されます。</p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.4 で変更: </span>以前のバージョンでは、複数行にわたる例外の詳細を扱えませんでした。</p>
<p>例外を扱うコツは、実行例をドキュメントとして読む上で明らかに価値のある情報でない限り、トレースバックスタックは省略する、ということです。したがって、先ほどの例は以下のように書くべきでしょう。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;multi</span><span class="se">\n</span><span class="s">    line</span><span class="se">\n</span><span class="s">detail&#39;</span><span class="p">)</span>
<span class="gt">Traceback (most recent call last):</span>
    <span class="o">...</span>
<span class="nc">ValueError</span>: <span class="n-Identifier">multi</span>
<span class="go">    line</span>
<span class="go">detail</span>
</pre></div>
</div>
<p>トレースバックの扱いは非常に特殊なので注意してください。特に、上の書き直した実行例では、 <tt class="docutils literal"><span class="pre">...</span></tt> の扱いは doctest の
<a class="reference internal" href="#doctest.ELLIPSIS" title="doctest.ELLIPSIS"><tt class="xref py py-const docutils literal"><span class="pre">ELLIPSIS</span></tt></a> オプションとは独立しています。この例での省略記号は何かの省略を表しているかもしれませんし、コンマや数字が 3 個 (または 300 個) かもしれませんし、
Monty Python のスキットをインデントして書き写したものかもしれません。</p>
<p>以下の詳細はずっと覚えておく必要はないのですが、一度目を通しておいてください。</p>
<ul>
<li><p class="first">doctest は期待する出力の出所が print 文なのか例外なのかを推測できません。したがって、例えば期待する出力が <tt class="docutils literal"><span class="pre">ValueError:</span> <span class="pre">42</span> <span class="pre">is</span> <span class="pre">prime</span></tt> であるような実行例は、
<a class="reference internal" href="exceptions.html#exceptions.ValueError" title="exceptions.ValueError"><tt class="xref py py-exc docutils literal"><span class="pre">ValueError</span></tt></a> が実際に送出された場合と、万が一期待する出力と同じ文字列を
print した場合の両方で成功してしまいます。現実的には、通常の出力がトレースバックヘッダから始まることはないので、実際に問題になることはないでしょう。</p>
</li>
<li><p class="first">トレースバックスタック (がある場合) の各行は、実行例の最初の行よりも深くインデントされているか、
<em>または</em> 英数文字以外で始まっていなければなりません。トレースバックヘッダ以後に現れる行のうち、インデントが等しく英数文字で始まる最初の行は例外の詳細情報が書かれた行とみなされるからです。もちろん、本物のトレースバックでは正しく動作します。</p>
</li>
<li><p class="first">doctest のオプション <a class="reference internal" href="#doctest.IGNORE_EXCEPTION_DETAIL" title="doctest.IGNORE_EXCEPTION_DETAIL"><tt class="xref py py-const docutils literal"><span class="pre">IGNORE_EXCEPTION_DETAIL</span></tt></a> を指定した場合、最も左端のコロン以後の全ての内容と、例外名の中の全てのモジュール情報が無視されます。</p>
</li>
<li><p class="first">対話シェルでは、 <a class="reference internal" href="exceptions.html#exceptions.SyntaxError" title="exceptions.SyntaxError"><tt class="xref py py-exc docutils literal"><span class="pre">SyntaxError</span></tt></a> の場合にトレースバックヘッダが省略されることがあります。しかし doctest にとっては、例外を例外でないものと区別するためにトレースバックヘッダが必要です。そこで、トレースバックヘッダを省略するような <a class="reference internal" href="exceptions.html#exceptions.SyntaxError" title="exceptions.SyntaxError"><tt class="xref py py-exc docutils literal"><span class="pre">SyntaxError</span></tt></a>
をテストする必要があるというごく稀なケースでは、実行例にトレースバックヘッダを手作業で追加する必要があるでしょう。</p>
</li>
<li><p class="first"><a class="reference internal" href="exceptions.html#exceptions.SyntaxError" title="exceptions.SyntaxError"><tt class="xref py py-exc docutils literal"><span class="pre">SyntaxError</span></tt></a> の場合、 Python は構文エラーの起きた場所を <tt class="docutils literal"><span class="pre">^</span></tt> マーカで表示します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="mi">1</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
    <span class="mi">1</span> <span class="mi">1</span>
      <span class="o">^</span>
<span class="nc">SyntaxError</span>: <span class="n-Identifier">invalid syntax</span>
</pre></div>
</div>
<p>例外の型と詳細情報の前にエラー位置を示す行がくるため、 doctest はこの行を調べません。例えば、以下の例では、間違った場所に <tt class="docutils literal"><span class="pre">^</span></tt> マーカを入れても成功してしまいます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mi">1</span> <span class="mi">1</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>
    <span class="mi">1</span> <span class="mi">1</span>
    <span class="o">^</span>
<span class="nc">SyntaxError</span>: <span class="n-Identifier">invalid syntax</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="section" id="doctest-options">
<span id="id8"></span><h3>25.2.3.5. オプションフラグとディレクティブ<a class="headerlink" href="#doctest-options" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p>doctest では、その挙動の様々な側面をたくさんのオプションフラグで制御しています。各フラグのシンボル名はモジュールの定数として提供されており、論理和で組み合わせて様々な関数に渡せるようになっています。シンボル名は doctest のディレクティブ (directive, 下記参照) としても使えます。</p>
<p>最初に説明するオプション群は、テストのセマンティクスを決めます。すなわち、実際にテストを実行したときの出力と実行例中の期待する出力とが一致しているかどうかを
doctest がどのように判断するかを制御します。</p>
<dl class="data">
<dt id="doctest.DONT_ACCEPT_TRUE_FOR_1">
<tt class="descclassname">doctest.</tt><tt class="descname">DONT_ACCEPT_TRUE_FOR_1</tt><a class="headerlink" href="#doctest.DONT_ACCEPT_TRUE_FOR_1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>デフォルトでは、期待する出力ブロックに単に <tt class="docutils literal"><span class="pre">1</span></tt> だけが入っており、実際の出力ブロックに <tt class="docutils literal"><span class="pre">1</span></tt> または <tt class="docutils literal"><span class="pre">True</span></tt>
だけが入っていた場合、これらの出力は一致しているとみなされます。
<tt class="docutils literal"><span class="pre">0</span></tt> と <tt class="docutils literal"><span class="pre">False</span></tt> の場合も同様です。
<a class="reference internal" href="#doctest.DONT_ACCEPT_TRUE_FOR_1" title="doctest.DONT_ACCEPT_TRUE_FOR_1"><tt class="xref py py-const docutils literal"><span class="pre">DONT_ACCEPT_TRUE_FOR_1</span></tt></a> を指定すると、こうした値の読み替えを行いません。デフォルトの挙動で読み替えを行うのは、最近の Python で多くの関数の戻り値型が整数型からブール型に変更されたことに対応するためです; 読み替えを行う場合、&#8221;通常の整数&#8221; の出力を期待する出力とするような
doctest も動作します。このオプションはそのうちなくなるでしょうが、ここ数年はそのままでしょう。</p>
</dd></dl>

<dl class="data">
<dt id="doctest.DONT_ACCEPT_BLANKLINE">
<tt class="descclassname">doctest.</tt><tt class="descname">DONT_ACCEPT_BLANKLINE</tt><a class="headerlink" href="#doctest.DONT_ACCEPT_BLANKLINE" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>デフォルトでは、期待する出力ブロックに <tt class="docutils literal"><span class="pre">&lt;BLANKLINE&gt;</span></tt> だけの入った行がある場合、その行は実際の出力における空行に一致するようになります。完全な空行を入れてしまうと期待する出力がそこで終わっているとみなされてしまうため、期待する出力に空行を入れたい場合にはこの方法を使わなければなりません。
<a class="reference internal" href="#doctest.DONT_ACCEPT_BLANKLINE" title="doctest.DONT_ACCEPT_BLANKLINE"><tt class="xref py py-const docutils literal"><span class="pre">DONT_ACCEPT_BLANKLINE</span></tt></a> を指定すると、 <tt class="docutils literal"><span class="pre">&lt;BLANKLINE&gt;</span></tt> の読み替えを行わなくなります。</p>
</dd></dl>

<dl class="data">
<dt id="doctest.NORMALIZE_WHITESPACE">
<tt class="descclassname">doctest.</tt><tt class="descname">NORMALIZE_WHITESPACE</tt><a class="headerlink" href="#doctest.NORMALIZE_WHITESPACE" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このフラグを指定すると、連続する空白 (空白と改行文字) は互いに等価であるとみなします。期待する出力における任意の空白列は実際の出力における任意の空白と一致します。デフォルトでは、空白は厳密に一致しなければなりません。
<a class="reference internal" href="#doctest.NORMALIZE_WHITESPACE" title="doctest.NORMALIZE_WHITESPACE"><tt class="xref py py-const docutils literal"><span class="pre">NORMALIZE_WHITESPACE</span></tt></a> は、期待する出力の内容が非常に長いために、ソースコード中でその内容を複数行に折り返して書きたい場合に特に便利です。</p>
</dd></dl>

<dl class="data">
<dt id="doctest.ELLIPSIS">
<tt class="descclassname">doctest.</tt><tt class="descname">ELLIPSIS</tt><a class="headerlink" href="#doctest.ELLIPSIS" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このフラグを指定すると、期待する出力中の省略記号マーカ (<tt class="docutils literal"><span class="pre">...</span></tt>)
が実際の出力中の任意の部分文字列と一致するようになります。部分文字列は行境界にわたるものや空文字列を含みます。したがって、このフラグを使うのは単純な内容を対象にする場合にとどめましょう。複雑な使い方をすると、正規表現に <tt class="docutils literal"><span class="pre">.*</span></tt> を使ったときのように
&#8220;しまった、マッチしすぎた！ (match too much!)&#8221; と驚くことになりかねません。</p>
</dd></dl>

<dl class="data">
<dt id="doctest.IGNORE_EXCEPTION_DETAIL">
<tt class="descclassname">doctest.</tt><tt class="descname">IGNORE_EXCEPTION_DETAIL</tt><a class="headerlink" href="#doctest.IGNORE_EXCEPTION_DETAIL" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このフラグを指定すると、期待する実行結果に例外が入るような実行例で、期待通りの型の例外が送出された場合に、例外の詳細情報が一致していなくてもテストが成功します。例えば、期待する出力が <tt class="docutils literal"><span class="pre">ValueError:</span> <span class="pre">42</span></tt> であるような実行例は、実際に送出された例外が <tt class="docutils literal"><span class="pre">ValueError:</span> <span class="pre">3*14</span></tt> でも成功しますが、
<a class="reference internal" href="exceptions.html#exceptions.TypeError" title="exceptions.TypeError"><tt class="xref py py-exc docutils literal"><span class="pre">TypeError</span></tt></a> が送出されるといった場合には成功しません。</p>
<p>これは Python 3 doctest レポートにおいて使われるモジュール名も無視します。従って、以下の 2 つのテストは、Python 2.7 と Python 3.2 (またはそれ以降) のどちらでも同じように動作します:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">raise</span> <span class="n">CustomError</span><span class="p">(</span><span class="s">&#39;message&#39;</span><span class="p">)</span> <span class="c">#doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="nc">CustomError</span>: <span class="n-Identifier">message</span>
</pre></div>
</div>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">raise</span> <span class="n">CustomError</span><span class="p">(</span><span class="s">&#39;message&#39;</span><span class="p">)</span> <span class="c">#doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="gt">Traceback (most recent call last):</span>
<span class="nc">my_module.CustomError</span>: <span class="n-Identifier">message</span>
</pre></div>
</div>
<p>なお、 <a class="reference internal" href="#doctest.ELLIPSIS" title="doctest.ELLIPSIS"><tt class="xref py py-const docutils literal"><span class="pre">ELLIPSIS</span></tt></a> を使っても例外メッセージの詳細を無視することができますが、モジュールの詳細が例外名の一部として表示されるかどうかに依存するようなテストは、やはり失敗します。また、 <a class="reference internal" href="#doctest.IGNORE_EXCEPTION_DETAIL" title="doctest.IGNORE_EXCEPTION_DETAIL"><tt class="xref py py-const docutils literal"><span class="pre">IGNORE_EXCEPTION_DETAIL</span></tt></a> と Python 2.3 の詳細情報を使うことが、例外の詳細に影響されず、なおかつ Python 2.3 以前 の Python
(これらのリリースは doctest ディレクティブをサポートせず、これらを無関係なコメントとして無視します) で成功する doctest を書くための、唯一の明確な方法です。例えば、例外の詳細情報は 2.4 で変更され、 &#8220;doesn&#8217;t&#8221; の代わりに
&#8220;does not&#8221; と書くようになりましたが:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;moo&#39;</span> <span class="c">#doctest: +IGNORE_EXCEPTION_DETAIL</span>
<span class="gt">Traceback (most recent call last):</span>
  File <span class="nb">&quot;&lt;stdin&gt;&quot;</span>, line <span class="m">1</span>, in <span class="n-Identifier">?</span>
<span class="nc">TypeError</span>: <span class="n-Identifier">object doesn&#39;t support item assignment</span>
</pre></div>
</div>
<p>とすると、 Python 2.3 以降の Python バージョンでテストを成功させることができます。</p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.7 で変更: </span><a class="reference internal" href="#doctest.IGNORE_EXCEPTION_DETAIL" title="doctest.IGNORE_EXCEPTION_DETAIL"><tt class="xref py py-const docutils literal"><span class="pre">IGNORE_EXCEPTION_DETAIL</span></tt></a> は、テストにおいて例外を含むモジュールに
関する情報も無視するようになりました。</p>
</dd></dl>

<dl class="data">
<dt id="doctest.SKIP">
<tt class="descclassname">doctest.</tt><tt class="descname">SKIP</tt><a class="headerlink" href="#doctest.SKIP" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このフラグを指定すると、実行例は一切実行されません。こうした機能は doctest の実行例がドキュメントとテストを兼ねていて、ドキュメントのためには含めておかなければならないけれどチェックされなくても良い、というような文脈で役に立ちます。例えば、実行例の出力がランダムであるとか、テストドライバーには利用できないリソースに依存している場合などです。</p>
<p>SKIP フラグは一時的に実行例を&#8221;コメントアウト&#8221;するのにも使えます。</p>
</dd></dl>

<p class="versionadded">
<span class="versionmodified">バージョン 2.5 で追加.</span></p>
<dl class="data">
<dt id="doctest.COMPARISON_FLAGS">
<tt class="descclassname">doctest.</tt><tt class="descname">COMPARISON_FLAGS</tt><a class="headerlink" href="#doctest.COMPARISON_FLAGS" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>上記の比較フラグすべての論理和をとったビットマスクです。</p>
</dd></dl>

<p>二つ目のオプション群は、テストの失敗を報告する方法を制御します。</p>
<dl class="data">
<dt id="doctest.REPORT_UDIFF">
<tt class="descclassname">doctest.</tt><tt class="descname">REPORT_UDIFF</tt><a class="headerlink" href="#doctest.REPORT_UDIFF" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このオプションを指定すると、期待する出力および実際の出力が複数行になるときにテストの失敗結果を unified diff 形式を使って表示します。</p>
</dd></dl>

<dl class="data">
<dt id="doctest.REPORT_CDIFF">
<tt class="descclassname">doctest.</tt><tt class="descname">REPORT_CDIFF</tt><a class="headerlink" href="#doctest.REPORT_CDIFF" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このオプションを指定すると、期待する出力および実際の出力が複数行になるときにテストの失敗結果を context diff 形式を使って表示します。</p>
</dd></dl>

<dl class="data">
<dt id="doctest.REPORT_NDIFF">
<tt class="descclassname">doctest.</tt><tt class="descname">REPORT_NDIFF</tt><a class="headerlink" href="#doctest.REPORT_NDIFF" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このオプションを指定すると、期待する出力と実際の出力との間の差分を <tt class="docutils literal"><span class="pre">difflib.Differ</span></tt> を使って算出します。使われているアルゴリズムは有名な <tt class="file docutils literal"><span class="pre">ndiff.py</span></tt> ユーティリティと同じです。これは、行単位の差分と同じように行内の差分にマーカをつけられるようにする唯一の手段です。例えば、期待する出力のある行に数字の <tt class="docutils literal"><span class="pre">1</span></tt> が入っていて、実際の出力には <tt class="docutils literal"><span class="pre">l</span></tt> が入っている場合、不一致の起きているカラム位置を示すキャレットの入った行が一行挿入されます。</p>
</dd></dl>

<dl class="data">
<dt id="doctest.REPORT_ONLY_FIRST_FAILURE">
<tt class="descclassname">doctest.</tt><tt class="descname">REPORT_ONLY_FIRST_FAILURE</tt><a class="headerlink" href="#doctest.REPORT_ONLY_FIRST_FAILURE" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このオプションを指定すると、各 doctest で最初にエラーの起きた実行例だけを表示し、それ以後の実行例の出力を抑制します。これにより、正しく書かれた実行例が、それ以前の実行例の失敗によっておかしくなってしまった場合に、
doctest がそれを報告しないようになります。とはいえ、最初に失敗を引き起こした実行例とは関係なく誤って書かれた実行例の報告も抑制してしまいます。
<a class="reference internal" href="#doctest.REPORT_ONLY_FIRST_FAILURE" title="doctest.REPORT_ONLY_FIRST_FAILURE"><tt class="xref py py-const docutils literal"><span class="pre">REPORT_ONLY_FIRST_FAILURE</span></tt></a> を指定した場合、実行例がどこかで失敗しても、それ以後の実行例を続けて実行し、失敗したテストの総数を報告します; 出力が抑制されるだけです。</p>
</dd></dl>

<dl class="data">
<dt id="doctest.REPORTING_FLAGS">
<tt class="descclassname">doctest.</tt><tt class="descname">REPORTING_FLAGS</tt><a class="headerlink" href="#doctest.REPORTING_FLAGS" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>上記のエラー報告に関するフラグすべての論理和をとったビットマスクです。</p>
</dd></dl>

<p>「doctest ディレクティブ」を使うと、個々の実行例に対してオプションフラグの設定を変更できます。 doctest ディレクティブは特殊な Python
コメント文として表現され、実行例のソースコードの後に続けます。</p>
<pre>
<strong id="grammar-token-directive">directive            </strong> ::=  &quot;#&quot; &quot;doctest:&quot; <a class="reference internal" href="#grammar-token-directive_options"><tt class="xref docutils literal"><span class="pre">directive_options</span></tt></a>
<strong id="grammar-token-directive_options">directive_options    </strong> ::=  <a class="reference internal" href="#grammar-token-directive_option"><tt class="xref docutils literal"><span class="pre">directive_option</span></tt></a> (&quot;,&quot; <a class="reference internal" href="#grammar-token-directive_option"><tt class="xref docutils literal"><span class="pre">directive_option</span></tt></a>)\*
<strong id="grammar-token-directive_option">directive_option     </strong> ::=  <a class="reference internal" href="#grammar-token-on_or_off"><tt class="xref docutils literal"><span class="pre">on_or_off</span></tt></a> <a class="reference internal" href="#grammar-token-directive_option_name"><tt class="xref docutils literal"><span class="pre">directive_option_name</span></tt></a>
<strong id="grammar-token-on_or_off">on_or_off            </strong> ::=  &quot;+&quot; \| &quot;-&quot;
<strong id="grammar-token-directive_option_name">directive_option_name</strong> ::=  &quot;DONT_ACCEPT_BLANKLINE&quot; \| &quot;NORMALIZE_WHITESPACE&quot; \| ...
</pre>
<p><tt class="docutils literal"><span class="pre">+</span></tt> や <tt class="docutils literal"><span class="pre">-</span></tt> とディレクティブオプション名の間に空白を入れてはなりません。ディレクティブオプション名は上で説明したオプションフラグ名のいずれかです。</p>
<p>ある実行例の doctest ディレクティブは、その実行例だけの doctest の振る舞いを変えます。ある特定の挙動を有効にしたければ <tt class="docutils literal"><span class="pre">+</span></tt> を、無効にしたければ <tt class="docutils literal"><span class="pre">-</span></tt> を使います。</p>
<p>例えば、以下のテストは成功します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="c">#doctest: +NORMALIZE_WHITESPACE</span>
<span class="go">[0,   1,  2,  3,  4,  5,  6,  7,  8,  9,</span>
<span class="go">10,  11, 12, 13, 14, 15, 16, 17, 18, 19]</span>
</pre></div>
</div>
<p>ディレクティブがない場合、実際の出力には一桁の数字の間に二つスペースが入っていないこと、実際の出力は 1 行になることから、テストは成功しないはずです。別のディレクティブを使って、このテストを成功させることもできます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="c"># doctest:+ELLIPSIS</span>
<span class="go">[0, 1, ..., 18, 19]</span>
</pre></div>
</div>
<p>複数のディレクティブは、一つの物理行の中にコンマで区切って指定できます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="c"># doctest: +ELLIPSIS, +NORMALIZE_WHITESPACE</span>
<span class="go">[0,    1, ...,   18,    19]</span>
</pre></div>
</div>
<p>一つの実行例中で複数のディレクティブコメントを使った場合、それらは組み合わされます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="c"># doctest: +ELLIPSIS</span>
<span class="gp">... </span>                <span class="c"># doctest: +NORMALIZE_WHITESPACE</span>
<span class="go">[0,    1, ...,   18,    19]</span>
</pre></div>
</div>
<p>この実行例で分かるように、実行例にはディレクティブだけを含む <tt class="docutils literal"><span class="pre">...</span></tt> 行を追加することができます。この書きかたは、実行例が長すぎるためにディレクティブを同じ行に入れると収まりが悪い場合に便利です。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">20</span><span class="p">)</span> <span class="o">+</span> <span class="nb">range</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span> <span class="o">+</span> <span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
<span class="gp">... </span><span class="c"># doctest: +ELLIPSIS</span>
<span class="go">[0, ..., 4, 10, ..., 19, 30, ..., 39, 50, ..., 59]</span>
</pre></div>
</div>
<p>フォルトではすべてのオプションが無効になっており、ディレクティブは特定の実行例だけに影響を及ぼすので、通常意味があるのは有効にするためのオプション (<tt class="docutils literal"><span class="pre">+</span></tt> のついたディレクティブ) だけです。とはいえ、 doctest を実行する関数はオプションフラグを指定してデフォルトとは異なった挙動を実現できるので、そのような場合には <tt class="docutils literal"><span class="pre">-</span></tt> を使った無効化オプションも意味を持ちます。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加: </span>doctest ディレクティブおよび関連する定数
<a class="reference internal" href="#doctest.DONT_ACCEPT_BLANKLINE" title="doctest.DONT_ACCEPT_BLANKLINE"><tt class="xref py py-const docutils literal"><span class="pre">DONT_ACCEPT_BLANKLINE</span></tt></a>, <a class="reference internal" href="#doctest.NORMALIZE_WHITESPACE" title="doctest.NORMALIZE_WHITESPACE"><tt class="xref py py-const docutils literal"><span class="pre">NORMALIZE_WHITESPACE</span></tt></a>,
<a class="reference internal" href="#doctest.ELLIPSIS" title="doctest.ELLIPSIS"><tt class="xref py py-const docutils literal"><span class="pre">ELLIPSIS</span></tt></a>, <a class="reference internal" href="#doctest.IGNORE_EXCEPTION_DETAIL" title="doctest.IGNORE_EXCEPTION_DETAIL"><tt class="xref py py-const docutils literal"><span class="pre">IGNORE_EXCEPTION_DETAIL</span></tt></a>, <a class="reference internal" href="#doctest.REPORT_UDIFF" title="doctest.REPORT_UDIFF"><tt class="xref py py-const docutils literal"><span class="pre">REPORT_UDIFF</span></tt></a>,
<a class="reference internal" href="#doctest.REPORT_CDIFF" title="doctest.REPORT_CDIFF"><tt class="xref py py-const docutils literal"><span class="pre">REPORT_CDIFF</span></tt></a>, <a class="reference internal" href="#doctest.REPORT_NDIFF" title="doctest.REPORT_NDIFF"><tt class="xref py py-const docutils literal"><span class="pre">REPORT_NDIFF</span></tt></a>,
<a class="reference internal" href="#doctest.REPORT_ONLY_FIRST_FAILURE" title="doctest.REPORT_ONLY_FIRST_FAILURE"><tt class="xref py py-const docutils literal"><span class="pre">REPORT_ONLY_FIRST_FAILURE</span></tt></a>, <a class="reference internal" href="#doctest.COMPARISON_FLAGS" title="doctest.COMPARISON_FLAGS"><tt class="xref py py-const docutils literal"><span class="pre">COMPARISON_FLAGS</span></tt></a>, および
<a class="reference internal" href="#doctest.REPORTING_FLAGS" title="doctest.REPORTING_FLAGS"><tt class="xref py py-const docutils literal"><span class="pre">REPORTING_FLAGS</span></tt></a> が追加されました。</p>
<p>新たなオプションフラグ名を登録する方法もありますが、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> の内部をサブクラスで拡張しない限り、意味はないでしょう。</p>
<dl class="function">
<dt id="doctest.register_optionflag">
<tt class="descclassname">doctest.</tt><tt class="descname">register_optionflag</tt><big>(</big><em>name</em><big>)</big><a class="headerlink" href="#doctest.register_optionflag" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>名前 <em>name</em> の新たなオプションフラグを作成し、作成されたフラグの整数値を返します。
<a class="reference internal" href="#doctest.register_optionflag" title="doctest.register_optionflag"><tt class="xref py py-func docutils literal"><span class="pre">register_optionflag()</span></tt></a> は <a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><tt class="xref py py-class docutils literal"><span class="pre">OutputChecker</span></tt></a> や  <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> をサブクラス化して、その中で新たに作成したオプションをサポートさせる際に使います。
<a class="reference internal" href="#doctest.register_optionflag" title="doctest.register_optionflag"><tt class="xref py py-func docutils literal"><span class="pre">register_optionflag()</span></tt></a> は以下のような定形文で呼び出さなければなりません。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">MY_FLAG</span> <span class="o">=</span> <span class="n">register_optionflag</span><span class="p">(</span><span class="s">&#39;MY_FLAG&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
</dd></dl>

</div>
<div class="section" id="doctest-warnings">
<span id="id9"></span><h3>25.2.3.6. 注意<a class="headerlink" href="#doctest-warnings" title="このヘッドラインへのパーマリンク">¶</a></h3>
<p><a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> では、期待する出力に対する完全一致を厳格に求めます。一致しない文字が一文字でもあると、テストは失敗してしまいます。このため、 Python が出力に関して何を保証していて、何を保証していないかを正確に知っていないと度々混乱させられることでしょう。例えば、辞書を出力する際、 Python はキーと値のペアが常に特定の順番で並ぶよう保証してはいません。したがって、以下のようなテスト</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">()</span>
<span class="go">{&quot;Hermione&quot;: &quot;hippogryph&quot;, &quot;Harry&quot;: &quot;broomstick&quot;}</span>
</pre></div>
</div>
<p>は失敗するかもしれないのです! 回避するには</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">foo</span><span class="p">()</span> <span class="o">==</span> <span class="p">{</span><span class="s">&quot;Hermione&quot;</span><span class="p">:</span> <span class="s">&quot;hippogryph&quot;</span><span class="p">,</span> <span class="s">&quot;Harry&quot;</span><span class="p">:</span> <span class="s">&quot;broomstick&quot;</span><span class="p">}</span>
<span class="go">True</span>
</pre></div>
</div>
<p>とするのが一つのやり方です。別のやり方は、</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">foo</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">d</span>
<span class="go">[(&#39;Harry&#39;, &#39;broomstick&#39;), (&#39;Hermione&#39;, &#39;hippogryph&#39;)]</span>
</pre></div>
</div>
<p>です。</p>
<p>他のやり方もありますが、あとは自分で考えてみてください。</p>
<p>以下のように、オブジェクトアドレスを埋め込むような結果を print するのもよくありません。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="nb">id</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span> <span class="c"># いつか確実に失敗する</span>
<span class="go">7948648</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">C</span><span class="p">:</span> <span class="k">pass</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">C</span><span class="p">()</span>   <span class="c"># インスタンスに対するデフォルトの repr() にはアドレスが埋め込まれる</span>
<span class="go">&lt;__main__.C instance at 0x00AC18F0&gt;</span>
</pre></div>
</div>
<p><a class="reference internal" href="#doctest.ELLIPSIS" title="doctest.ELLIPSIS"><tt class="xref py py-const docutils literal"><span class="pre">ELLIPSIS</span></tt></a> ディレクティブを使うと、上のような例をうまく解決できます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">C</span><span class="p">()</span> <span class="c">#doctest: +ELLIPSIS</span>
<span class="go">&lt;__main__.C instance at 0x...&gt;</span>
</pre></div>
</div>
<p>浮動小数点数もまた、プラットフォーム間での微妙な出力の違いの原因となります。というのも、Python は浮動小数点の書式化をプラットフォームの C ライブラリに委ねており、この点では、C ライブラリはプラットフォーム間で非常に大きく異なっているからです。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mf">1.</span><span class="o">/</span><span class="mi">7</span>  <span class="c"># 危険</span>
<span class="go">0.14285714285714285</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="mf">1.</span><span class="o">/</span><span class="mi">7</span> <span class="c"># 多少は安全</span>
<span class="go">0.142857142857</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">round</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mi">7</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span> <span class="c"># より安全</span>
<span class="go">0.142857</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">I/2.**J</span></tt> の形式になる数値はどのプラットフォームでもうまく動作するので、私はこの形式の数値を生成するように doctest の実行例を工夫しています。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="mf">3.</span><span class="o">/</span><span class="mi">4</span>  <span class="c"># 絶対に安全</span>
<span class="go">0.75</span>
</pre></div>
</div>
<p>単純な分数は人間にとっても理解しやすく、良いドキュメントを書くために役に立ちます。</p>
</div>
</div>
<div class="section" id="api">
<span id="doctest-basic-api"></span><h2>25.2.4. 基本 API<a class="headerlink" href="#api" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>数 <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a> と <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> は、ほとんどの基本的な用途に十分な doctest
インタフェースを提供しています。これら二つの関数についてあまり形式的でない入門が読みたければ、
<a class="reference internal" href="#doctest-simple-testmod"><em>簡単な利用法: docstring 中の実行例をチェックする</em></a> 節や <a class="reference internal" href="#doctest-simple-testfile"><em>簡単な利用法: テキストファイル中の実行例をチェックする</em></a> 節を参照してください。</p>
<dl class="function">
<dt id="doctest.testfile">
<tt class="descclassname">doctest.</tt><tt class="descname">testfile</tt><big>(</big><em>filename[, module_relative][, name][, package][, globs][, verbose][, report][, optionflags][, extraglobs][, raise_on_error][, parser][, encoding]</em><big>)</big><a class="headerlink" href="#doctest.testfile" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>filename</em> 以外の引数はすべてオプションで、キーワード引数形式で指定しなければなりません。</p>
<p><em>filename</em> に指定したファイル内にある実行例をテストします。 <tt class="docutils literal"><span class="pre">(failure_count,</span> <span class="pre">test_count)</span></tt> を返します。</p>
<p>オプション引数の <em>module_relative</em> は、ファイル名をどのように解釈するかを指定します。</p>
<ul class="simple">
<li><em>module_relative</em> が <tt class="docutils literal"><span class="pre">True</span></tt> (デフォルト) の場合、 <em>filename</em> は OS
に依存しないモジュールの相対パスになります。デフォルトでは、このパスは関数 <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> を呼び出しているモジュールからの相対パスになります; ただし、 <em>package</em> 引数を指定した場合には、パッケージからの相対になります。
OS への依存性を除くため、 <em>filename</em>  ではパスを分割する文字に <tt class="docutils literal"><span class="pre">/</span></tt> を使わなければならず、絶対パスにしてはなりません (パス文字列を <tt class="docutils literal"><span class="pre">/</span></tt> で始めてはなりません)。</li>
<li><em>module_relative</em> が <tt class="docutils literal"><span class="pre">False</span></tt> の場合、 <em>filename</em> は OS 依存のパスを示します。パスは絶対パスでも相対パスでもかまいません; 相対パスにした場合、現在の作業ディレクトリを基準に解決します。</li>
</ul>
<p>オプション引数 <em>name</em> には、テストの名前を指定します; デフォルトの場合や <tt class="docutils literal"><span class="pre">None</span></tt> を指定した場合、
<tt class="docutils literal"><span class="pre">os.path.basename(filename)</span></tt> になります。</p>
<p>オプション引数 <em>package</em> には、 Python パッケージを指定するか、モジュール相対のファイル名の場合には相対の基準ディレクトリとなる Python パッケージの名前を指定します。パッケージを指定しない場合、関数を呼び出しているモジュールのディレクトリを相対の基準ディレクトリとして使います。
<em>module_relative</em> を <tt class="docutils literal"><span class="pre">False</span></tt> に指定している場合、 <em>package</em> を指定するとエラーになります。</p>
<p>オプション引数 <em>globs</em> には辞書を指定します。この辞書は、実行例を実行する際のグローバル変数として用いられます。
doctest はこの辞書の浅いコピーを生成するので、実行例は白紙の状態からスタートします。デフォルトの場合や <tt class="docutils literal"><span class="pre">None</span></tt> を指定した場合、新たな空の辞書になります。</p>
<p>オプション引数 <em>extraglobs</em> には辞書を指定します。この辞書は、実行例を実行する際にグローバル変数にマージされます。マージは <a class="reference internal" href="stdtypes.html#dict.update" title="dict.update"><tt class="xref py py-meth docutils literal"><span class="pre">dict.update()</span></tt></a> のように振舞います: <em>globs</em> と <em>extraglobs</em> との間に同じキー値がある場合、両者を合わせた辞書中には <em>extraglobs</em> の方の値が入ります。この仕様は、パラメータ付きで doctest を実行するという、やや進んだ機能です。例えば、一般的な名前を使って基底クラス向けに doctest を書いておき、その後で辞書で一般的な名前からテストしたいサブクラスへの対応付けを行う辞書を <em>extraglobs</em> に渡して、様々なサブクラスをテストできます。</p>
<p>オプション引数 <em>verbose</em> が真の場合、様々な情報を出力します。偽の場合にはテストの失敗だけを報告します。デフォルトの場合や <tt class="docutils literal"><span class="pre">None</span></tt> を指定した場合、 <tt class="docutils literal"><span class="pre">sys.argv</span></tt> に <tt class="docutils literal"><span class="pre">-v</span></tt> を指定しない限りこの値は真になりません。</p>
<p>オプション引数 <em>report</em> が真の場合、テストの最後にサマリを出力します。それ以外の場合には何も出力しません。
verbose モードの場合、サマリには詳細な情報を出力しますが、そうでない場合にはサマリはとても簡潔になります (実際には、すべてのテストが成功した場合には何も出力しません)。</p>
<p>オプション引数 <em>optionflags</em> は、各オプションフラグの論理和をとった値を指定します。 <a class="reference internal" href="#doctest-options"><em>オプションフラグとディレクティブ</em></a>
節を参照してください。</p>
<p>オプション引数 <em>raise_on_error</em> の値はデフォルトでは偽です。真にすると、最初のテスト失敗や予期しない例外が起きたときに例外を送出します。このオプションを使うと、失敗の原因を検死デバッグ (post-mortem debug) できます。デフォルトの動作では、実行例の実行を継続します。</p>
<p>オプション引数 <em>parser</em> には、 <a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><tt class="xref py py-class docutils literal"><span class="pre">DocTestParser</span></tt></a> (またはそのサブクラス) を指定します。このクラスはファイルから実行例を抽出するために使われます。デフォルトでは通常のパーザ (<tt class="docutils literal"><span class="pre">DocTestParser()</span></tt>) です。</p>
<p>オプション引数 <em>encoding</em> にはファイルをユニコードに変換する際に使われるエンコーディングを指定します。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.5 で変更: </span><em>encoding</em> パラメータが追加されました。</p>
</dd></dl>

<dl class="function">
<dt id="doctest.testmod">
<tt class="descclassname">doctest.</tt><tt class="descname">testmod</tt><big>(</big><em>[m][, name][, globs][, verbose][, report][, optionflags][, extraglobs][, raise_on_error][, exclude_empty]</em><big>)</big><a class="headerlink" href="#doctest.testmod" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>引数はすべてオプションで、 <em>m</em> 以外の引数はキーワード引数として指定しなければなりません。</p>
<p>モジュール <em>m</em> (<em>m</em> を指定しないか <tt class="docutils literal"><span class="pre">None</span></tt> にした場合には <a class="reference internal" href="__main__.html#module-__main__" title="__main__: トップレベルスクリプトが実行される環境。"><tt class="xref py py-mod docutils literal"><span class="pre">__main__</span></tt></a>) から到達可能な関数およびクラスの
docstring 内にある実行例をテストします。 <tt class="docutils literal"><span class="pre">m.__doc__</span></tt> 内の実行例からテストを開始します。</p>
<p>また、辞書 <tt class="docutils literal"><span class="pre">m.__test__</span></tt> が存在し、 <tt class="docutils literal"><span class="pre">None</span></tt> でない場合、この辞書から到達できる実行例もテストします。
<tt class="docutils literal"><span class="pre">m.__test__</span></tt> は、(文字列の) 名前から関数、クラスおよび文字列への対応付けを行っています。関数およびクラスの場合には、その docstring 内から実行例を検索します。文字列の場合には、docstring と同じようにして実行例の検索を直接実行します。</p>
<p>モジュール <em>m</em> に属するオブジェクトにつけられた docstring のみを検索します。</p>
<p><tt class="docutils literal"><span class="pre">(failure_count,</span> <span class="pre">test_count)</span></tt> を返します。</p>
<p>オプション引数 <em>name</em> には、モジュールの名前を指定します。デフォルトの場合や <tt class="docutils literal"><span class="pre">None</span></tt> を指定した場合には、
<tt class="docutils literal"><span class="pre">m.__name__</span></tt> を使います。</p>
<p>オプション引数 <em>exclude_empty</em> はデフォルトでは偽になっています。この値を真にすると、doctest を持たないオブジェクトを考慮から外します。デフォルトの設定は依存のバージョンとの互換性を考えたハックであり、 <tt class="xref py py-meth docutils literal"><span class="pre">doctest.master.summarize()</span></tt> と
<a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a> を合わせて利用しているようなコードでも、テスト実行例を持たないオブジェクトから出力を得るようにしています。新たに追加された <a class="reference internal" href="#doctest.DocTestFinder" title="doctest.DocTestFinder"><tt class="xref py py-class docutils literal"><span class="pre">DocTestFinder</span></tt></a> のコンストラクタの <em>exclude_empty</em> はデフォルトで真になります。</p>
<p>オプション引数 <em>extraglobs</em>, <em>verbose</em>, <em>report</em>, <em>optionflags</em>, <em>raise_on_error</em>, および
<em>globs</em> は上で説明した <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> の引数と同じです。ただし、 <em>globs</em> のデフォルト値は <tt class="docutils literal"><span class="pre">m.__dict__</span></tt>
になります。</p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.3 で変更: </span><em>optionflags</em> パラメータが追加されました。</p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.4 で変更: </span><em>extraglobs</em>, <em>raise_on_error</em> および <em>exclude_empty</em> パラメータが追加されました。</p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.5 で変更: </span>オプション引数 <em>isprivate</em> は、2.4 では非推奨でしたが、廃止されました。</p>
</dd></dl>

<p>単一のオブジェクトに関連付けられた doctest を実行するための関数もあります。この関数は以前のバージョンとの互換性のために提供されています。この関数を廃止する予定はありませんが、役に立つことはほとんどありません。</p>
<dl class="function">
<dt id="doctest.run_docstring_examples">
<tt class="descclassname">doctest.</tt><tt class="descname">run_docstring_examples</tt><big>(</big><em>f, globs[, verbose][, name][, compileflags][, optionflags]</em><big>)</big><a class="headerlink" href="#doctest.run_docstring_examples" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>オブジェクト <em>f</em> に関連付けられた実行例をテストします。 <em>f</em> はモジュール、関数、またはクラスオブジェクトです。</p>
<p>引数 <em>globs</em> に辞書を指定すると、その浅いコピーを実行コンテキストに使います。</p>
<p>オプション引数 <em>name</em> はテスト失敗時のメッセージに使われます。デフォルトの値は <tt class="docutils literal"><span class="pre">NoName</span></tt> です。</p>
<p>オプション引数 <em>verbose</em> の値を真にすると、テストが失敗しなくても出力を生成します。デフォルトでは、実行例のテストに失敗したときのみ出力を生成します。</p>
<p>オプション引数 <em>compileflags</em> には、実行例を実行するときに Python バイトコードコンパイラが使うフラグを指定します。デフォルトの場合や <tt class="docutils literal"><span class="pre">None</span></tt> を指定した場合、フラグは <em>globs</em> 内にある future 機能セットに対応したものになります。</p>
<p>オプション引数 <em>optionflags</em> は、上で述べた <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> と同様の働きをします。</p>
</dd></dl>

</div>
<div class="section" id="doctest-unittest-api">
<span id="id10"></span><h2>25.2.5. 単体テスト API<a class="headerlink" href="#doctest-unittest-api" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>doctest 化したモジュールのコレクションが増えるにつれ、すべての doctest
をシステマティックに実行したいと思うようになるはずです。
Python 2.4 以前の <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> には <tt class="xref py py-class docutils literal"><span class="pre">Tester</span></tt>
というほとんどドキュメント化されていないクラスがあり、複数のモジュールの doctest を統合する初歩的な手段を提供していました。
<tt class="xref py py-class docutils literal"><span class="pre">Tester</span></tt> は非力であり、実際のところ、もっときちんとした Python
のテストフレームワークが <a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> モジュールで構築されており、複数のソースコードからのテストを統合する柔軟な方法を提供しています。そこで Python 2.4 では <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> の <tt class="xref py py-class docutils literal"><span class="pre">Tester</span></tt> クラスを廃止し、モジュールや doctest の入ったテキストファイルから <a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a>
テストスイートを作成できるような二つの関数を <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> 側で提供するようにしました。
<a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> によるテスト発見と統合するには、テストモジュールに <tt class="xref py py-func docutils literal"><span class="pre">load_tests()</span></tt> 関数を含めてください。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">unittest</span>
<span class="kn">import</span> <span class="nn">doctest</span>
<span class="kn">import</span> <span class="nn">my_module_with_doctests</span>

<span class="k">def</span> <span class="nf">load_tests</span><span class="p">(</span><span class="n">loader</span><span class="p">,</span> <span class="n">tests</span><span class="p">,</span> <span class="n">ignore</span><span class="p">):</span>
    <span class="n">tests</span><span class="o">.</span><span class="n">addTests</span><span class="p">(</span><span class="n">doctest</span><span class="o">.</span><span class="n">DocTestSuite</span><span class="p">(</span><span class="n">my_module_with_doctests</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">tests</span>
</pre></div>
</div>
<p>doctest の入ったテキストファイルやモジュールから <a class="reference internal" href="unittest.html#unittest.TestSuite" title="unittest.TestSuite"><tt class="xref py py-class docutils literal"><span class="pre">unittest.TestSuite</span></tt></a> インスタンスを生成するための主な関数は二つあります。</p>
<dl class="function">
<dt id="doctest.DocFileSuite">
<tt class="descclassname">doctest.</tt><tt class="descname">DocFileSuite</tt><big>(</big><em>*paths, [module_relative][, package][, setUp][, tearDown][, globs][, optionflags][, parser][, encoding]</em><big>)</big><a class="headerlink" href="#doctest.DocFileSuite" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>単一または複数のテキストファイルに入っている doctest 形式のテストを、 <a class="reference internal" href="unittest.html#unittest.TestSuite" title="unittest.TestSuite"><tt class="xref py py-class docutils literal"><span class="pre">unittest.TestSuite</span></tt></a>
インスタンスに変換します。</p>
<p>この関数の返す <a class="reference internal" href="unittest.html#unittest.TestSuite" title="unittest.TestSuite"><tt class="xref py py-class docutils literal"><span class="pre">unittest.TestSuite</span></tt></a> インスタンスは、 unittest
フレームワークで動作させ、各ファイルの実行例を対話的に実行するためのものです。ファイル内の何らかの実行例の実行に失敗すると、この関数で生成した単体テストは失敗し、該当するテストの入っているファイルの名前と、 (場合によりだいたいの) 行番号の入った <tt class="xref py py-exc docutils literal"><span class="pre">failureException</span></tt>
例外を送出します。</p>
<p>関数には、テストを行いたい一つまたは複数のファイルへのパスを (文字列で) 渡します。</p>
<p><a class="reference internal" href="#doctest.DocFileSuite" title="doctest.DocFileSuite"><tt class="xref py py-func docutils literal"><span class="pre">DocFileSuite()</span></tt></a> には、キーワード引数でオプションを指定できます。</p>
<p>オプション引数 <em>module_relative</em> は <em>paths</em> に指定したファイル名をどのように解釈するかを指定します。</p>
<ul class="simple">
<li><em>module_relative</em> が <tt class="docutils literal"><span class="pre">True</span></tt> (デフォルト) の場合、 <em>filename</em> は OS
に依存しないモジュールの相対パスになります。デフォルトでは、このパスは関数 <a class="reference internal" href="#doctest.testfile" title="doctest.testfile"><tt class="xref py py-func docutils literal"><span class="pre">testfile()</span></tt></a> を呼び出しているモジュールからの相対パスになります; ただし、 <em>package</em> 引数を指定した場合には、パッケージからの相対になります。 OS への依存性を除くため、 <em>filename</em> ではパスを分割する文字に
<tt class="docutils literal"><span class="pre">/</span></tt> を使わなければならず、絶対パスにしてはなりません (パス文字列を <tt class="docutils literal"><span class="pre">/</span></tt> で始めてはなりません)。</li>
<li><em>module_relative</em> が <tt class="docutils literal"><span class="pre">False</span></tt> の場合、 <em>filename</em> は OS 依存のパスを示します。パスは絶対パスでも相対パスでもかまいません; 相対パスにした場合、現在の作業ディレクトリを基準に解決します。</li>
</ul>
<p>オプション引数 <em>package</em> には、 Python パッケージを指定するか、モジュール相対のファイル名の場合には相対の基準ディレクトリとなる Python パッケージの名前を指定します。パッケージを指定しない場合、関数を呼び出しているモジュールのディレクトリを相対の基準ディレクトリとして使います。
<em>module_relative</em> を <tt class="docutils literal"><span class="pre">False</span></tt> に指定している場合、 <em>package</em> を指定するとエラーになります。</p>
<p>オプション引数 <em>setUp</em> には、テストスイートのセットアップに使う関数を指定します。この関数は、各ファイルのテストを実行する前に呼び出されます。
<em>setUp</em> 関数は <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> オブジェクトに引き渡されます。
<em>setUp</em> は <em>globs</em> 属性を介してテストのグローバル変数にアクセスできます。</p>
<p>オプション引数 <em>tearDown</em> には、テストを解体 (tear-down) するための関数を指定します。この関数は、各ファイルのテストの実行を終了するたびに呼び出されます。
<em>tearDown</em> 関数は <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a>  オブジェクトに引き渡されます。
<em>tearDown</em> は <em>globs</em> 属性を介してテストのグローバル変数にアクセスできます。</p>
<p>オプション引数 <em>globs</em> は辞書で、テストのグローバル変数の初期値が入ります。この辞書は各テストごとに新たにコピーして使われます。デフォルトでは <em>globs</em> は空の新たな辞書です。</p>
<p>オプション引数 <em>optionflags</em> には、テストを実行する際にデフォルトで適用される
doctest オプションを OR で結合して指定します。
<a class="reference internal" href="#doctest-options"><em>オプションフラグとディレクティブ</em></a> 節を参照してください。結果レポートに関するオプションを指定するより適切な方法は下記の <a class="reference internal" href="#doctest.set_unittest_reportflags" title="doctest.set_unittest_reportflags"><tt class="xref py py-func docutils literal"><span class="pre">set_unittest_reportflags()</span></tt></a>
の説明を参照してください。</p>
<p>オプション引数 <em>parser</em> には、ファイルからテストを抽出するために使う <a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><tt class="xref py py-class docutils literal"><span class="pre">DocTestParser</span></tt></a> (またはサブクラス)
を指定します。デフォルトは通常のパーザ (<tt class="docutils literal"><span class="pre">DocTestParser()</span></tt>) です。</p>
<p>オプション引数 <em>encoding</em> にはファイルをユニコードに変換する際に使われるエンコーディングを指定します。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.5 で変更: </span>グローバル変数 <tt class="docutils literal"><span class="pre">__file__</span></tt> が追加され <a class="reference internal" href="#doctest.DocFileSuite" title="doctest.DocFileSuite"><tt class="xref py py-func docutils literal"><span class="pre">DocFileSuite()</span></tt></a> を使ってテキストファイルから読み込まれた doctest
に提供されます。</p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.5 で変更: </span><em>encoding</em> パラメータが追加されました。</p>
</dd></dl>

<dl class="function">
<dt id="doctest.DocTestSuite">
<tt class="descclassname">doctest.</tt><tt class="descname">DocTestSuite</tt><big>(</big><em>[module][, globs][, extraglobs][, test_finder][, setUp][, tearDown][, checker]</em><big>)</big><a class="headerlink" href="#doctest.DocTestSuite" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>doctest のテストを <a class="reference internal" href="unittest.html#unittest.TestSuite" title="unittest.TestSuite"><tt class="xref py py-class docutils literal"><span class="pre">unittest.TestSuite</span></tt></a> に変換します。</p>
<p>この関数の返す <a class="reference internal" href="unittest.html#unittest.TestSuite" title="unittest.TestSuite"><tt class="xref py py-class docutils literal"><span class="pre">unittest.TestSuite</span></tt></a> インスタンスは、 unittest フレームワークで動作させ、モジュール内の各
doctest を実行するためのものです。何らかの doctest の実行に失敗すると、この関数で生成した単体テストは失敗し、該当するテストの入っているファイルの名前と、 (場合によりだいたいの) 行番号の入った <tt class="xref py py-exc docutils literal"><span class="pre">failureException</span></tt>
例外を送出します。</p>
<p>オプション引数 <em>module</em> には、テストしたいモジュールの名前を指定します。 <em>module</em> にはモジュールオブジェクトまたは (ドット表記の)
モジュール名を指定できます。 <em>module</em> を指定しない場合、この関数を呼び出しているモジュールになります。</p>
<p>オプション引数 <em>globs</em> は辞書で、テストのグローバル変数の初期値が入ります。この辞書は各テストごとに新たにコピーして使われます。デフォルトでは <em>glob</em> は空の新たな辞書です。</p>
<p>オプション引数 <em>extraglobs</em> には追加のグローバル変数セットを指定します。この変数セットは <em>globs</em> に統合されます。デフォルトでは、追加のグローバル変数はありません。</p>
<p>オプション引数 <em>test_finder</em> は、モジュールから doctest を抽出するための <a class="reference internal" href="#doctest.DocTestFinder" title="doctest.DocTestFinder"><tt class="xref py py-class docutils literal"><span class="pre">DocTestFinder</span></tt></a> オブジェクト
(またはその代替となるオブジェクト) です。</p>
<p>オプション引数 <em>setUp</em> 、 <em>tearDown</em> 、および <em>optionflags</em> は上の <a class="reference internal" href="#doctest.DocFileSuite" title="doctest.DocFileSuite"><tt class="xref py py-func docutils literal"><span class="pre">DocFileSuite()</span></tt></a> と同じです。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.3 で追加.</span></p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.4 で変更: </span><em>globs</em>, <em>extraglobs</em>, <em>test_finder</em>, <em>setUp</em>, <em>tearDown</em>, および <em>optionflags</em>
パラメータが追加されました。また、この関数は doctest の検索に <a class="reference internal" href="#doctest.testmod" title="doctest.testmod"><tt class="xref py py-func docutils literal"><span class="pre">testmod()</span></tt></a> と同じテクニックを使うようになりました。</p>
</dd></dl>

<p>裏側では <a class="reference internal" href="#doctest.DocTestSuite" title="doctest.DocTestSuite"><tt class="xref py py-func docutils literal"><span class="pre">DocTestSuite()</span></tt></a> は <tt class="xref py py-class docutils literal"><span class="pre">doctest.DocTestCase</span></tt>
インスタンスから <a class="reference internal" href="unittest.html#unittest.TestSuite" title="unittest.TestSuite"><tt class="xref py py-class docutils literal"><span class="pre">unittest.TestSuite</span></tt></a> を作成しており、 <tt class="xref py py-class docutils literal"><span class="pre">DocTestCase</span></tt>
は <a class="reference internal" href="unittest.html#unittest.TestCase" title="unittest.TestCase"><tt class="xref py py-class docutils literal"><span class="pre">unittest.TestCase</span></tt></a> のサブクラスになっています。 <tt class="xref py py-class docutils literal"><span class="pre">DocTestCase</span></tt> についてはここでは説明しません
(これは内部実装上の詳細だからです) が、そのコードを調べてみれば、 <a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> の組み込みの詳細に関する疑問を解決できるはずです。</p>
<p>同様に、 <a class="reference internal" href="#doctest.DocFileSuite" title="doctest.DocFileSuite"><tt class="xref py py-func docutils literal"><span class="pre">DocFileSuite()</span></tt></a> は <tt class="xref py py-class docutils literal"><span class="pre">doctest.DocFileCase</span></tt>
インスタンスから <a class="reference internal" href="unittest.html#unittest.TestSuite" title="unittest.TestSuite"><tt class="xref py py-class docutils literal"><span class="pre">unittest.TestSuite</span></tt></a> を作成し、 <tt class="xref py py-class docutils literal"><span class="pre">DocFileCase</span></tt> は
<tt class="xref py py-class docutils literal"><span class="pre">DocTestCase</span></tt> のサブクラスになっています。</p>
<p>そのため、 <a class="reference internal" href="unittest.html#unittest.TestSuite" title="unittest.TestSuite"><tt class="xref py py-class docutils literal"><span class="pre">unittest.TestSuite</span></tt></a> クラスを生成するどちらの方法も <tt class="xref py py-class docutils literal"><span class="pre">DocTestCase</span></tt> のインスタンスを実行します。これは次のような微妙な理由で重要です: <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a>
関数を自分で実行する場合、オプションフラグを <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> 関数に渡すことで、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a>
のオプションを直接操作できます。しかしながら、 <a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> フレームワークを書いている場合には、いつどのようにテストを動作させるかを
<a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> が完全に制御してしまいます。フレームワークの作者はたいてい、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> のレポートオプションを
(コマンドラインオプションで指定するなどして) 操作したいと考えますが、 <a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> を介して <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a>
のテストランナーにオプションを渡す方法は存在しないのです。</p>
<p>このため、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> では、以下の関数を使って、 <a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> サポートに特化したレポートフラグ表記方法もサポートしています。</p>
<dl class="function">
<dt id="doctest.set_unittest_reportflags">
<tt class="descclassname">doctest.</tt><tt class="descname">set_unittest_reportflags</tt><big>(</big><em>flags</em><big>)</big><a class="headerlink" href="#doctest.set_unittest_reportflags" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> のレポートフラグをセットします。</p>
<p>引数 <em>flags</em> にはオプションフラグを OR で結合して渡します。
<a class="reference internal" href="#doctest-options"><em>オプションフラグとディレクティブ</em></a> 節を参照してください。「レポートフラグ」しか使えません。</p>
<p>この関数で設定した内容はモジュール全体にわたるものであり、関数呼び出し以後に <a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> モジュールから実行されるすべての doctest
に影響します: <tt class="xref py py-class docutils literal"><span class="pre">DocTestCase</span></tt> の <tt class="xref py py-meth docutils literal"><span class="pre">runTest()</span></tt> メソッドは、 <tt class="xref py py-class docutils literal"><span class="pre">DocTestCase</span></tt>
インスタンスが作成された際に、現在のテストケースに指定されたオプションフラグを見に行きます。レポートフラグが指定されていない場合
(通常の場合で、望ましいケースです)、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> の <a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> レポートフラグが OR で結合され、doctest
を実行するために作成される <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a>  インスタンスに渡されます。 <tt class="xref py py-class docutils literal"><span class="pre">DocTestCase</span></tt>
インスタンスを構築する際に何らかのレポートフラグが指定されていた場合、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> の <a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a>
レポートフラグは無視されます。</p>
<p>この関数は、関数を呼び出す前に有効になっていた <a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a>  レポートフラグの値を返します。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
</dd></dl>

</div>
<div class="section" id="doctest-advanced-api">
<span id="id11"></span><h2>25.2.6. 拡張 API<a class="headerlink" href="#doctest-advanced-api" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>基本 API は、 doctest を使いやすくするための簡単なラッパであり、柔軟性があってほとんどのユーザの必要を満たしています; とはいえ、もっとテストをきめ細かに制御したい場合や、 doctest の機能を拡張したい場合、拡張 API (advanced API) を使わなければなりません。</p>
<p>拡張 API は、doctest ケースから抽出した対話モードでの実行例を記憶するための二つのコンテナクラスを中心に構成されています。</p>
<ul class="simple">
<li><a class="reference internal" href="#doctest.Example" title="doctest.Example"><tt class="xref py py-class docutils literal"><span class="pre">Example</span></tt></a>: 1つの Python 文 (<a class="reference internal" href="../glossary.html#term-statement"><em class="xref std std-term">statement</em></a>) と、その期待する出力をペアにしたもの。</li>
<li><a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a>: <a class="reference internal" href="#doctest.Example" title="doctest.Example"><tt class="xref py py-class docutils literal"><span class="pre">Example</span></tt></a> の集まり。通常一つの docstring やテキストファイルから抽出されます。</li>
</ul>
<p>その他に、 doctest の実行例を検索、構文解析、実行、チェックするための処理クラスが以下のように定義されています。</p>
<ul class="simple">
<li><a class="reference internal" href="#doctest.DocTestFinder" title="doctest.DocTestFinder"><tt class="xref py py-class docutils literal"><span class="pre">DocTestFinder</span></tt></a>: 与えられたモジュールからすべての docstring を検索し、 <a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><tt class="xref py py-class docutils literal"><span class="pre">DocTestParser</span></tt></a> を使って対話モードでの実行例が入ったすべての docstring から <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> を生成します。</li>
<li><a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><tt class="xref py py-class docutils literal"><span class="pre">DocTestParser</span></tt></a>: (オブジェクトの docstring 等の) 文字列から <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a>
オブジェクトを生成します。</li>
<li><a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a>: <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> 内の実行例を実行し、 <a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><tt class="xref py py-class docutils literal"><span class="pre">OutputChecker</span></tt></a>
を使って出力を検証します。</li>
<li><a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><tt class="xref py py-class docutils literal"><span class="pre">OutputChecker</span></tt></a>: doctest 実行例から実際に出力された結果を期待する出力と比較し、両者が一致するか判別します。</li>
</ul>
<p>これらの処理クラスの関係を図にまとめると、以下のようになります。</p>
<div class="highlight-python"><pre>                            list of:
+------+                   +---------+
|module| --DocTestFinder-&gt; | DocTest | --DocTestRunner-&gt; results
+------+    |        ^     +---------+     |       ^    (printed)
            |        |     | Example |     |       |
            v        |     |   ...   |     v       |
           DocTestParser   | Example |   OutputChecker
                           +---------+</pre>
</div>
<div class="section" id="doctest-doctest">
<span id="id12"></span><h3>25.2.6.1. DocTest オブジェクト<a class="headerlink" href="#doctest-doctest" title="このヘッドラインへのパーマリンク">¶</a></h3>
<dl class="class">
<dt id="doctest.DocTest">
<em class="property">class </em><tt class="descclassname">doctest.</tt><tt class="descname">DocTest</tt><big>(</big><em>examples</em>, <em>globs</em>, <em>name</em>, <em>filename</em>, <em>lineno</em>, <em>docstring</em><big>)</big><a class="headerlink" href="#doctest.DocTest" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>単一の名前空間内で実行される doctest 実行例の集まりです。コンストラクタの引数は <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> インスタンス中の同名のメンバ変数の初期化に使われます。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
<p><a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> では、以下のメンバ変数を定義しています。これらの変数はコンストラクタで初期化されます。直接変更してはなりません。</p>
<dl class="attribute">
<dt id="doctest.DocTest.examples">
<tt class="descname">examples</tt><a class="headerlink" href="#doctest.DocTest.examples" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>対話モードにおける実行例それぞれをエンコードしていて、テストで実行される、 <a class="reference internal" href="#doctest.Example" title="doctest.Example"><tt class="xref py py-class docutils literal"><span class="pre">Example</span></tt></a> オブジェクトからなるリストです。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.DocTest.globs">
<tt class="descname">globs</tt><a class="headerlink" href="#doctest.DocTest.globs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>実行例を実行する名前空間 (いわゆるグローバル変数) です。このメンバは、名前から値への対応付けを行っている辞書です。実行例が名前空間に対して
(新たな変数を束縛するなど) 何らかの変更を行った場合、 <a class="reference internal" href="#doctest.DocTest.globs" title="doctest.DocTest.globs"><tt class="xref py py-attr docutils literal"><span class="pre">globs</span></tt></a> への反映はテストの実行後に起こります。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.DocTest.name">
<tt class="descname">name</tt><a class="headerlink" href="#doctest.DocTest.name" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> を識別する名前の文字列です。通常、この値はテストを取り出したオブジェクトかファイルの名前になります。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.DocTest.filename">
<tt class="descname">filename</tt><a class="headerlink" href="#doctest.DocTest.filename" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> を取り出したファイルの名前です; ファイル名が未知の場合や <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> をファイルから取り出したのでない場合には <tt class="docutils literal"><span class="pre">None</span></tt> になります。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.DocTest.lineno">
<tt class="descname">lineno</tt><a class="headerlink" href="#doctest.DocTest.lineno" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#doctest.DocTest.filename" title="doctest.DocTest.filename"><tt class="xref py py-attr docutils literal"><span class="pre">filename</span></tt></a> 中で <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> のテスト実行例が始まっている行の行番号です。行番号は、ファイルの先頭を 0 として数えます。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.DocTest.docstring">
<tt class="descname">docstring</tt><a class="headerlink" href="#doctest.DocTest.docstring" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テストを取り出した docstring 自体を現す文字列です。 docstring 文字列を得られない場合や、文字列からテスト実行例を取り出したのでない場合には
<tt class="docutils literal"><span class="pre">None</span></tt> になります。</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="example">
<span id="doctest-example"></span><h3>25.2.6.2. Example オブジェクト<a class="headerlink" href="#example" title="このヘッドラインへのパーマリンク">¶</a></h3>
<dl class="class">
<dt id="doctest.Example">
<em class="property">class </em><tt class="descclassname">doctest.</tt><tt class="descname">Example</tt><big>(</big><em>source, want[, exc_msg][, lineno][, indent][, options]</em><big>)</big><a class="headerlink" href="#doctest.Example" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>ひとつの Python 文と、それに対する期待する出力からなる、単一の対話的モードの実行例です。コンストラクタの引数は <a class="reference internal" href="#doctest.Example" title="doctest.Example"><tt class="xref py py-class docutils literal"><span class="pre">Example</span></tt></a>
インスタンス中の同名のメンバ変数の初期化に使われます。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
<p><a class="reference internal" href="#doctest.Example" title="doctest.Example"><tt class="xref py py-class docutils literal"><span class="pre">Example</span></tt></a> では、以下のメンバ変数を定義しています。これらの変数はコンストラクタで初期化されます。直接変更してはなりません。</p>
<dl class="attribute">
<dt id="doctest.Example.source">
<tt class="descname">source</tt><a class="headerlink" href="#doctest.Example.source" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>実行例のソースコードが入った文字列です。ソースコードは単一の Python で、末尾は常に改行です。コンストラクタは必要に応じて改行を追加します。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.Example.want">
<tt class="descname">want</tt><a class="headerlink" href="#doctest.Example.want" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>実行例のソースコードを実行した際の期待する出力 (標準出力と、例外が生じた場合にはトレースバック) です。 <a class="reference internal" href="#doctest.Example.want" title="doctest.Example.want"><tt class="xref py py-attr docutils literal"><span class="pre">want</span></tt></a> の末尾は、期待する出力がまったくない場合を除いて常に改行になります。期待する出力がない場合には空文字列になります。コンストラクタは必要に応じて改行を追加します。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.Example.exc_msg">
<tt class="descname">exc_msg</tt><a class="headerlink" href="#doctest.Example.exc_msg" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>実行例が例外を生成すると期待される場合の例外メッセージです。例外を送出しない場合には <tt class="docutils literal"><span class="pre">None</span></tt> です。この例外メッセージは、 <a class="reference internal" href="traceback.html#traceback.format_exception_only" title="traceback.format_exception_only"><tt class="xref py py-func docutils literal"><span class="pre">traceback.format_exception_only()</span></tt></a> の戻り値と比較されます。値が <tt class="docutils literal"><span class="pre">None</span></tt>
でない限り、 <a class="reference internal" href="#doctest.Example.exc_msg" title="doctest.Example.exc_msg"><tt class="xref py py-attr docutils literal"><span class="pre">exc_msg</span></tt></a> は改行で終わっていなければなりません; コンストラクタは必要に応じて改行を追加します。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.Example.lineno">
<tt class="descname">lineno</tt><a class="headerlink" href="#doctest.Example.lineno" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>この実行例を含む文字列における実行例が始まる行番号です。行番号は文字列の先頭を 0 として数えます。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.Example.indent">
<tt class="descname">indent</tt><a class="headerlink" href="#doctest.Example.indent" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>実行例の入っている文字列のインデント、すなわち実行例の最初のプロンプトより前にある空白文字の数です。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.Example.options">
<tt class="descname">options</tt><a class="headerlink" href="#doctest.Example.options" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>オプションフラグを <tt class="docutils literal"><span class="pre">True</span></tt> または <tt class="docutils literal"><span class="pre">False</span></tt> に対応付けている辞書です。実行例に対するデフォルトオプションを上書きするために用いられます。この辞書に入っていないオプションフラグはデフォルトの状態 (<tt class="xref py py-class docutils literal"><span class="pre">DocTestrunner</span></tt> の
<tt class="xref py py-attr docutils literal"><span class="pre">optionflags</span></tt> の内容) のままになります。</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="doctestfinder">
<span id="doctest-doctestfinder"></span><h3>25.2.6.3. DocTestFinder オブジェクト<a class="headerlink" href="#doctestfinder" title="このヘッドラインへのパーマリンク">¶</a></h3>
<dl class="class">
<dt id="doctest.DocTestFinder">
<em class="property">class </em><tt class="descclassname">doctest.</tt><tt class="descname">DocTestFinder</tt><big>(</big><em>[verbose][, parser][, recurse][, exclude_empty]</em><big>)</big><a class="headerlink" href="#doctest.DocTestFinder" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>与えられたオブジェクトについて、そのオブジェクト自身の docstring か、そのオブジェクトに含まれるオブジェクトの docstring
から <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> を抽出する処理クラスです。現在のところ、モジュール、関数、クラス、メソッド、静的メソッド、クラスメソッド、プロパティから <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> を抽出できます。</p>
<p>オプション引数 <em>verbose</em> を使うと、抽出処理の対象となるオブジェクトを表示できます。デフォルトは <tt class="docutils literal"><span class="pre">False</span></tt> (出力を行わない) です。</p>
<p>オプション引数 <em>parser</em> には、 docstring から <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> を抽出するのに使う <a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><tt class="xref py py-class docutils literal"><span class="pre">DocTestParser</span></tt></a> オブジェクト (またはその代替となるオブジェクト) を指定します。</p>
<p>オプション引数 <em>recurse</em> が偽の場合、 <a class="reference internal" href="#doctest.DocTestFinder.find" title="doctest.DocTestFinder.find"><tt class="xref py py-meth docutils literal"><span class="pre">DocTestFinder.find()</span></tt></a>
は与えられたオブジェクトだけを調べ、そのオブジェクトに含まれる他のオブジェクトを調べません。</p>
<p>オプション引数 <em>exclude_empty</em> が偽の場合、 <a class="reference internal" href="#doctest.DocTestFinder.find" title="doctest.DocTestFinder.find"><tt class="xref py py-meth docutils literal"><span class="pre">DocTestFinder.find()</span></tt></a> は空の docstring
を持つオブジェクトもテスト対象に含めます。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
<p><a class="reference internal" href="#doctest.DocTestFinder" title="doctest.DocTestFinder"><tt class="xref py py-class docutils literal"><span class="pre">DocTestFinder</span></tt></a> では以下のメソッドを定義しています。</p>
<dl class="method">
<dt id="doctest.DocTestFinder.find">
<tt class="descname">find</tt><big>(</big><em>obj[, name][, module][, globs][, extraglobs]</em><big>)</big><a class="headerlink" href="#doctest.DocTestFinder.find" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>obj</em> または <em>obj</em> 内に入っているオブジェクトの docstring 中で定義されている
<a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> のリストを返します。</p>
<p>オプション引数 <em>name</em> には、オブジェクトの名前を指定します。この名前は、関数が返す <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> の名前になります。
<em>name</em> を指定しない場合、 <tt class="docutils literal"><span class="pre">obj.__name__</span></tt> を使います。</p>
<p>オプションのパラメータ <em>module</em> は、指定したオブジェクトを収めているモジュールを指定します。
<em>module</em> を指定しないか、 <a class="reference internal" href="constants.html#None" title="None"><tt class="xref py py-const docutils literal"><span class="pre">None</span></tt></a> を指定した場合には、正しいモジュールを自動的に決定しようと試みます。オブジェクトのモジュールは以下のような役割を果たします。</p>
<ul class="simple">
<li><em>globs</em> を指定していない場合、オブジェクトのモジュールはデフォルトの名前空間になります。</li>
<li>他のモジュールから import されたオブジェクトに対して <a class="reference internal" href="#doctest.DocTestFinder" title="doctest.DocTestFinder"><tt class="xref py py-class docutils literal"><span class="pre">DocTestFinder</span></tt></a> が <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a>
を抽出するのを避けるために使います (<em>module</em> 由来でないオブジェクトを無視します)。</li>
<li>オブジェクトの入っているファイル名を調べるために使います。</li>
<li>オブジェクトがファイル内の何行目にあるかを調べる手助けにします。</li>
</ul>
<p><em>module</em> が <tt class="docutils literal"><span class="pre">False</span></tt> の場合には、モジュールの検索を試みません。これは正確さを欠くような使い方で、通常 doctest 自体のテストにしか使いません。
<em>module</em> が <tt class="docutils literal"><span class="pre">False</span></tt> の場合、または <em>module</em> が <tt class="docutils literal"><span class="pre">None</span></tt> で自動的に的確なモジュールを見つけ出せない場合には、すべてのオブジェクトは <tt class="docutils literal"><span class="pre">(non-existent)</span></tt>
モジュールに属するとみなされ、そのオブジェクト内のすべてのオブジェクトに対して
(再帰的に) doctest の検索を行います。</p>
<p>各 <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> のグローバル変数は、 <em>globs</em> と <em>extraglobs</em> を合わせたもの (<em>extraglobs</em>
内の束縛が <em>globs</em> 内の束縛を上書きする) になります。各々の <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> に対して、グローバル変数を表す辞書の新たな浅いコピーを生成します。
<em>globs</em> を指定しない場合に使われるのデフォルト値は、モジュールを指定していればそのモジュールの
<em>__dict__</em> になり、指定していなければ <tt class="docutils literal"><span class="pre">{}</span></tt> になります。
<em>extraglobs</em> を指定しない場合、デフォルトの値は <tt class="docutils literal"><span class="pre">{}</span></tt> になります。</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="doctestparser">
<span id="doctest-doctestparser"></span><h3>25.2.6.4. DocTestParser オブジェクト<a class="headerlink" href="#doctestparser" title="このヘッドラインへのパーマリンク">¶</a></h3>
<dl class="class">
<dt id="doctest.DocTestParser">
<em class="property">class </em><tt class="descclassname">doctest.</tt><tt class="descname">DocTestParser</tt><a class="headerlink" href="#doctest.DocTestParser" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>対話モードの実行例を文字列から抽出し、それを使って <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> オブジェクトを生成するために使われる処理クラスです。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
<p><a class="reference internal" href="#doctest.DocTestParser" title="doctest.DocTestParser"><tt class="xref py py-class docutils literal"><span class="pre">DocTestParser</span></tt></a> では以下のメソッドを定義しています。</p>
<dl class="method">
<dt id="doctest.DocTestParser.get_doctest">
<tt class="descname">get_doctest</tt><big>(</big><em>string</em>, <em>globs</em>, <em>name</em>, <em>filename</em>, <em>lineno</em><big>)</big><a class="headerlink" href="#doctest.DocTestParser.get_doctest" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>指定した文字列からすべての doctest 実行例を抽出し、 <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> オブジェクト内に集めます。</p>
<p><em>globs</em>, <em>name</em>, <em>filename</em>, および <em>lineno</em> は新たに作成される <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a>
オブジェクトの属性になります。詳しくは <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> のドキュメントを参照してください。</p>
</dd></dl>

<dl class="method">
<dt id="doctest.DocTestParser.get_examples">
<tt class="descname">get_examples</tt><big>(</big><em>string</em><span class="optional">[</span>, <em>name</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#doctest.DocTestParser.get_examples" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>指定した文字列からすべての doctest 実行例を抽出し、 <a class="reference internal" href="#doctest.Example" title="doctest.Example"><tt class="xref py py-class docutils literal"><span class="pre">Example</span></tt></a>
オブジェクトからなるリストにして返します。各 <a class="reference internal" href="#doctest.Example" title="doctest.Example"><tt class="xref py py-class docutils literal"><span class="pre">Example</span></tt></a> の行番号は 0 から数えます。オプション引数 <em>name</em> はこの文字列につける名前で、エラーメッセージにしか使われません。</p>
</dd></dl>

<dl class="method">
<dt id="doctest.DocTestParser.parse">
<tt class="descname">parse</tt><big>(</big><em>string</em><span class="optional">[</span>, <em>name</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#doctest.DocTestParser.parse" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>指定した文字列を、実行例とその間のテキストに分割し、実行例を <a class="reference internal" href="#doctest.Example" title="doctest.Example"><tt class="xref py py-class docutils literal"><span class="pre">Example</span></tt></a> オブジェクトに変換し、
<a class="reference internal" href="#doctest.Example" title="doctest.Example"><tt class="xref py py-class docutils literal"><span class="pre">Example</span></tt></a> と文字列からなるリストにして返します。各 <a class="reference internal" href="#doctest.Example" title="doctest.Example"><tt class="xref py py-class docutils literal"><span class="pre">Example</span></tt></a> の行番号は 0から数えます。オプション引数 <em>name</em>
はこの文字列につける名前で、エラーメッセージにしか使われません。</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="doctestrunner">
<span id="doctest-doctestrunner"></span><h3>25.2.6.5. DocTestRunner オブジェクト<a class="headerlink" href="#doctestrunner" title="このヘッドラインへのパーマリンク">¶</a></h3>
<dl class="class">
<dt id="doctest.DocTestRunner">
<em class="property">class </em><tt class="descclassname">doctest.</tt><tt class="descname">DocTestRunner</tt><big>(</big><em>[checker][, verbose][, optionflags]</em><big>)</big><a class="headerlink" href="#doctest.DocTestRunner" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> 内の対話モード実行例を実行し、検証する際に用いられる処理クラスです。</p>
<p>期待する出力と実際の出力との比較は <a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><tt class="xref py py-class docutils literal"><span class="pre">OutputChecker</span></tt></a> で行います。比較は様々なオプションフラグを使ってカスタマイズできます;
詳しくは <a class="reference internal" href="#doctest-options"><em>オプションフラグとディレクティブ</em></a> を参照してください。オプションフラグでは不十分な場合、コンストラクタに
<a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><tt class="xref py py-class docutils literal"><span class="pre">OutputChecker</span></tt></a> のサブクラスを渡して比較方法をカスタマイズできます。</p>
<p>テストランナーの表示出力の制御には二つの方法があります。一つ目は、 <tt class="xref py py-meth docutils literal"><span class="pre">TestRunner.run()</span></tt> に出力用の関数を渡すというものです。この関数は、表示すべき文字列を引数にして呼び出されます。デフォルトは <tt class="docutils literal"><span class="pre">sys.stdout.write</span></tt> です。出力を取り込んで処理するだけでは不十分な場合、
<a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> をサブクラス化し、 <a class="reference internal" href="#doctest.DocTestRunner.report_start" title="doctest.DocTestRunner.report_start"><tt class="xref py py-meth docutils literal"><span class="pre">report_start()</span></tt></a>,
<a class="reference internal" href="#doctest.DocTestRunner.report_success" title="doctest.DocTestRunner.report_success"><tt class="xref py py-meth docutils literal"><span class="pre">report_success()</span></tt></a>, <a class="reference internal" href="#doctest.DocTestRunner.report_unexpected_exception" title="doctest.DocTestRunner.report_unexpected_exception"><tt class="xref py py-meth docutils literal"><span class="pre">report_unexpected_exception()</span></tt></a>, および
<a class="reference internal" href="#doctest.DocTestRunner.report_failure" title="doctest.DocTestRunner.report_failure"><tt class="xref py py-meth docutils literal"><span class="pre">report_failure()</span></tt></a> をオーバライドすればカスタマイズできます。</p>
<p>オプションのキーワード引数 <em>checker</em> には、 <a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><tt class="xref py py-class docutils literal"><span class="pre">OutputChecker</span></tt></a> オブジェクト (またはその代替となるオブジェクト)
を指定します。このオブジェクトは doctest 実行例の期待する出力と実際の出力との比較を行う際に使われます。</p>
<p>オプションのキーワード引数 <em>verbose</em> は、 <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> の出すメッセージの冗長性を制御します。
<em>verbose</em> が <tt class="docutils literal"><span class="pre">True</span></tt> の場合、各実行例を実行する都度、その実行例についての情報を出力します。
<em>verbose</em> が <tt class="docutils literal"><span class="pre">False</span></tt> の場合、テストの失敗だけを出力します。
<em>verbose</em> を指定しない場合や <tt class="docutils literal"><span class="pre">None</span></tt> を指定した場合、コマンドラインスイッチ
<tt class="docutils literal"><span class="pre">-v</span></tt> を使った場合にのみ <em>verbose</em> 出力を適用します。</p>
<p>オプションのキーワード引数  <em>optionflags</em> を使うと、テストランナーが期待される出力と実際の出力を比較する方法や、テストの失敗を表示する方法を制御できます。詳しくは <a class="reference internal" href="#doctest-options"><em>オプションフラグとディレクティブ</em></a> 節を参照してください。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
<p><a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> では、以下のメソッドを定義しています。</p>
<dl class="method">
<dt id="doctest.DocTestRunner.report_start">
<tt class="descname">report_start</tt><big>(</big><em>out</em>, <em>test</em>, <em>example</em><big>)</big><a class="headerlink" href="#doctest.DocTestRunner.report_start" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テストランナーが実行例を処理しようとしているときにレポートを出力します。
<a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> の出力をサブクラスでカスタマイズできるようにするためのメソッドです。直接呼び出してはなりません。</p>
<p><em>example</em> は処理する実行例です。 <em>test</em> は <em>example</em> の入っているテストです。
<em>out</em> は出力用の関数で、 <a class="reference internal" href="#doctest.DocTestRunner.run" title="doctest.DocTestRunner.run"><tt class="xref py py-meth docutils literal"><span class="pre">DocTestRunner.run()</span></tt></a> に渡されます。</p>
</dd></dl>

<dl class="method">
<dt id="doctest.DocTestRunner.report_success">
<tt class="descname">report_success</tt><big>(</big><em>out</em>, <em>test</em>, <em>example</em>, <em>got</em><big>)</big><a class="headerlink" href="#doctest.DocTestRunner.report_success" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>与えられた実行例が正しく動作したことを報告します。このメソッドは <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> のサブクラスで出力をカスタマイズできるようにするために提供されています; 直接呼び出してはなりません。</p>
<p><em>example</em> は処理する実行例です。 <em>got</em> は実行例から実際に得られた出力です。
<em>test</em> は <em>example</em> の入っているテストです。
<em>out</em> は出力用の関数で、 <a class="reference internal" href="#doctest.DocTestRunner.run" title="doctest.DocTestRunner.run"><tt class="xref py py-meth docutils literal"><span class="pre">DocTestRunner.run()</span></tt></a> に渡されます。</p>
</dd></dl>

<dl class="method">
<dt id="doctest.DocTestRunner.report_failure">
<tt class="descname">report_failure</tt><big>(</big><em>out</em>, <em>test</em>, <em>example</em>, <em>got</em><big>)</big><a class="headerlink" href="#doctest.DocTestRunner.report_failure" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>与えられた実行例が正しく動作しなかったことを報告します。このメソッドは <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> のサブクラスで出力をカスタマイズできるようにするために提供されています; 直接呼び出してはなりません。</p>
<p><em>example</em> は処理する実行例です。 <em>got</em> は実行例から実際に得られた出力です。
<em>test</em> は <em>example</em> の入っているテストです。
<em>out</em> は出力用の関数で、 <a class="reference internal" href="#doctest.DocTestRunner.run" title="doctest.DocTestRunner.run"><tt class="xref py py-meth docutils literal"><span class="pre">DocTestRunner.run()</span></tt></a> に渡されます。</p>
</dd></dl>

<dl class="method">
<dt id="doctest.DocTestRunner.report_unexpected_exception">
<tt class="descname">report_unexpected_exception</tt><big>(</big><em>out</em>, <em>test</em>, <em>example</em>, <em>exc_info</em><big>)</big><a class="headerlink" href="#doctest.DocTestRunner.report_unexpected_exception" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>与えられた実行例が期待とは違う例外を送出したことを報告します。このメソッドは <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> のサブクラスで出力をカスタマイズできるようにするために提供されています; 直接呼び出してはなりません。</p>
<p><em>example</em> は処理する実行例です。 <em>exc_info</em> には予期せず送出された例外の情報を入れたタプル (<a class="reference internal" href="sys.html#sys.exc_info" title="sys.exc_info"><tt class="xref py py-func docutils literal"><span class="pre">sys.exc_info()</span></tt></a> の返す内容) になります。
<em>test</em> は <em>example</em> の入っているテストです。
<em>out</em> は出力用の関数で、 <a class="reference internal" href="#doctest.DocTestRunner.run" title="doctest.DocTestRunner.run"><tt class="xref py py-meth docutils literal"><span class="pre">DocTestRunner.run()</span></tt></a> に渡されます。</p>
</dd></dl>

<dl class="method">
<dt id="doctest.DocTestRunner.run">
<tt class="descname">run</tt><big>(</big><em>test[, compileflags][, out][, clear_globs]</em><big>)</big><a class="headerlink" href="#doctest.DocTestRunner.run" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>test</em> 内の実行例 (<a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> オブジェクト) を実行し、その結果を出力用の関数 <em>out</em> を使って表示します。</p>
<p>実行例は名前空間 <tt class="docutils literal"><span class="pre">test.globs</span></tt> の下で実行されます。
<em>clear_globs</em> が真 (デフォルト) の場合、名前空間はテストの実行後に消去され、ガベージコレクションを促します。テストの実行完了後にその内容を調べたければ、 <em>clear_globs</em> を
<a class="reference internal" href="constants.html#False" title="False"><tt class="xref py py-const docutils literal"><span class="pre">False</span></tt></a> にしてください。</p>
<p><em>compileflags</em> には、実行例を実行する際に Python コンパイラに適用するフラグセットを指定します。
<em>compileflags</em> を指定しない場合、デフォルト値は <em>globs</em> で適用されている
future-import フラグセットになります。</p>
<p>各実行例の出力は <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> の出力チェッカで検査され、その結果は
<tt class="xref py py-meth docutils literal"><span class="pre">DocTestRunner.report_*()</span></tt> メソッドで書式化されます。</p>
</dd></dl>

<dl class="method">
<dt id="doctest.DocTestRunner.summarize">
<tt class="descname">summarize</tt><big>(</big><span class="optional">[</span><em>verbose</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#doctest.DocTestRunner.summarize" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>この DocTestRunner が実行したすべてのテストケースのサマリを出力し、名前付きタプル (<a class="reference internal" href="../glossary.html#term-named-tuple"><em class="xref std std-term">named tuple</em></a>) <tt class="docutils literal"><span class="pre">TestResults(failed,</span> <span class="pre">attempted)</span></tt> を返します。</p>
<p>オプションの <em>verbose</em> 引数を使うと、どのくらいサマリを詳しくするかを制御できます。冗長度を指定しない場合、 <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> 自体の冗長度を使います。</p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.6 で変更: </span>名前付きタプル (named tuple) を使うようになりました。</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="outputchecker">
<span id="doctest-outputchecker"></span><h3>25.2.6.6. OutputChecker オブジェクト<a class="headerlink" href="#outputchecker" title="このヘッドラインへのパーマリンク">¶</a></h3>
<dl class="class">
<dt id="doctest.OutputChecker">
<em class="property">class </em><tt class="descclassname">doctest.</tt><tt class="descname">OutputChecker</tt><a class="headerlink" href="#doctest.OutputChecker" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>doctest 実行例を実際に実行したときの出力が期待する出力と一致するかどうかをチェックするために使われるクラスです。
<a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><tt class="xref py py-class docutils literal"><span class="pre">OutputChecker</span></tt></a> では、与えられた二つの出力を比較して、一致する場合には真を返す <a class="reference internal" href="#doctest.OutputChecker.check_output" title="doctest.OutputChecker.check_output"><tt class="xref py py-meth docutils literal"><span class="pre">check_output()</span></tt></a> と、二つの出力間の違いを説明する文字列を返す <a class="reference internal" href="#doctest.OutputChecker.output_difference" title="doctest.OutputChecker.output_difference"><tt class="xref py py-meth docutils literal"><span class="pre">output_difference()</span></tt></a>
の、二つのメソッドがあります。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
<p><a class="reference internal" href="#doctest.OutputChecker" title="doctest.OutputChecker"><tt class="xref py py-class docutils literal"><span class="pre">OutputChecker</span></tt></a> では以下のメソッドを定義しています。</p>
<dl class="method">
<dt id="doctest.OutputChecker.check_output">
<tt class="descname">check_output</tt><big>(</big><em>want</em>, <em>got</em>, <em>optionflags</em><big>)</big><a class="headerlink" href="#doctest.OutputChecker.check_output" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>実行例から実際に得られた出力 (<em>got</em>) と、期待する出力 (<em>want</em>)
が一致する場合にのみ <tt class="docutils literal"><span class="pre">True</span></tt> を返します。二つの文字列がまったく同一の場合には常に一致するとみなしますが、テストランナーの使っているオプションフラグにより、厳密には同じ内容になっていなくても一致するとみなす場合もあります。オプションフラグについての詳しい情報は <a class="reference internal" href="#doctest-options"><em>オプションフラグとディレクティブ</em></a> 節を参照してください。</p>
</dd></dl>

<dl class="method">
<dt id="doctest.OutputChecker.output_difference">
<tt class="descname">output_difference</tt><big>(</big><em>example</em>, <em>got</em>, <em>optionflags</em><big>)</big><a class="headerlink" href="#doctest.OutputChecker.output_difference" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>与えられた実行例の期待する出力 (<em>want</em>)と、実際に得られた出力 (<em>got</em>)
の間の差異を解説している文字列を返します。
<em>optionflags</em> は <em>want</em> と <em>got</em> を比較する際に使われるオプションフラグのセットです。</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="doctest-debugging">
<span id="id13"></span><h2>25.2.7. デバッグ<a class="headerlink" href="#doctest-debugging" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> では、doctest 実行例をデバッグするメカニズムをいくつか提供しています。</p>
<ul>
<li><p class="first">doctest を実行可能な Python プログラムに変換し、 Python デバッガ <a class="reference internal" href="pdb.html#module-pdb" title="pdb: 対話的インタプリタのためのPythonデバッガ。"><tt class="xref py py-mod docutils literal"><span class="pre">pdb</span></tt></a>
で実行できるようにするための関数がいくつかあります。</p>
</li>
<li><p class="first"><a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> のサブクラス <a class="reference internal" href="#doctest.DebugRunner" title="doctest.DebugRunner"><tt class="xref py py-class docutils literal"><span class="pre">DebugRunner</span></tt></a> クラスがあります。このクラスは、最初に失敗した実行例に対して例外を送出します。例外には実行例に関する情報が入っています。この情報は実行例の検死デバッグに利用できます。</p>
</li>
<li><p class="first"><a class="reference internal" href="#doctest.DocTestSuite" title="doctest.DocTestSuite"><tt class="xref py py-func docutils literal"><span class="pre">DocTestSuite()</span></tt></a> の生成する <a class="reference internal" href="unittest.html#module-unittest" title="unittest: ユニットテストフレームワーク"><tt class="xref py py-mod docutils literal"><span class="pre">unittest</span></tt></a> テストケースは、 <a class="reference internal" href="#doctest.debug" title="doctest.debug"><tt class="xref py py-meth docutils literal"><span class="pre">debug()</span></tt></a>
メソッドをサポートしています。 <a class="reference internal" href="#doctest.debug" title="doctest.debug"><tt class="xref py py-meth docutils literal"><span class="pre">debug()</span></tt></a> は <a class="reference internal" href="unittest.html#unittest.TestCase" title="unittest.TestCase"><tt class="xref py py-class docutils literal"><span class="pre">unittest.TestCase</span></tt></a> で定義されています。</p>
</li>
<li><p class="first"><a class="reference internal" href="pdb.html#pdb.set_trace" title="pdb.set_trace"><tt class="xref py py-func docutils literal"><span class="pre">pdb.set_trace()</span></tt></a> を doctest 実行例の中で呼び出しておけば、その行が実行されたときに Python
デバッガが組み込まれます。デバッガを組み込んだあとは、変数の現在の値などを調べられます。たとえば、以下のようなモジュールレベルの docstring
の入ったファイル <tt class="file docutils literal"><span class="pre">a.py</span></tt> があるとします。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&gt;&gt;&gt; def f(x):</span>
<span class="sd">...     g(x*2)</span>
<span class="sd">&gt;&gt;&gt; def g(x):</span>
<span class="sd">...     print x+3</span>
<span class="sd">...     import pdb; pdb.set_trace()</span>
<span class="sd">&gt;&gt;&gt; f(3)</span>
<span class="sd">9</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>対話セッションは以下のようになるでしょう。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">a</span><span class="o">,</span> <span class="nn">doctest</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">doctest</span><span class="o">.</span><span class="n">testmod</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="go">--Return--</span>
<span class="go">&gt; &lt;doctest a[1]&gt;(3)g()-&gt;None</span>
<span class="go">-&gt; import pdb; pdb.set_trace()</span>
<span class="go">(Pdb) list</span>
<span class="go">  1     def g(x):</span>
<span class="go">  2         print x+3</span>
<span class="go">  3  -&gt;     import pdb; pdb.set_trace()</span>
<span class="go">[EOF]</span>
<span class="go">(Pdb) print x</span>
<span class="go">6</span>
<span class="go">(Pdb) step</span>
<span class="go">--Return--</span>
<span class="go">&gt; &lt;doctest a[0]&gt;(2)f()-&gt;None</span>
<span class="go">-&gt; g(x*2)</span>
<span class="go">(Pdb) list</span>
<span class="go">  1     def f(x):</span>
<span class="go">  2  -&gt;     g(x*2)</span>
<span class="go">[EOF]</span>
<span class="go">(Pdb) print x</span>
<span class="go">3</span>
<span class="go">(Pdb) step</span>
<span class="go">--Return--</span>
<span class="go">&gt; &lt;doctest a[2]&gt;(1)?()-&gt;None</span>
<span class="go">-&gt; f(3)</span>
<span class="go">(Pdb) cont</span>
<span class="go">(0, 3)</span>
<span class="go">&gt;&gt;&gt;</span>
</pre></div>
</div>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.4 で変更: </span><a class="reference internal" href="pdb.html#pdb.set_trace" title="pdb.set_trace"><tt class="xref py py-func docutils literal"><span class="pre">pdb.set_trace()</span></tt></a> を doctest の中で有効に使えるようになりました。</p>
</li>
</ul>
<p>以下は、doctest を Python コードに変換して、できたコードをデバッガ下で実行できるようにするための関数です。</p>
<dl class="function">
<dt id="doctest.script_from_examples">
<tt class="descclassname">doctest.</tt><tt class="descname">script_from_examples</tt><big>(</big><em>s</em><big>)</big><a class="headerlink" href="#doctest.script_from_examples" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>実行例の入ったテキストをスクリプトに変換します。</p>
<p>引数 <em>s</em> は doctest 実行例の入った文字列です。この文字列は Python スクリプトに変換され、その中では <em>s</em> の doctest 実行例が通常のコードに、それ以外は Python のコメント文になります。生成したスクリプトを文字列で返します。例えば、</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">doctest</span>
<span class="k">print</span> <span class="n">doctest</span><span class="o">.</span><span class="n">script_from_examples</span><span class="p">(</span><span class="s">r&quot;&quot;&quot;</span>
<span class="s">    Set x and y to 1 and 2.</span>
<span class="s">    &gt;&gt;&gt; x, y = 1, 2</span>

<span class="s">    Print their sum:</span>
<span class="s">    &gt;&gt;&gt; print x+y</span>
<span class="s">    3</span>
<span class="s">&quot;&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>は、</p>
<div class="highlight-python"><div class="highlight"><pre><span class="c"># Set x and y to 1 and 2.</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="c">#</span>
<span class="c"># Print their sum:</span>
<span class="k">print</span> <span class="n">x</span><span class="o">+</span><span class="n">y</span>
<span class="c"># Expected:</span>
<span class="c">## 3</span>
</pre></div>
</div>
<p>になります。</p>
<p>この関数は内部的に他の関数から使われていますが (下記参照) 、対話セッションを
Python スクリプトに変換したいような場合にも便利でしょう。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
</dd></dl>

<dl class="function">
<dt id="doctest.testsource">
<tt class="descclassname">doctest.</tt><tt class="descname">testsource</tt><big>(</big><em>module</em>, <em>name</em><big>)</big><a class="headerlink" href="#doctest.testsource" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>あるオブジェクトの doctest をスクリプトに変換します。</p>
<p>引数 <em>module</em> はモジュールオブジェクトか、対象の doctest を持つオブジェクトの入ったモジュールのドット表記名です。引数 <em>name</em> は対象の doctest を持つオブジェクトの (モジュール内の) 名前です。対象オブジェクトの docstring を上記の <a class="reference internal" href="#doctest.script_from_examples" title="doctest.script_from_examples"><tt class="xref py py-func docutils literal"><span class="pre">script_from_examples()</span></tt></a>
で説明した方法で Python スクリプトに変換してできた文字列を返します。例えば、 <tt class="file docutils literal"><span class="pre">a.py</span></tt> モジュールのトップレベルに関数 <tt class="xref py py-func docutils literal"><span class="pre">f()</span></tt> がある場合、以下のコード</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">import</span> <span class="nn">a</span><span class="o">,</span> <span class="nn">doctest</span>
<span class="k">print</span> <span class="n">doctest</span><span class="o">.</span><span class="n">testsource</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s">&quot;a.f&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>を実行すると、 <tt class="xref py py-func docutils literal"><span class="pre">f()</span></tt> の docstring から doctest をコードに変換し、それ以外をコメントにしたスクリプトを出力します。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.3 で追加.</span></p>
</dd></dl>

<dl class="function">
<dt id="doctest.debug">
<tt class="descclassname">doctest.</tt><tt class="descname">debug</tt><big>(</big><em>module</em>, <em>name</em><span class="optional">[</span>, <em>pm</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#doctest.debug" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>オブジェクトの持つ doctest をデバッグします。</p>
<p><em>module</em> および <em>name</em> 引数は上の <a class="reference internal" href="#doctest.testsource" title="doctest.testsource"><tt class="xref py py-func docutils literal"><span class="pre">testsource()</span></tt></a> と同じです。指定したオブジェクトの docstring から合成された Python
スクリプトは一時ファイルに書き出され、その後 Python デバッガ <a class="reference internal" href="pdb.html#module-pdb" title="pdb: 対話的インタプリタのためのPythonデバッガ。"><tt class="xref py py-mod docutils literal"><span class="pre">pdb</span></tt></a> の制御下で実行されます。</p>
<p>ローカルおよびグローバルの実行コンテキストには、 <tt class="docutils literal"><span class="pre">module.__dict__</span></tt> の浅いコピーが使われます。</p>
<p>オプション引数 <em>pm</em> は、検死デバッグを行うかどうかを指定します。
<em>pm</em> が真の場合、スクリプトファイルは直接実行され、スクリプトが送出した例外が処理されないまま終了した場合にのみデバッガが立ち入ります。その場合、 <a class="reference internal" href="pdb.html#pdb.post_mortem" title="pdb.post_mortem"><tt class="xref py py-func docutils literal"><span class="pre">pdb.post_mortem()</span></tt></a> によって検死デバッグを起動し、処理されなかった例外から得られたトレースバックオブジェクトを渡します。
<em>pm</em> を指定しないか値を偽にした場合、 <a class="reference internal" href="pdb.html#pdb.run" title="pdb.run"><tt class="xref py py-func docutils literal"><span class="pre">pdb.run()</span></tt></a> に適切な <a class="reference internal" href="functions.html#execfile" title="execfile"><tt class="xref py py-func docutils literal"><span class="pre">execfile()</span></tt></a>
呼び出しを渡して、最初からデバッガの下でスクリプトを実行します。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.3 で追加.</span></p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.4 で変更: </span>引数 <em>pm</em> が追加されました。</p>
</dd></dl>

<dl class="function">
<dt id="doctest.debug_src">
<tt class="descclassname">doctest.</tt><tt class="descname">debug_src</tt><big>(</big><em>src[, pm][, globs]</em><big>)</big><a class="headerlink" href="#doctest.debug_src" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列中の doctest をデバッグします。</p>
<p>上の <a class="reference internal" href="#doctest.debug" title="doctest.debug"><tt class="xref py py-func docutils literal"><span class="pre">debug()</span></tt></a> に似ていますが、doctest の入った文字列は <em>src</em> 引数で直接指定します。</p>
<p>オプション引数 <em>pm</em> は上の <a class="reference internal" href="#doctest.debug" title="doctest.debug"><tt class="xref py py-func docutils literal"><span class="pre">debug()</span></tt></a> と同じ意味です。</p>
<p>オプション引数 <em>globs</em> には、ローカルおよびグローバルな実行コンテキストの両方に使われる辞書を指定します。
<em>globs</em> を指定しない場合や <tt class="docutils literal"><span class="pre">None</span></tt> にした場合、空の辞書を使います。辞書を指定した場合、実際の実行コンテキストには浅いコピーが使われます。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
</dd></dl>

<p><a class="reference internal" href="#doctest.DebugRunner" title="doctest.DebugRunner"><tt class="xref py py-class docutils literal"><span class="pre">DebugRunner</span></tt></a> クラス自体や <a class="reference internal" href="#doctest.DebugRunner" title="doctest.DebugRunner"><tt class="xref py py-class docutils literal"><span class="pre">DebugRunner</span></tt></a> クラスが送出する特殊な例外は、テストフレームワークの作者にとって非常に興味のあるところですが、ここでは概要しか述べられません。詳しくはソースコード、とりわけ <a class="reference internal" href="#doctest.DebugRunner" title="doctest.DebugRunner"><tt class="xref py py-class docutils literal"><span class="pre">DebugRunner</span></tt></a> の docstring (それ自体 doctest です!)
を参照してください。</p>
<dl class="class">
<dt id="doctest.DebugRunner">
<em class="property">class </em><tt class="descclassname">doctest.</tt><tt class="descname">DebugRunner</tt><big>(</big><em>[checker][, verbose][, optionflags]</em><big>)</big><a class="headerlink" href="#doctest.DebugRunner" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テストの失敗に遭遇するとすぐに例外を送出するようになっている
<a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> のサブクラスです。予期しない例外が生じると、
<a class="reference internal" href="#doctest.UnexpectedException" title="doctest.UnexpectedException"><tt class="xref py py-exc docutils literal"><span class="pre">UnexpectedException</span></tt></a> 例外を送出します。この例外には、テスト、実行例、もともと送出された例外が入っています。期待する出力と実際の出力が一致しないために失敗した場合には、
<a class="reference internal" href="#doctest.DocTestFailure" title="doctest.DocTestFailure"><tt class="xref py py-exc docutils literal"><span class="pre">DocTestFailure</span></tt></a> 例外を送出します。この例外には、テスト、実行例、実際の出力が入っています。</p>
<p>コンストラクタのパラメータやメソッドについては、 <a class="reference internal" href="#doctest-advanced-api"><em>拡張 API</em></a> 節の
<a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> のドキュメントを参照してください。</p>
</dd></dl>

<p><a class="reference internal" href="#doctest.DebugRunner" title="doctest.DebugRunner"><tt class="xref py py-class docutils literal"><span class="pre">DebugRunner</span></tt></a> インスタンスの送出する例外には以下の二つがあります。</p>
<dl class="exception">
<dt id="doctest.DocTestFailure">
<em class="property">exception </em><tt class="descclassname">doctest.</tt><tt class="descname">DocTestFailure</tt><big>(</big><em>test</em>, <em>example</em>, <em>got</em><big>)</big><a class="headerlink" href="#doctest.DocTestFailure" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>doctest 実行例の実際の出力が期待する出力と一致しなかったことを示すために
<a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> が送出する例外です。コンストラクタの引数は、インスタンスの同名のメンバ変数を初期化するために使われます。</p>
</dd></dl>

<p><a class="reference internal" href="#doctest.DocTestFailure" title="doctest.DocTestFailure"><tt class="xref py py-exc docutils literal"><span class="pre">DocTestFailure</span></tt></a> では以下のメンバ変数を定義しています。</p>
<dl class="attribute">
<dt id="doctest.DocTestFailure.test">
<tt class="descclassname">DocTestFailure.</tt><tt class="descname">test</tt><a class="headerlink" href="#doctest.DocTestFailure.test" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>実行例が失敗した時に実行されていた <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> オブジェクトです。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.DocTestFailure.example">
<tt class="descclassname">DocTestFailure.</tt><tt class="descname">example</tt><a class="headerlink" href="#doctest.DocTestFailure.example" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>失敗した <a class="reference internal" href="#doctest.Example" title="doctest.Example"><tt class="xref py py-class docutils literal"><span class="pre">Example</span></tt></a> オブジェクトです。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.DocTestFailure.got">
<tt class="descclassname">DocTestFailure.</tt><tt class="descname">got</tt><a class="headerlink" href="#doctest.DocTestFailure.got" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>実行例の実際の出力です。</p>
</dd></dl>

<dl class="exception">
<dt id="doctest.UnexpectedException">
<em class="property">exception </em><tt class="descclassname">doctest.</tt><tt class="descname">UnexpectedException</tt><big>(</big><em>test</em>, <em>example</em>, <em>exc_info</em><big>)</big><a class="headerlink" href="#doctest.UnexpectedException" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>doctest 実行例が予期しない例外を送出したことを示すために <a class="reference internal" href="#doctest.DocTestRunner" title="doctest.DocTestRunner"><tt class="xref py py-class docutils literal"><span class="pre">DocTestRunner</span></tt></a> が送出する例外です。コンストラクタの引数は、インスタンスの同名のメンバ変数を初期化するために使われます。</p>
</dd></dl>

<p><a class="reference internal" href="#doctest.UnexpectedException" title="doctest.UnexpectedException"><tt class="xref py py-exc docutils literal"><span class="pre">UnexpectedException</span></tt></a> では以下のメンバ変数を定義しています。</p>
<dl class="attribute">
<dt id="doctest.UnexpectedException.test">
<tt class="descclassname">UnexpectedException.</tt><tt class="descname">test</tt><a class="headerlink" href="#doctest.UnexpectedException.test" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>実行例が失敗した時に実行されていた <a class="reference internal" href="#doctest.DocTest" title="doctest.DocTest"><tt class="xref py py-class docutils literal"><span class="pre">DocTest</span></tt></a> オブジェクトです。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.UnexpectedException.example">
<tt class="descclassname">UnexpectedException.</tt><tt class="descname">example</tt><a class="headerlink" href="#doctest.UnexpectedException.example" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>失敗した <a class="reference internal" href="#doctest.Example" title="doctest.Example"><tt class="xref py py-class docutils literal"><span class="pre">Example</span></tt></a> オブジェクトです。</p>
</dd></dl>

<dl class="attribute">
<dt id="doctest.UnexpectedException.exc_info">
<tt class="descclassname">UnexpectedException.</tt><tt class="descname">exc_info</tt><a class="headerlink" href="#doctest.UnexpectedException.exc_info" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>予期しない例外についての情報の入ったタプルで、 <a class="reference internal" href="sys.html#sys.exc_info" title="sys.exc_info"><tt class="xref py py-func docutils literal"><span class="pre">sys.exc_info()</span></tt></a>  が返すのと同じものです。</p>
</dd></dl>

</div>
<div class="section" id="doctest-soapbox">
<span id="id14"></span><h2>25.2.8. アドバイス<a class="headerlink" href="#doctest-soapbox" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>冒頭でも触れたように、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> は、</p>
<ol class="arabic simple">
<li>docstring 内の実行例をチェックする</li>
<li>回帰テストを行う</li>
<li>実行可能なドキュメント/読めるテストの実現</li>
</ol>
<p>という三つの主な用途を持つようになりました。</p>
<p>これらの用途にはそれぞれ違った要求があるので、区別して考えるのが重要です。特に、 docstring を曖昧なテストケースに埋もれさせてしまうとドキュメントとしては最悪です。</p>
<p>docstring の例は注意深く作成してください。
doctest の作成にはコツがあり、きちんと学ぶ必要があります &#8212; 最初はすんなりできないでしょう。実行例はドキュメントに本物の価値を与えます。良い例は、たくさんの言葉と同じ価値を持つことがしばしばあります。注意深くやれば、例はユーザにとっては非常に有益であり、時を経るにつれて、あるいは状況が変わった際に、何度も修正するのにかかる時間を節約するという形で、きっと見返りを得るでしょう。私は今でも、自分の <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> 実行例が &#8220;無害な&#8221;
変更を行った際にうまく動作しなくなることに驚いています。</p>
<p>説明テキストの作成をけちらなければ、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> は回帰テストの優れたツールにもなり得ます。説明文と実行例を交互に記述していけば、実際に何をどうしてテストしているのかもっと簡単に把握できるようになるでしょう。もちろん、コードベースのテストに詳しくコメントを入れるのも手ですが、そんなことをするプログラマはほとんどいません。多くの人々が、 <a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> のアプローチをとった方がきれいにテストを書けると気づいています。おそらく、これは単にコード中にコメントを書くのが少し面倒だからという理由でしょう。私はもう少し穿った見方もしています。
doctest ベースのテストを書くときの自然な態度は、自分のソフトウェアのよい点を説明しようとして、実行例を使って説明しようとするときの態度そのものだからだ、という理由です。それゆえに、テストファイルは自然と単純な機能の解説から始め、論理的により複雑で境界条件的なケースに進むような形になります。結果的に、一見ランダムに見えるような個別の機能をテストしている個別の関数の集まりではなく、首尾一貫した説明ができるようになるのです。
<a class="reference internal" href="#module-doctest" title="doctest: docstring の中のテストコード."><tt class="xref py py-mod docutils literal"><span class="pre">doctest</span></tt></a> によるテストの作成はまったく別の取り組み方であり、テストと説明の区別をなくして、まったく違う結果を生み出すのです。</p>
<p>回帰テストは特定のオブジェクトやファイルにまとめておくのがよいでしょう。回帰テストの組み方にはいくつか選択肢があります。</p>
<ul class="simple">
<li>テストケースを対話モードの実行例にして入れたテキストファイルを書き、
<tt class="xref py py-func docutils literal"><span class="pre">testifle()</span></tt> や <a class="reference internal" href="#doctest.DocFileSuite" title="doctest.DocFileSuite"><tt class="xref py py-func docutils literal"><span class="pre">DocFileSuite()</span></tt></a> を使ってそのファイルをテストします。この方法をお勧めします。最初から doctest を使うようにしている新たなプロジェクトでは、この方法が一番簡単です。</li>
<li><tt class="docutils literal"><span class="pre">_regrtest_topic</span></tt> という名前の関数を定義します。この関数には、あるトピックに対応するテストケースの入った docstring が一つだけ入っています。この関数はモジュールと同じファイルの中にも置けますし、別のテストファイルに分けてもかまいません。</li>
<li>回帰テストのトピックをテストケースの入った docstring
に対応付けた辞書 <tt class="docutils literal"><span class="pre">__test__</span></tt> 辞書を定義します。</li>
</ul>
<p class="rubric">注記</p>
<table class="docutils footnote" frame="void" id="id15" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[1]</a></td><td>期待する出力結果と例外の両方を含んだ例はサポートされていません。一方の終わりと他方の始まりを見分けようとするのはエラーの元になりがちですし、解りにくいテストになってしまいます。</td></tr>
</tbody>
</table>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="unittest.html" title="25.3. unittest — ユニットテストフレームワーク"
             >次へ</a> |</li>
        <li class="right" >
          <a href="pydoc.html" title="25.1. pydoc — ドキュメント生成とオンラインヘルプシステム"
             >前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="../index.html">Python 2.7ja1 documentation</a> &raquo;</li>

          <li><a href="index.html" >Python 標準ライブラリ</a> &raquo;</li>
          <li><a href="development.html" >25. 開発ツール</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 1990-2011, Python Software Foundation.
      最終更新: 2011-12-26
      このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/02cb752c6a9e で生成しました。
    </div>
  </body>
</html>