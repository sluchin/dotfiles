

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>7.4. difflib — 差分の計算を助ける &mdash; Python 2.7ja1 documentation</title>
    
    <link rel="stylesheet" href="../_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '2.7ja1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="search" type="application/opensearchdescription+xml"
          title="Python 2.7ja1 documentation 内を検索"
          href="../_static/opensearch.xml"/>
    <link rel="author" title="このドキュメントについて" href="../about.html" />
    <link rel="copyright" title="著作権" href="../copyright.html" />
    <link rel="top" title="Python 2.7ja1 documentation" href="../index.html" />
    <link rel="up" title="7. 文字列処理" href="strings.html" />
    <link rel="next" title="7.5. StringIO — ファイルのように文字列を読み書きする" href="stringio.html" />
    <link rel="prev" title="7.3. struct — 文字列データをパックされたバイナリデータとして解釈する" href="struct.html" />
    <link rel="shortcut icon" type="image/png" href="../_static/py.png" />
    <script type="text/javascript" src="../_static/copybutton.js"></script>
    
    <script type="text/javascript" src="../_static/_jp.js"></script>
    
 

  </head>
  <body>
    <div class="related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             accesskey="I">索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="stringio.html" title="7.5. StringIO — ファイルのように文字列を読み書きする"
             accesskey="N">次へ</a> |</li>
        <li class="right" >
          <a href="struct.html" title="7.3. struct — 文字列データをパックされたバイナリデータとして解釈する"
             accesskey="P">前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="../index.html">Python 2.7ja1 documentation</a> &raquo;</li>

          <li><a href="index.html" >Python 標準ライブラリ</a> &raquo;</li>
          <li><a href="strings.html" accesskey="U">7. 文字列処理</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">目次</a></h3>
  <ul>
<li><a class="reference internal" href="#">7.4. <tt class="docutils literal"><span class="pre">difflib</span></tt> &#8212; 差分の計算を助ける</a><ul>
<li><a class="reference internal" href="#sequencematcher">7.4.1. SequenceMatcherオブジェクト</a></li>
<li><a class="reference internal" href="#sequencematcher-examples">7.4.2. SequenceMatcher の例</a></li>
<li><a class="reference internal" href="#differ">7.4.3. Differ オブジェクト</a></li>
<li><a class="reference internal" href="#differ-examples">7.4.4. Differ の例</a></li>
<li><a class="reference internal" href="#difflib-interface">7.4.5. difflib のコマンドラインインタフェース</a></li>
</ul>
</li>
</ul>

  <h4>前のトピックへ</h4>
  <p class="topless"><a href="struct.html"
                        title="前の章へ">7.3. <tt class="docutils literal"><span class="pre">struct</span></tt> &#8212; 文字列データをパックされたバイナリデータとして解釈する</a></p>
  <h4>次のトピックへ</h4>
  <p class="topless"><a href="stringio.html"
                        title="次の章へ">7.5. <tt class="docutils literal"><span class="pre">StringIO</span></tt> &#8212; ファイルのように文字列を読み書きする</a></p>
  <h3>このページ</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/library/difflib.txt"
           rel="nofollow">ソースコードを表示</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>クイック検索</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="検索" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    モジュール、クラス、または関数名を入力してください
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="module-difflib">
<span id="difflib"></span><h1>7.4. <a class="reference internal" href="#module-difflib" title="difflib: オブジェクト同士の違いを計算する"><tt class="xref py py-mod docutils literal"><span class="pre">difflib</span></tt></a> &#8212; 差分の計算を助ける<a class="headerlink" href="#module-difflib" title="このヘッドラインへのパーマリンク">¶</a></h1>
<p class="versionadded">
<span class="versionmodified">バージョン 2.1 で追加.</span></p>
<p>このモジュールは、シーケンスを比較するためのクラスや関数を提供しています。例えば、ファイルの差分を計算して、それを HTML や context diff, unified diff
などいろいろなフォーマットで出力するために、このモジュールを利用することができます。ディレクトリやファイル群を比較するためには、 <a class="reference internal" href="filecmp.html#module-filecmp" title="filecmp: ファイル群を効率的に比較します。"><tt class="xref py py-mod docutils literal"><span class="pre">filecmp</span></tt></a> モジュールも参照してください。</p>
<dl class="class">
<dt id="difflib.SequenceMatcher">
<em class="property">class </em><tt class="descclassname">difflib.</tt><tt class="descname">SequenceMatcher</tt><a class="headerlink" href="#difflib.SequenceMatcher" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>柔軟性のあるクラスで、二つのシーケンスの要素は、ハッシュ化できる(<a class="reference internal" href="../glossary.html#term-hashable"><em class="xref std std-term">hashable</em></a>)型である限り何でも比較可能です。基本的なアルゴリズムは、1980年代の後半に発表された
Ratcliff と Obershelp による&#8221;ゲシュタルトパターンマッチング&#8221;と大げさに名づけられたアルゴリズム以前から知られている、やや凝ったアルゴリズムです。その考え方は、&#8221;junk&#8221; 要素を含まない最も長い互いに隣接したマッチ列を探すことです
(Ratcliff と Obershelp のアルゴリズムでは junk を示しません)。このアイデアは、マッチ列から左または右に伸びる断片に対して再帰的にあてはめられます。この方法では編集を最小にする列は取り出されませんが、人間の目からみて「正しい感じ」にマッチする傾向があります。</p>
<p><strong>実行時間:</strong> 基本的な Ratcliff-Obershelp アルゴリズムは、最悪の場合3乗、期待値で2乗となります。
<a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><tt class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></tt></a> オブジェクトでは、最悪のケースで2乗、期待値は比較されるシーケンス中に共通に現れる要素数に非常にややこしく依存しています。最良の場合は線形時間になります。</p>
<p><strong>自動 junk ヒューリスティック:</strong> <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><tt class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></tt></a> は、シーケンスの特定の要素を自動的に junk として扱うヒューリスティックをサポートしています。このヒューリスティックは、各個要素がシーケンス内に何回現れるかを数えます。ある要素の重複数が (最初のものは除いて) 合計でシーケンスの 1% 以上になり、そのシーケンスが 200 要素以上なら、その要素は &#8220;popular&#8221; であるものとしてマークされ、シーケンスのマッチングの目的からは junk として扱われます。このヒューリスティックは、 <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><tt class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></tt></a> の作成時に <tt class="docutils literal"><span class="pre">autojunk</span></tt>
パラメタを <tt class="docutils literal"><span class="pre">False</span></tt> に設定することで無効化できます。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.7.1 で追加: </span><em>autojunk</em> パラメタ。</p>
</dd></dl>

<dl class="class">
<dt id="difflib.Differ">
<em class="property">class </em><tt class="descclassname">difflib.</tt><tt class="descname">Differ</tt><a class="headerlink" href="#difflib.Differ" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>テキスト行からなるシーケンスを比較するクラスです。人が読むことのできる差分を作成します。
Differ クラスは <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><tt class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></tt></a>
クラスを利用して、行からなるシーケンスを比較したり、(ほぼ)同一の行内の文字を比較したりします。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><tt class="xref py py-class docutils literal"><span class="pre">Differ</span></tt></a> クラスによる差分の各行は、2文字のコードで始まります。</p>
<table border="1" class="docutils">
<colgroup>
<col width="19%" />
<col width="81%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">コード</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'-</span> <span class="pre">'</span></tt></td>
<td>行はシーケンス1にのみ存在する</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'+</span> <span class="pre">'</span></tt></td>
<td>行はシーケンス2にのみ存在する</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'</span>&nbsp; <span class="pre">'</span></tt></td>
<td>行は両方のシーケンスで同一</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'?</span> <span class="pre">'</span></tt></td>
<td>行は入力シーケンスのどちらにも存在しない</td>
</tr>
</tbody>
</table>
<p>&#8216;? &#8216;で始まる行は、行内のどこに差異が存在するかに注意を向けようとします。その行は、入力されたシーケンスのどちらにも存在しません。シーケンスがタブ文字を含むとき、これらの行は判別しづらいものになることがあります。</p>
</dd></dl>

<dl class="class">
<dt id="difflib.HtmlDiff">
<em class="property">class </em><tt class="descclassname">difflib.</tt><tt class="descname">HtmlDiff</tt><a class="headerlink" href="#difflib.HtmlDiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>このクラスは、二つのテキストを左右に並べて比較表示し、行間あるいは行内の変更点を強調表示するような HTML テーブル (またはテーブルの入った完全な
HTML ファイル) を生成するために使います。テーブルは完全差分モード、コンテキスト差分モードのいずれでも生成できます。</p>
<p>このクラスのコンストラクタは以下のようになっています:</p>
<dl class="function">
<dt id="difflib.HtmlDiff.__init__">
<tt class="descname">__init__</tt><big>(</big><em>[tabsize][, wrapcolumn][, linejunk][, charjunk]</em><big>)</big><a class="headerlink" href="#difflib.HtmlDiff.__init__" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><tt class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></tt></a> のインスタンスを初期化します。</p>
<p><em>tabsize</em> はオプションのキーワード引数で、タブストップ幅を指定します。デフォルトは <tt class="docutils literal"><span class="pre">8</span></tt> です。</p>
<p><em>wrapcolumn</em> はオプションのキーワード引数で、テキストを折り返すカラム幅を指定します。デフォルトは <tt class="docutils literal"><span class="pre">None</span></tt> で折り返しを行いません。</p>
<p><em>linejunk</em> および <em>charjunk</em> はオプションのキーワード引数で、 <tt class="docutils literal"><span class="pre">ndiff()</span></tt> (<a class="reference internal" href="#difflib.HtmlDiff" title="difflib.HtmlDiff"><tt class="xref py py-class docutils literal"><span class="pre">HtmlDiff</span></tt></a>
はこの関数を使って左右のテキストの差分を HTML で生成します) に渡されます。それぞれの引数のデフォルト値および説明は <tt class="docutils literal"><span class="pre">ndiff()</span></tt>
のドキュメントを参照してください。</p>
</dd></dl>

<p>以下のメソッドが public になっています:</p>
<dl class="function">
<dt id="difflib.HtmlDiff.make_file">
<tt class="descname">make_file</tt><big>(</big><em>fromlines, tolines [, fromdesc][, todesc][, context][, numlines]</em><big>)</big><a class="headerlink" href="#difflib.HtmlDiff.make_file" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った表を持つ完全な
HTML  ファイルを文字列で返します。</p>
<p><em>fromdesc</em> および <em>todesc</em> はオプションのキーワード引数で、差分表示テーブルにおけるそれぞれ差分元、差分先ファイルのカラムのヘッダになる文字列を指定します (いずれもデフォルト値は空文字列です)。</p>
<p><em>context</em> および <em>numlines</em> はともにオプションのキーワード引数です。
<em>context</em> を <tt class="docutils literal"><span class="pre">True</span></tt> にするとコンテキスト差分を表示し、デフォルトの <tt class="docutils literal"><span class="pre">False</span></tt> にすると完全なファイル差分を表示します。
<em>numlines</em> のデフォルト値は <tt class="docutils literal"><span class="pre">5</span></tt> で、
<em>context</em> が <tt class="docutils literal"><span class="pre">True</span></tt> の場合、
<em>numlines</em> は強調部分の前後にあるコンテキスト行の数を制御します。
<em>context</em> が <tt class="docutils literal"><span class="pre">False</span></tt> の場合、
<em>numlines</em> は &#8220;next&#8221; と書かれたハイパーリンクをたどった時に到達する場所が次の変更部分より何行前にあるかを制御します
(値をゼロにした場合、&#8221;next&#8221; ハイパーリンクを辿ると変更部分の強調表示がブラウザの最上部に表示されるようになります)。</p>
</dd></dl>

<dl class="function">
<dt id="difflib.HtmlDiff.make_table">
<tt class="descname">make_table</tt><big>(</big><em>fromlines, tolines [, fromdesc][, todesc][, context][, numlines]</em><big>)</big><a class="headerlink" href="#difflib.HtmlDiff.make_table" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>fromlines</em> と <em>tolines</em> (いずれも文字列のリスト) を比較し、行間または行内の変更点が強調表示された行差分の入った完全な HTML
テーブルを文字列で返します。</p>
<p>このメソッドの引数は、 <a class="reference internal" href="#difflib.HtmlDiff.make_file" title="difflib.HtmlDiff.make_file"><tt class="xref py py-meth docutils literal"><span class="pre">make_file()</span></tt></a> メソッドの引数と同じです。</p>
</dd></dl>

<p><tt class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></tt> はこのクラスへのコマンドラインフロントエンドで、使い方を学ぶ上で格好の例題が入っています。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.4 で追加.</span></p>
</dd></dl>

<dl class="function">
<dt id="difflib.context_diff">
<tt class="descclassname">difflib.</tt><tt class="descname">context_diff</tt><big>(</big><em>a, b[, fromfile][, tofile][, fromfiledate][, tofiledate][, n][, lineterm]</em><big>)</big><a class="headerlink" href="#difflib.context_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分
(差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><em class="xref std std-term">generator</em></a>)) を、
context diff のフォーマット(以下「コンテクスト形式」)で返します。</p>
<p>コンテクスト形式は、変更があった行に前後数行を加えてある、コンパクトな表現方法です。変更箇所は、変更前/変更後に分けて表します。コンテクスト (変更箇所前後の行)
の行数は <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトでは、diff の制御行 (<tt class="docutils literal"><span class="pre">***</span></tt> や <tt class="docutils literal"><span class="pre">---</span></tt> を含む行) の最後には、改行文字が付加されます。この場合、入出力とも、行末に改行文字を持つので、
<a class="reference internal" href="stdtypes.html#file.readlines" title="file.readlines"><tt class="xref py py-func docutils literal"><span class="pre">file.readlines()</span></tt></a> で得た入力から生成した差分を、
<a class="reference internal" href="stdtypes.html#file.writelines" title="file.writelines"><tt class="xref py py-func docutils literal"><span class="pre">file.writelines()</span></tt></a> に渡す場合に便利です。</p>
<p>行末に改行文字を持たない入力に対しては、出力でも改行文字を付加しないように
<em>lineterm</em> 引数に <tt class="docutils literal"><span class="pre">&quot;&quot;</span></tt> を渡してください。</p>
<p>コンテクスト形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列
<em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em> で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;bacon</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;eggs</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;ham</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;guido</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;python</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;eggy</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hamster</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;guido</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">context_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s">&#39;before.py&#39;</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s">&#39;after.py&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>  <span class="c"># doctest: +NORMALIZE_WHITESPACE</span>
<span class="go">*** before.py</span>
<span class="go">--- after.py</span>
<span class="go">***************</span>
<span class="go">*** 1,4 ****</span>
<span class="go">! bacon</span>
<span class="go">! eggs</span>
<span class="go">! ham</span>
<span class="go">  guido</span>
<span class="go">--- 1,4 ----</span>
<span class="go">! python</span>
<span class="go">! eggy</span>
<span class="go">! hamster</span>
<span class="go">  guido</span>
</pre></div>
</div>
<p>より詳細な例は、 <a class="reference internal" href="#difflib-interface"><em>difflib のコマンドラインインタフェース</em></a> を参照してください。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.3 で追加.</span></p>
</dd></dl>

<dl class="function">
<dt id="difflib.get_close_matches">
<tt class="descclassname">difflib.</tt><tt class="descname">get_close_matches</tt><big>(</big><em>word, possibilities[, n][, cutoff]</em><big>)</big><a class="headerlink" href="#difflib.get_close_matches" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>「十分」なマッチの上位のリストを返します。
<em>word</em> はマッチさせたいシーケンス (大概は文字列) です。
<em>possibilities</em> は <em>word</em> にマッチさせるシーケンスのリスト (大概は文字列のリスト) です。</p>
<p>オプションの引数 <em>n</em> (デフォルトでは <tt class="docutils literal"><span class="pre">3</span></tt>)はメソッドの返すマッチの最大数です。
<em>n</em> は <tt class="docutils literal"><span class="pre">0</span></tt> より大きくなければなりません。</p>
<p>オプションの引数 <em>cutoff</em>  (デフォルトでは <tt class="docutils literal"><span class="pre">0.6</span></tt>)は、区間 [0, 1] に入る小数の値です。
<em>word</em> との一致率がそれ未満の <em>possibilities</em> の要素は無視されます。</p>
<p><em>possibilities</em> の要素でマッチした上位(多くても <em>n</em> 個)は、類似度のスコアに応じて(一番似たものを先頭に)ソートされたリストとして返されます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s">&#39;appel&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s">&#39;ape&#39;</span><span class="p">,</span> <span class="s">&#39;apple&#39;</span><span class="p">,</span> <span class="s">&#39;peach&#39;</span><span class="p">,</span> <span class="s">&#39;puppy&#39;</span><span class="p">])</span>
<span class="go">[&#39;apple&#39;, &#39;ape&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">keyword</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s">&#39;wheel&#39;</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[&#39;while&#39;]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s">&#39;apple&#39;</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">get_close_matches</span><span class="p">(</span><span class="s">&#39;accept&#39;</span><span class="p">,</span> <span class="n">keyword</span><span class="o">.</span><span class="n">kwlist</span><span class="p">)</span>
<span class="go">[&#39;except&#39;]</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="difflib.ndiff">
<tt class="descclassname">difflib.</tt><tt class="descname">ndiff</tt><big>(</big><em>a</em>, <em>b</em><span class="optional">[</span>, <em>linejunk</em><span class="optional">[</span>, <em>charjunk</em><span class="optional">]</span><span class="optional">]</span><big>)</big><a class="headerlink" href="#difflib.ndiff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分
(差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><em class="xref std std-term">generator</em></a>)) を、
<a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><tt class="xref py py-class docutils literal"><span class="pre">Differ</span></tt></a> のスタイルで返します。</p>
<p>オプションのキーワードパラメータ <em>linejunk</em> と <em>charjunk</em> は、フィルタ関数を渡します (使わないときは <tt class="docutils literal"><span class="pre">None</span></tt>)。</p>
<p><em>linejunk</em>: 文字列型の引数ひとつを受け取る関数で、文字列が junk ならば真を、違うときには偽を返します。
Python 2.3 以降、デフォルトでは(<tt class="docutils literal"><span class="pre">None</span></tt>)になります。それまでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_LINE_JUNK" title="difflib.IS_LINE_JUNK"><tt class="xref py py-func docutils literal"><span class="pre">IS_LINE_JUNK()</span></tt></a> であり、それは高々ひとつのシャープ記号(<tt class="docutils literal"><span class="pre">'#'</span></tt>)を除いて可視のキャラクタを含まない行をフィルタリングするものです。
Python 2.3 から、下位にある <a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><tt class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></tt></a> クラスが、雑音となるくらい頻繁に登場する行であるか否かを、動的に分析します。これは、バージョン 2.3 以前のデフォルト値よりたいていうまく動作します。</p>
<p><em>charjunk</em>: 文字(長さ1の文字列)を受け取る関数です。デフォルトでは、モジュールレべルの関数 <a class="reference internal" href="#difflib.IS_CHARACTER_JUNK" title="difflib.IS_CHARACTER_JUNK"><tt class="xref py py-func docutils literal"><span class="pre">IS_CHARACTER_JUNK()</span></tt></a> であり、これは空白文字類 (空白またはタブ、注：改行文字をこれに含めるのは悪いアイデア！)
をフィルタリングします。</p>
<p><tt class="file docutils literal"><span class="pre">Tools/scripts/ndiff.py</span></tt> は、この関数のコマンドラインのフロントエンド（インターフェイス）です。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s">&#39;one</span><span class="se">\n</span><span class="s">two</span><span class="se">\n</span><span class="s">three</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s">&#39;ore</span><span class="se">\n</span><span class="s">tree</span><span class="se">\n</span><span class="s">emu</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">diff</span><span class="p">),</span>
<span class="go">- one</span>
<span class="go">?  ^</span>
<span class="go">+ ore</span>
<span class="go">?  ^</span>
<span class="go">- two</span>
<span class="go">- three</span>
<span class="go">?  -</span>
<span class="go">+ tree</span>
<span class="go">+ emu</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="difflib.restore">
<tt class="descclassname">difflib.</tt><tt class="descname">restore</tt><big>(</big><em>sequence</em>, <em>which</em><big>)</big><a class="headerlink" href="#difflib.restore" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>差分を生成した元の二つのシーケンスのうち一つを返します。</p>
<p><a class="reference internal" href="#difflib.Differ.compare" title="difflib.Differ.compare"><tt class="xref py py-meth docutils literal"><span class="pre">Differ.compare()</span></tt></a> または <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><tt class="xref py py-meth docutils literal"><span class="pre">ndiff()</span></tt></a> によって生成された <em>sequence</em>
を与えられると、行頭のプレフィクスを取りのぞいてファイル 1 または 2 (引数 <em>which</em> で指定される) に由来する行を復元します。</p>
<p>例:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="n">ndiff</span><span class="p">(</span><span class="s">&#39;one</span><span class="se">\n</span><span class="s">two</span><span class="se">\n</span><span class="s">three</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span>
<span class="gp">... </span>             <span class="s">&#39;ore</span><span class="se">\n</span><span class="s">tree</span><span class="se">\n</span><span class="s">emu</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span> <span class="c"># materialize the generated delta into a list</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
<span class="go">one</span>
<span class="go">two</span>
<span class="go">three</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">restore</span><span class="p">(</span><span class="n">diff</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
<span class="go">ore</span>
<span class="go">tree</span>
<span class="go">emu</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="difflib.unified_diff">
<tt class="descclassname">difflib.</tt><tt class="descname">unified_diff</tt><big>(</big><em>a, b[, fromfile][, tofile][, fromfiledate][, tofiledate][, n][, lineterm]</em><big>)</big><a class="headerlink" href="#difflib.unified_diff" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> と <em>b</em> (文字列のリスト) を比較し、差分
(差分形式の行を生成するジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><em class="xref std std-term">generator</em></a>)) を、
unified diff フォーマット(以下「ユニファイド形式」)で返します。</p>
<p>ユニファイド形式は変更があった行に前後数行を加えた、コンパクトな表現方法です。変更箇所は (変更前/変更後を分離したブロックではなく) インライン・スタイルで表されます。コンテクスト（変更箇所前後の行）の行数は、 <em>n</em> で指定し、デフォルト値は 3 です。</p>
<p>デフォルトでは、diff の制御行 (<tt class="docutils literal"><span class="pre">---</span></tt>, <tt class="docutils literal"><span class="pre">+++</span></tt>, <tt class="docutils literal"><span class="pre">&#64;&#64;</span></tt> を含む行)
は行末の改行を含めて生成されます。このようにしてあると、入出力とも行末に改行文字を持つので、
<a class="reference internal" href="stdtypes.html#file.readlines" title="file.readlines"><tt class="xref py py-func docutils literal"><span class="pre">file.readlines()</span></tt></a> で得た入力を処理して生成した差分を、
<a class="reference internal" href="stdtypes.html#file.writelines" title="file.writelines"><tt class="xref py py-func docutils literal"><span class="pre">file.writelines()</span></tt></a> に渡す場合に便利です。</p>
<p>行末に改行文字を持たない入力には、出力も同じように改行なしになるように、
<em>lineterm</em> 引数を <tt class="docutils literal"><span class="pre">&quot;&quot;</span></tt> にセットしてください</p>
<p>ユニファイド形式は、通常、ヘッダにファイル名と変更時刻を持っています。この情報は、文字列 <em>fromfile</em>, <em>tofile</em>, <em>fromfiledate</em>, <em>tofiledate</em>
で指定できます。変更時刻の書式は、通常、ISO 8601 フォーマットで表されます。指定しなかった場合のデフォルト値は、空文字列です。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s1</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;bacon</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;eggs</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;ham</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;guido</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s2</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;python</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;eggy</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;hamster</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;guido</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">unified_diff</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">fromfile</span><span class="o">=</span><span class="s">&#39;before.py&#39;</span><span class="p">,</span> <span class="n">tofile</span><span class="o">=</span><span class="s">&#39;after.py&#39;</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>   <span class="c"># doctest: +NORMALIZE_WHITESPACE</span>
<span class="go">--- before.py</span>
<span class="go">+++ after.py</span>
<span class="go">@@ -1,4 +1,4 @@</span>
<span class="go">-bacon</span>
<span class="go">-eggs</span>
<span class="go">-ham</span>
<span class="go">+python</span>
<span class="go">+eggy</span>
<span class="go">+hamster</span>
<span class="go"> guido</span>
</pre></div>
</div>
<p>もっと詳細な例は、 <a class="reference internal" href="#difflib-interface"><em>difflib のコマンドラインインタフェース</em></a> を参照してください。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.3 で追加.</span></p>
</dd></dl>

<dl class="function">
<dt id="difflib.IS_LINE_JUNK">
<tt class="descclassname">difflib.</tt><tt class="descname">IS_LINE_JUNK</tt><big>(</big><em>line</em><big>)</big><a class="headerlink" href="#difflib.IS_LINE_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる行のとき真を返します。行 <em>line</em> は空白、または  <tt class="docutils literal"><span class="pre">'#'</span></tt> ひとつのときに無視できます。それ以外のときには無視できません。
Python 2.3 以前は <a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><tt class="xref py py-func docutils literal"><span class="pre">ndiff()</span></tt></a> の引数 <em>linkjunk</em> にデフォルトで使用されました。</p>
</dd></dl>

<dl class="function">
<dt id="difflib.IS_CHARACTER_JUNK">
<tt class="descclassname">difflib.</tt><tt class="descname">IS_CHARACTER_JUNK</tt><big>(</big><em>ch</em><big>)</big><a class="headerlink" href="#difflib.IS_CHARACTER_JUNK" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>無視できる文字のとき真を返します。文字 <em>ch</em> が空白、またはタブ文字のときには無視できます。それ以外の時には無視できません。
<a class="reference internal" href="#difflib.ndiff" title="difflib.ndiff"><tt class="xref py py-func docutils literal"><span class="pre">ndiff()</span></tt></a> の引数 <em>charjunk</em> としてデフォルトで使用されます。</p>
</dd></dl>

<div class="admonition- admonition seealso">
<p class="first admonition-title">参考</p>
<dl class="last docutils">
<dt><a class="reference external" href="http://www.ddj.com/184407970?pgno=5">Pattern Matching: The Gestalt Approach （パターンマッチング: 全体アプローチ）</a></dt>
<dd>John W. Ratcliff と  D. E. Metzener による類似のアルゴリズムに関する議論。
<a class="reference external" href="http://www.ddj.com/">Dr. Dobb&#8217;s Journal</a>  1988年7月号掲載。</dd>
</dl>
</div>
<div class="section" id="sequencematcher">
<span id="sequence-matcher"></span><h2>7.4.1. SequenceMatcherオブジェクト<a class="headerlink" href="#sequencematcher" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><tt class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></tt></a> クラスには、以下のようなコンストラクタがあります。</p>
<dl class="class">
<dt>
<em class="property">class </em><tt class="descclassname">difflib.</tt><tt class="descname">SequenceMatcher</tt><big>(</big><span class="optional">[</span><em>isjunk</em><span class="optional">[</span>, <em>a</em><span class="optional">[</span>, <em>b</em><span class="optional">[</span>, <em>autojunk=True</em><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><span class="optional">]</span><big>)</big></dt>
<dd><p>オプションの引数 <em>isjunk</em> は、 <tt class="docutils literal"><span class="pre">None</span></tt> (デフォルトの値です) にするか、単一の引数をとる関数にせねばなりません。後者の場合、関数はシーケンスの要素を受け取り、要素が junk であり、無視すべきである場合に限り真をかえすようにせねばなりません。 <em>isjunk</em> に <tt class="docutils literal"><span class="pre">None</span></tt> を渡すと、
<tt class="docutils literal"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">0</span></tt> を渡したのと同じになります; すなわち、いかなる要素も無視しなくなります。例えば以下のような引数を渡すと、空白とタブ文字を無視して文字のシーケンスを比較します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="s">&quot; </span><span class="se">\t</span><span class="s">&quot;</span>
</pre></div>
</div>
<p>オプションの引数 <em>a</em> と <em>b</em> は、比較される文字列で、デフォルトでは空の文字列です。両方のシーケンスの要素は、ハッシュ化可能(<a class="reference internal" href="../glossary.html#term-hashable"><em class="xref std std-term">hashable</em></a>)である必要があります。</p>
<p>オプションの引数 <em>autojunk</em> は、自動 junk ヒューリスティックを無効にするために使えます。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.7.1 で追加: </span><em>autojunk</em> パラメタ。</p>
<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><tt class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></tt></a> オブジェクトは以下のメソッドを持ちます。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seqs">
<tt class="descname">set_seqs</tt><big>(</big><em>a</em>, <em>b</em><big>)</big><a class="headerlink" href="#difflib.SequenceMatcher.set_seqs" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較される2つの文字列を設定します。</p>
</dd></dl>

<p><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><tt class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></tt></a> オブジェクトは、2つ目のシーケンスについての詳細な情報を計算し、キャッシュします。
1つのシーケンスをいくつものシーケンスと比較する場合、まず <a class="reference internal" href="#difflib.SequenceMatcher.set_seq2" title="difflib.SequenceMatcher.set_seq2"><tt class="xref py py-meth docutils literal"><span class="pre">set_seq2()</span></tt></a>
を使って文字列を設定しておき、別の文字列を1つずつ比較するために、繰り返し <a class="reference internal" href="#difflib.SequenceMatcher.set_seq1" title="difflib.SequenceMatcher.set_seq1"><tt class="xref py py-meth docutils literal"><span class="pre">set_seq1()</span></tt></a> を呼び出します。</p>
<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq1">
<tt class="descname">set_seq1</tt><big>(</big><em>a</em><big>)</big><a class="headerlink" href="#difflib.SequenceMatcher.set_seq1" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う1つ目のシーケンスを設定します。比較される2つ目のシーケンスは変更されません。</p>
</dd></dl>

<dl class="method">
<dt id="difflib.SequenceMatcher.set_seq2">
<tt class="descname">set_seq2</tt><big>(</big><em>b</em><big>)</big><a class="headerlink" href="#difflib.SequenceMatcher.set_seq2" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>比較を行う2つ目のシーケンスを設定します。比較される1つ目のシーケンスは変更されません。</p>
</dd></dl>

<dl class="method">
<dt id="difflib.SequenceMatcher.find_longest_match">
<tt class="descname">find_longest_match</tt><big>(</big><em>alo</em>, <em>ahi</em>, <em>blo</em>, <em>bhi</em><big>)</big><a class="headerlink" href="#difflib.SequenceMatcher.find_longest_match" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><tt class="docutils literal"><span class="pre">a[alo:ahi]</span></tt> と <tt class="docutils literal"><span class="pre">b[blo:</span> <span class="pre">bhi]</span></tt> の中から、最長のマッチ列を探します。</p>
<p><em>isjunk</em> が省略されたか <tt class="docutils literal"><span class="pre">None</span></tt> の時、 <tt class="xref py py-meth docutils literal"><span class="pre">get_longest_match()</span></tt> は
<tt class="docutils literal"><span class="pre">a[i:i+k]</span></tt> が <tt class="docutils literal"><span class="pre">b[j:j+k]</span></tt> と等しいような <tt class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">k)</span></tt> を返します。その値は <tt class="docutils literal"><span class="pre">alo</span> <span class="pre">&lt;=</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i+k</span> <span class="pre">&lt;=</span>&nbsp; <span class="pre">ahi</span></tt> かつ <tt class="docutils literal"><span class="pre">blo</span> <span class="pre">&lt;=</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j+k</span> <span class="pre">&lt;=</span>&nbsp; <span class="pre">bhi</span></tt>
となります。 <tt class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">k')</span></tt> でも、同じようになります。さらに <tt class="docutils literal"><span class="pre">k</span> <span class="pre">&gt;=</span> <span class="pre">k',</span> <span class="pre">i</span> <span class="pre">&lt;=</span> <span class="pre">i'</span></tt> が <tt class="docutils literal"><span class="pre">i</span> <span class="pre">==</span> <span class="pre">i',</span> <span class="pre">j</span> <span class="pre">&lt;=</span> <span class="pre">j'</span></tt>
でも同様です。言い換えると、いくつものマッチ列すべてのうち、
<em>a</em> 内で最初に始まるものを返します。そしてその <em>a</em> 内で最初のマッチ列すべてのうち
<em>b</em> 内で最初に始まるものを返します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot; abcd&quot;</span><span class="p">,</span> <span class="s">&quot;abcd abcd&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(a=0, b=4, size=5)</span>
</pre></div>
</div>
<p>引数 <em>isjunk</em> が与えられている場合、上記の通り、はじめに最長のマッチ列を判定します。ブロック内に junk 要素が見当たらないような追加条件の際はこれに該当しません。次にそのマッチ列を、その両側の junk 要素にマッチするよう、できる限り広げていきます。そのため結果となる列は、探している列のたまたま直前にあった同一の junk 以外の junk にはマッチしません。</p>
<p>以下は前と同じサンプルですが、空白を junk とみなしています。これは <tt class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></tt> が2つ目の列の末尾にある <tt class="docutils literal"><span class="pre">'</span> <span class="pre">abcd'</span></tt> にマッチしないようにしています。代わりに <tt class="docutils literal"><span class="pre">'abcd'</span></tt> にはマッチします。そして 2つ目の文字列中、一番左の <tt class="docutils literal"><span class="pre">'abcd'</span></tt> にマッチします。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">==</span><span class="s">&quot; &quot;</span><span class="p">,</span> <span class="s">&quot; abcd&quot;</span><span class="p">,</span> <span class="s">&quot;abcd abcd&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">find_longest_match</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)</span>
<span class="go">Match(1, 0, 4)</span>
</pre></div>
</div>
<p>どんな列にもマッチしない時は、 <tt class="docutils literal"><span class="pre">(alo,</span> <span class="pre">blo,</span> <span class="pre">0)</span></tt> を返します。</p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.6 で変更: </span>このメソッドは、名前付きタプル(<a class="reference internal" href="../glossary.html#term-named-tuple"><em class="xref std std-term">named tuple</em></a>)で <tt class="docutils literal"><span class="pre">Match(a,</span> <span class="pre">b,</span> <span class="pre">size)</span></tt> を返すようになりました。</p>
</dd></dl>

<dl class="method">
<dt id="difflib.SequenceMatcher.get_matching_blocks">
<tt class="descname">get_matching_blocks</tt><big>(</big><big>)</big><a class="headerlink" href="#difflib.SequenceMatcher.get_matching_blocks" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>マッチしたシーケンス中で個別にマッチしたシーケンスをあらわす、 3つの値のリストを返します。それぞれの値は
<tt class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></tt> という形式であらわされ、 <tt class="docutils literal"><span class="pre">a[i:i+n]</span> <span class="pre">==</span> <span class="pre">b[j:j+n]</span></tt> という関係を意味します。
3つの値は <em>i</em> と <em>j</em> の間で単調に増加します。</p>
<p>最後のタプルはダミーで、 <tt class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></tt> という値を持ちます。これは <tt class="docutils literal"><span class="pre">n==0</span></tt> である唯一のタプルです。</p>
<p>もし <tt class="docutils literal"><span class="pre">(i,</span> <span class="pre">j,</span> <span class="pre">n)</span></tt> と <tt class="docutils literal"><span class="pre">(i',</span> <span class="pre">j',</span> <span class="pre">n')</span></tt> がリストで並んでいる3つ組で、 2つ目が最後の3つ組でなければ、 <tt class="docutils literal"><span class="pre">i+n</span> <span class="pre">!=</span> <span class="pre">i'</span></tt>
または <tt class="docutils literal"><span class="pre">j+n</span> <span class="pre">!=</span> <span class="pre">j'</span></tt> です。言い換えると並んでいる3つ組は常に隣接していない同じブロックを表しています。</p>
<p class="versionchanged">
<span class="versionmodified">バージョン 2.5 で変更: </span>隣接する3つ組は常に隣接しないブロックを表すと保証するようになりました.</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;abxcd&quot;</span><span class="p">,</span> <span class="s">&quot;abcd&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">()</span>
<span class="go">[Match(a=0, b=0, size=2), Match(a=3, b=2, size=2), Match(a=5, b=4, size=0)]</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="difflib.SequenceMatcher.get_opcodes">
<tt class="descname">get_opcodes</tt><big>(</big><big>)</big><a class="headerlink" href="#difflib.SequenceMatcher.get_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><em>a</em> を <em>b</em> にするための方法を記述する5つのタプルを返します。それぞれのタプルは <tt class="docutils literal"><span class="pre">(tag,</span> <span class="pre">i1,</span> <span class="pre">i2,</span> <span class="pre">j1,</span> <span class="pre">j2)</span></tt> という形式であらわされます。最初のタプルは <tt class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">j1</span> <span class="pre">==</span> <span class="pre">0</span></tt> であり、
<em>i1</em> はその前にあるタプルの <em>i2</em> と同じ値です。同様に <em>j1</em> は前の <em>j2</em> と同じ値になります。</p>
<p><em>tag</em> の値は文字列であり、次のような意味です。</p>
<table border="1" class="docutils">
<colgroup>
<col width="20%" />
<col width="80%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">値</th>
<th class="head">意味</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'replace'</span></tt></td>
<td><tt class="docutils literal"><span class="pre">a[i1:i2]</span></tt> は <tt class="docutils literal"><span class="pre">b[</span> <span class="pre">j1:j2]</span></tt> に置き換えられる</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'delete'</span></tt></td>
<td><tt class="docutils literal"><span class="pre">a[i1:i2]</span></tt> は削除される。この時、 <tt class="docutils literal"><span class="pre">j1</span> <span class="pre">==</span> <span class="pre">j2</span></tt> である</td>
</tr>
<tr class="row-even"><td><tt class="docutils literal"><span class="pre">'insert'</span></tt></td>
<td><tt class="docutils literal"><span class="pre">b[j1:j2]</span></tt> が <tt class="docutils literal"><span class="pre">a</span> <span class="pre">[i1:i1]</span></tt> に挿入される。この時
<tt class="docutils literal"><span class="pre">i1</span> <span class="pre">==</span> <span class="pre">i2</span></tt> である。</td>
</tr>
<tr class="row-odd"><td><tt class="docutils literal"><span class="pre">'equal'</span></tt></td>
<td><tt class="docutils literal"><span class="pre">a[i1:i2]</span> <span class="pre">==</span> <span class="pre">b[j1:j2]</span></tt> (この部分シーケンスは同値)</td>
</tr>
</tbody>
</table>
<p>例)</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">a</span> <span class="o">=</span> <span class="s">&quot;qabxcd&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b</span> <span class="o">=</span> <span class="s">&quot;abycdf&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>   <span class="k">print</span> <span class="p">(</span><span class="s">&quot;</span><span class="si">%7s</span><span class="s"> a[</span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">] (</span><span class="si">%s</span><span class="s">) b[</span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">] (</span><span class="si">%s</span><span class="s">)&quot;</span> <span class="o">%</span>
<span class="gp">... </span>          <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">i2</span><span class="p">,</span> <span class="n">a</span><span class="p">[</span><span class="n">i1</span><span class="p">:</span><span class="n">i2</span><span class="p">],</span> <span class="n">j1</span><span class="p">,</span> <span class="n">j2</span><span class="p">,</span> <span class="n">b</span><span class="p">[</span><span class="n">j1</span><span class="p">:</span><span class="n">j2</span><span class="p">]))</span>
<span class="go"> delete a[0:1] (q) b[0:0] ()</span>
<span class="go">  equal a[1:3] (ab) b[0:2] (ab)</span>
<span class="go">replace a[3:4] (x) b[2:3] (y)</span>
<span class="go">  equal a[4:6] (cd) b[3:5] (cd)</span>
<span class="go"> insert a[6:6] () b[5:6] (f)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="difflib.SequenceMatcher.get_grouped_opcodes">
<tt class="descname">get_grouped_opcodes</tt><big>(</big><span class="optional">[</span><em>n</em><span class="optional">]</span><big>)</big><a class="headerlink" href="#difflib.SequenceMatcher.get_grouped_opcodes" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>最大 <em>n</em> 行までのコンテクストを含むグループを生成するような、ジェネレータ(<a class="reference internal" href="../glossary.html#term-generator"><em class="xref std std-term">generator</em></a>)を返します。</p>
<p>このメソッドは、 <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><tt class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></tt></a> で返されるグループの中から、似たような差異のかたまりに分け、間に挟まっている変更の無い部分を省きます。</p>
<p>グループは <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><tt class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></tt></a> と同じ書式で返されます。</p>
<p class="versionadded">
<span class="versionmodified">バージョン 2.3 で追加.</span></p>
</dd></dl>

<dl class="method">
<dt id="difflib.SequenceMatcher.ratio">
<tt class="descname">ratio</tt><big>(</big><big>)</big><a class="headerlink" href="#difflib.SequenceMatcher.ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>[0, 1] の範囲の浮動小数点数で、シーケンスの類似度を測る値を返します。</p>
<p>T が2つのシーケンスの要素数の総計だと仮定し、M をマッチした数とすると、この値は 2.0*M / T であらわされます。もしシーケンスがまったく同じ場合、値は <tt class="docutils literal"><span class="pre">1.0</span></tt> となり、まったく異なる場合には <tt class="docutils literal"><span class="pre">0.0</span></tt> となります。</p>
<p>このメソッドは <a class="reference internal" href="#difflib.SequenceMatcher.get_matching_blocks" title="difflib.SequenceMatcher.get_matching_blocks"><tt class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></tt></a> または <a class="reference internal" href="#difflib.SequenceMatcher.get_opcodes" title="difflib.SequenceMatcher.get_opcodes"><tt class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></tt></a>
がまだ呼び出されていない場合には非常にコストが高いです。この場合、上限を素早く計算するために、 <a class="reference internal" href="#difflib.SequenceMatcher.quick_ratio" title="difflib.SequenceMatcher.quick_ratio"><tt class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></tt></a> もしくは
<a class="reference internal" href="#difflib.SequenceMatcher.real_quick_ratio" title="difflib.SequenceMatcher.real_quick_ratio"><tt class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></tt></a> を最初に試してみる方がいいかもしれません。</p>
</dd></dl>

<dl class="method">
<dt id="difflib.SequenceMatcher.quick_ratio">
<tt class="descname">quick_ratio</tt><big>(</big><big>)</big><a class="headerlink" href="#difflib.SequenceMatcher.quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><tt class="xref py py-meth docutils literal"><span class="pre">ratio()</span></tt></a> の上界を、より高速に計算します。</p>
</dd></dl>

<dl class="method">
<dt id="difflib.SequenceMatcher.real_quick_ratio">
<tt class="descname">real_quick_ratio</tt><big>(</big><big>)</big><a class="headerlink" href="#difflib.SequenceMatcher.real_quick_ratio" title="この定義へのパーマリンク">¶</a></dt>
<dd><p><a class="reference internal" href="#difflib.SequenceMatcher.ratio" title="difflib.SequenceMatcher.ratio"><tt class="xref py py-meth docutils literal"><span class="pre">ratio()</span></tt></a> の上界を、非常に高速に計算します。</p>
</dd></dl>

</dd></dl>

<p>この文字列全体のマッチ率を返す3つのメソッドは、精度の異なる近似値を返します。
<tt class="xref py py-meth docutils literal"><span class="pre">quick_ratio()</span></tt> と <tt class="xref py py-meth docutils literal"><span class="pre">real_quick_ratio()</span></tt> は、常に <tt class="xref py py-meth docutils literal"><span class="pre">ratio()</span></tt>
以上の値を返します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&quot;abcd&quot;</span><span class="p">,</span> <span class="s">&quot;bcde&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">quick_ratio</span><span class="p">()</span>
<span class="go">0.75</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">s</span><span class="o">.</span><span class="n">real_quick_ratio</span><span class="p">()</span>
<span class="go">1.0</span>
</pre></div>
</div>
</div>
<div class="section" id="sequencematcher-examples">
<span id="id1"></span><h2>7.4.2. SequenceMatcher の例<a class="headerlink" href="#sequencematcher-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は2つの文字列を比較します。空白を junk とします。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">s</span> <span class="o">=</span> <span class="n">SequenceMatcher</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">==</span> <span class="s">&quot; &quot;</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s">&quot;private Thread currentThread;&quot;</span><span class="p">,</span>
<span class="gp">... </span>                    <span class="s">&quot;private volatile Thread currentThread;&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><tt class="xref py py-meth docutils literal"><span class="pre">ratio()</span></tt> は、[0, 1] の範囲の値を返し、シーケンスの類似度を測ります。経験によると、 <tt class="xref py py-meth docutils literal"><span class="pre">ratio()</span></tt>
の値が0.6を超えると、シーケンスがよく似ていることを示します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">print</span> <span class="nb">round</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">ratio</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
<span class="go">0.866</span>
</pre></div>
</div>
<p>シーケンスのどこがマッチしているかにだけ興味のある時には  <tt class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></tt> が手軽でしょう。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_matching_blocks</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;a[</span><span class="si">%d</span><span class="s">] and b[</span><span class="si">%d</span><span class="s">] match for </span><span class="si">%d</span><span class="s"> elements&quot;</span> <span class="o">%</span> <span class="n">block</span>
<span class="go">a[0] and b[0] match for 8 elements</span>
<span class="go">a[8] and b[17] match for 21 elements</span>
<span class="go">a[29] and b[38] match for 0 elements</span>
</pre></div>
</div>
<p><tt class="xref py py-meth docutils literal"><span class="pre">get_matching_blocks()</span></tt> が返す最後のタプルが常にダミーであることに注目してください。このダミーは <tt class="docutils literal"><span class="pre">(len(a),</span> <span class="pre">len(b),</span> <span class="pre">0)</span></tt>  であり、これはタプルの最後の要素（マッチする要素の数）がゼロとなる唯一のケースです。</p>
<p>はじめのシーケンスがどのようにして2番目のものになるのかを知るには、 <tt class="xref py py-meth docutils literal"><span class="pre">get_opcodes()</span></tt> を使います。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">opcode</span> <span class="ow">in</span> <span class="n">s</span><span class="o">.</span><span class="n">get_opcodes</span><span class="p">():</span>
<span class="gp">... </span>    <span class="k">print</span> <span class="s">&quot;</span><span class="si">%6s</span><span class="s"> a[</span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">] b[</span><span class="si">%d</span><span class="s">:</span><span class="si">%d</span><span class="s">]&quot;</span> <span class="o">%</span> <span class="n">opcode</span>
<span class="go"> equal a[0:8] b[0:8]</span>
<span class="go">insert a[8:8] b[8:17]</span>
<span class="go"> equal a[8:29] b[17:38]</span>
</pre></div>
</div>
<div class="admonition- admonition seealso">
<p class="first admonition-title">参考</p>
<ul class="last simple">
<li><a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><tt class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></tt></a> を使った、シンプルで使えるコードを知るには、このモジュールの関数 <a class="reference internal" href="#difflib.get_close_matches" title="difflib.get_close_matches"><tt class="xref py py-func docutils literal"><span class="pre">get_close_matches()</span></tt></a> を参照してください。</li>
<li><a class="reference external" href="http://code.activestate.com/recipes/576729/">Simple version control recipe</a>
<a class="reference internal" href="#difflib.SequenceMatcher" title="difflib.SequenceMatcher"><tt class="xref py py-class docutils literal"><span class="pre">SequenceMatcher</span></tt></a> で作った小規模アプリケーション。</li>
</ul>
</div>
</div>
<div class="section" id="differ">
<span id="differ-objects"></span><h2>7.4.3. Differ オブジェクト<a class="headerlink" href="#differ" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><tt class="xref py py-class docutils literal"><span class="pre">Differ</span></tt></a> オブジェクトによって生成された差分が <strong>最小</strong> であるなどとは言いません。むしろ、最小の差分はしばしば直観に反しています。その理由は、どこでもできるとなれば一致を見いだしてしまうからで、ときには思いがけなく100ページも離れたマッチになってしまうのです。一致点を互いに隣接したマッチに制限することで、場合によって長めの差分を出力するというコストを掛けることにはなっても、ある種の局所性を保つことができるのです。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><tt class="xref py py-class docutils literal"><span class="pre">Differ</span></tt></a> は、以下のようなコンストラクタを持ちます。</p>
<dl class="class">
<dt>
<em class="property">class </em><tt class="descclassname">difflib.</tt><tt class="descname">Differ</tt><big>(</big><span class="optional">[</span><em>linejunk</em><span class="optional">[</span>, <em>charjunk</em><span class="optional">]</span><span class="optional">]</span><big>)</big></dt>
<dd><p>オプションのパラメータ <em>linejunk</em> と <em>charjunk</em> はフィルタ関数の指定用です
(もしくは <tt class="docutils literal"><span class="pre">None</span></tt> を指定)。</p>
<p><em>linejunk</em>: ひとつの文字列引数を受け取る関数です。文字列が junk のときに真を返します。デフォルトでは、 <tt class="docutils literal"><span class="pre">None</span></tt> であり、どんな行であっても junk とは見なされません。</p>
<p><em>charjunk</em>: この関数は文字(長さ1の文字列)を引数として受け取り、文字が
junk であるときに真を返します。デフォルトは <tt class="docutils literal"><span class="pre">None</span></tt> であり、どんな文字も junk とは見なされません。</p>
<p><a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><tt class="xref py py-class docutils literal"><span class="pre">Differ</span></tt></a> オブジェクトは、以下の1つのメソッドを通して利用されます。（差分を生成します）。</p>
<dl class="method">
<dt id="difflib.Differ.compare">
<tt class="descname">compare</tt><big>(</big><em>a</em>, <em>b</em><big>)</big><a class="headerlink" href="#difflib.Differ.compare" title="この定義へのパーマリンク">¶</a></dt>
<dd><p>文字列からなる2つのシーケンスを比較し、差分（を表す文字列からなるシーケンス）を生成します。</p>
<p>それぞれのシーケンスは、改行文字によって終了する、独立したひと連なりの文字列でなければなりません。そのようなシーケンスは、ファイル形式オブジェクトの
<tt class="xref py py-meth docutils literal"><span class="pre">readlines()</span></tt> メソッドによって得ることができます。（得られる）差分は改行文字で終了する文字列として得られ、ファイル形式オブジェクトの
<tt class="xref py py-meth docutils literal"><span class="pre">writelines()</span></tt> メソッドによって出力できる形になっています。</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="differ-examples">
<span id="id2"></span><h2>7.4.4. Differ の例<a class="headerlink" href="#differ-examples" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例では2つのテキストを比較します。初めに、改行文字で終了する独立した1行の連続した
(ファイル形式オブジェクトの <tt class="xref py py-meth docutils literal"><span class="pre">readlines()</span></tt> メソッドによって得られるような)
テキストを用意します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s">  2. Explicit is better than implicit.</span>
<span class="gp">... </span><span class="s">  3. Simple is better than complex.</span>
<span class="gp">... </span><span class="s">  4. Complex is better than complicated.</span>
<span class="gp">... </span><span class="s">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">len</span><span class="p">(</span><span class="n">text1</span><span class="p">)</span>
<span class="go">4</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text1</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="go">&#39;\n&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">text2</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;  1. Beautiful is better than ugly.</span>
<span class="gp">... </span><span class="s">  3.   Simple is better than complex.</span>
<span class="gp">... </span><span class="s">  4. Complicated is better than complex.</span>
<span class="gp">... </span><span class="s">  5. Flat is better than nested.</span>
<span class="gp">... </span><span class="s">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<p>次に Differ オブジェクトをインスタンス化します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">d</span> <span class="o">=</span> <span class="n">Differ</span><span class="p">()</span>
</pre></div>
</div>
<p>注意： <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><tt class="xref py py-class docutils literal"><span class="pre">Differ</span></tt></a> オブジェクトをインスタンス化するとき、行 junk と文字 junk をフィルタリングする関数を渡すことができます。詳細は <a class="reference internal" href="#difflib.Differ" title="difflib.Differ"><tt class="xref py py-meth docutils literal"><span class="pre">Differ()</span></tt></a> コンストラクタを参照してください。</p>
<p>最後に、2つを比較します。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">text1</span><span class="p">,</span> <span class="n">text2</span><span class="p">))</span>
</pre></div>
</div>
<p><tt class="docutils literal"><span class="pre">result</span></tt> は文字列のリストなので、pretty-printしてみましょう。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pprint</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">[&#39;    1. Beautiful is better than ugly.\n&#39;,</span>
<span class="go"> &#39;-   2. Explicit is better than implicit.\n&#39;,</span>
<span class="go"> &#39;-   3. Simple is better than complex.\n&#39;,</span>
<span class="go"> &#39;+   3.   Simple is better than complex.\n&#39;,</span>
<span class="go"> &#39;?     ++\n&#39;,</span>
<span class="go"> &#39;-   4. Complex is better than complicated.\n&#39;,</span>
<span class="go"> &#39;?            ^                     ---- ^\n&#39;,</span>
<span class="go"> &#39;+   4. Complicated is better than complex.\n&#39;,</span>
<span class="go"> &#39;?           ++++ ^                      ^\n&#39;,</span>
<span class="go"> &#39;+   5. Flat is better than nested.\n&#39;]</span>
</pre></div>
</div>
<p>これは、複数行の文字列として、次のように出力されます。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">sys</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
<span class="go">    1. Beautiful is better than ugly.</span>
<span class="go">-   2. Explicit is better than implicit.</span>
<span class="go">-   3. Simple is better than complex.</span>
<span class="go">+   3.   Simple is better than complex.</span>
<span class="go">?     ++</span>
<span class="go">-   4. Complex is better than complicated.</span>
<span class="go">?            ^                     ---- ^</span>
<span class="go">+   4. Complicated is better than complex.</span>
<span class="go">?           ++++ ^                      ^</span>
<span class="go">+   5. Flat is better than nested.</span>
</pre></div>
</div>
</div>
<div class="section" id="difflib-interface">
<span id="id3"></span><h2>7.4.5. difflib のコマンドラインインタフェース<a class="headerlink" href="#difflib-interface" title="このヘッドラインへのパーマリンク">¶</a></h2>
<p>この例は、 difflib を使って <tt class="docutils literal"><span class="pre">diff</span></tt> に似たユーティリティーを作成する方法を示します。これは、 Python のソース配布物にも、 <tt class="file docutils literal"><span class="pre">Tools/scripts/diff.py</span></tt> として含まれています。</p>
<div class="highlight-python"><div class="highlight"><pre><span class="sd">&quot;&quot;&quot; Command line interface to difflib.py providing diffs in four formats:</span>

<span class="sd">* ndiff:    lists every line and highlights interline changes.</span>
<span class="sd">* context:  highlights clusters of changes in a before/after format.</span>
<span class="sd">* unified:  highlights clusters of changes in an inline format.</span>
<span class="sd">* html:     generates side by side comparison with change highlights.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span><span class="o">,</span> <span class="nn">difflib</span><span class="o">,</span> <span class="nn">optparse</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
     <span class="c"># Configure the option parser</span>
    <span class="n">usage</span> <span class="o">=</span> <span class="s">&quot;usage: %prog [options] fromfile tofile&quot;</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">optparse</span><span class="o">.</span><span class="n">OptionParser</span><span class="p">(</span><span class="n">usage</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-c&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s">&#39;Produce a context format diff (default)&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-u&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s">&#39;Produce a unified format diff&#39;</span><span class="p">)</span>
    <span class="n">hlp</span> <span class="o">=</span> <span class="s">&#39;Produce HTML side by side diff (can use -c and -l in conjunction)&#39;</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-m&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="n">hlp</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-n&quot;</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="s">&quot;store_true&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s">&#39;Produce a ndiff format diff&#39;</span><span class="p">)</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_option</span><span class="p">(</span><span class="s">&quot;-l&quot;</span><span class="p">,</span> <span class="s">&quot;--lines&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s">&quot;int&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
                      <span class="n">help</span><span class="o">=</span><span class="s">&#39;Set number of context lines (default 3)&#39;</span><span class="p">)</span>
    <span class="p">(</span><span class="n">options</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">print_help</span><span class="p">()</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s">&quot;need to specify both a fromfile and tofile&quot;</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">lines</span>
    <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span> <span class="o">=</span> <span class="n">args</span> <span class="c"># as specified in the usage string</span>

    <span class="c"># we&#39;re passing these as arguments to the diff function</span>
    <span class="n">fromdate</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">fromfile</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)</span>
    <span class="n">todate</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">ctime</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">tofile</span><span class="p">)</span><span class="o">.</span><span class="n">st_mtime</span><span class="p">)</span>
    <span class="n">fromlines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fromfile</span><span class="p">,</span> <span class="s">&#39;U&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
    <span class="n">tolines</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">tofile</span><span class="p">,</span> <span class="s">&#39;U&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">options</span><span class="o">.</span><span class="n">u</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">unified_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span>
                                    <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">n</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">ndiff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">options</span><span class="o">.</span><span class="n">m</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">HtmlDiff</span><span class="p">()</span><span class="o">.</span><span class="n">make_file</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span>
                                            <span class="n">tofile</span><span class="p">,</span> <span class="n">context</span><span class="o">=</span><span class="n">options</span><span class="o">.</span><span class="n">c</span><span class="p">,</span>
                                            <span class="n">numlines</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="n">difflib</span><span class="o">.</span><span class="n">context_diff</span><span class="p">(</span><span class="n">fromlines</span><span class="p">,</span> <span class="n">tolines</span><span class="p">,</span> <span class="n">fromfile</span><span class="p">,</span> <span class="n">tofile</span><span class="p">,</span>
                                    <span class="n">fromdate</span><span class="p">,</span> <span class="n">todate</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span>

    <span class="c"># we&#39;re using writelines because diff is a generator</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">writelines</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>ナビゲーション</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="総合索引"
             >索引</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Pythonモジュール索引"
             >モジュール</a> |</li>
        <li class="right" >
          <a href="stringio.html" title="7.5. StringIO — ファイルのように文字列を読み書きする"
             >次へ</a> |</li>
        <li class="right" >
          <a href="struct.html" title="7.3. struct — 文字列データをパックされたバイナリデータとして解釈する"
             >前へ</a> |</li>
        <li><img src="../_static/py.png" alt=""
                 style="vertical-align: middle; margin-top: -1px"/></li>
        <li><a href="../index.html">Python 2.7ja1 documentation</a> &raquo;</li>

          <li><a href="index.html" >Python 標準ライブラリ</a> &raquo;</li>
          <li><a href="strings.html" >7. 文字列処理</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; <a href="../copyright.html">Copyright</a> 1990-2011, Python Software Foundation.
      最終更新: 2011-12-26
      このドキュメントは <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.2pre/02cb752c6a9e で生成しました。
    </div>
  </body>
</html>